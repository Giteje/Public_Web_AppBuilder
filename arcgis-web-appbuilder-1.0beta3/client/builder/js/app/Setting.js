//>>built
require({cache:{"url:builder/templates/Setting.html":'\x3cdiv style\x3d"position:relative;margin-left:20px;margin-right:20px;"\x3e\r\n  \x3ctable class\x3d"layout-table"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr \x3e\r\n        \x3ctd colspan\x3d3\x3e\r\n          \x3ctable class\x3d"portalurl-table"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd class\x3d"first-td"\x3e${nls.defaultPortalUrl}\x3c/td\x3e\r\n                \x3ctd class\x3d"second-td"\x3e\r\n                  \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http(s)://www.arcgis.com/ or http(s)://\x3cportal_server\x3e/\x3cinstance_name\x3e/" value\x3d"" data-dojo-attach-point\x3d"portalUrl" style\x3d"width:520px;" /\x3e\r\n                  \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.defaultPortalUrl}"\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"third-td"\x3e\r\n                  \x3ca data-dojo-attach-point\x3d"btnLoadHelperServices" class\x3d"jimu-btn"\x3e${nls.loadHelperServices}\x3c/a\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr \x3e\r\n        \x3ctd colspan\x3d3\x3e\r\n          \x3ctable class\x3d"service-table"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd class\x3d"first-td"\x3e*${nls.geometryServiceUrl}\x3c/td\x3e\r\n                \x3ctd class\x3d"second-td"\x3e\r\n                  \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http://" value\x3d"" data-dojo-type\x3d"jimu/dijit/ServiceURLInput" data-dojo-attach-point\x3d"geoServiceUrl" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"third-td"\x3e\r\n                  \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.geometryServiceUrl}"\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd class\x3d"first-td"\x3e${nls.geocodeServiceUrl}\x3c/td\x3e\r\n                \x3ctd class\x3d"second-td"\x3e\r\n                  \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http://" value\x3d"" data-dojo-type\x3d"jimu/dijit/ServiceURLInput" data-dojo-attach-point\x3d"geocodeServiceUrl" data-dojo-props\x3d"verify: false" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"third-td"\x3e\r\n                  \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.geocodeServiceUrl}"\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd class\x3d"first-td"\x3e${nls.routeServiceUrl}\x3c/td\x3e\r\n                \x3ctd class\x3d"second-td"\x3e\r\n                  \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http://" value\x3d"" data-dojo-type\x3d"jimu/dijit/ServiceURLInput" data-dojo-attach-point\x3d"routeServiceUrl" data-dojo-props\x3d"verify: false" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"third-td"\x3e\r\n                  \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.routeServiceUrl}"\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e      \r\n              \x3ctr\x3e\r\n                \x3ctd class\x3d"first-td"\x3e${nls.printTaskUrl}\x3c/td\x3e\r\n                \x3ctd class\x3d"second-td"\x3e\r\n                  \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http://" value\x3d"" data-dojo-type\x3d"jimu/dijit/ServiceURLInput" data-dojo-attach-point\x3d"printTaskUrl" data-dojo-props\x3d"verify: false" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"third-td"\x3e\r\n                  \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.printTaskUrl}"\x3e\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e  \r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.httpProxyUrl}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cinput class\x3d"setting-input" type\x3d"text" placeholder\x3d"http://" value\x3d"" data-dojo-attach-point\x3d"proxyUrl" /\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third-td"\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.httpProxyUrl}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.locale}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cselect data-dojo-attach-point\x3d"localeSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:300px;height:30px;"\x3e\r\n            \x3coption value\x3d\'en-us\'\x3eEnglish\x3c/option\x3e\r\n            \x3coption value\x3d\'zh-cn\'\x3e\u4e2d\u6587\x3c/option\x3e\r\n          \x3c/select\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.locale}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"advanced-setting-hide"\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.bingMapKey}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cinput class\x3d"setting-input" type\x3d"text" value\x3d"" data-dojo-attach-point\x3d"bing" /\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third-td"\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.bingMapKey}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"advanced-setting-hide"\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.appId}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cinput class\x3d"setting-input" type\x3d"text" value\x3d"" data-dojo-attach-point\x3d"appId" /\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third-td"\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.appId}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"advanced-setting-hide"\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.themeRepo}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cinput class\x3d"setting-input" type\x3d"text" value\x3d"" data-dojo-attach-point\x3d"themeRepo" /\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third-td"\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.themeRepo}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"advanced-setting-hide"\x3e\r\n        \x3ctd class\x3d"first-td"\x3e${nls.widgetRepo}\x3c/td\x3e\r\n        \x3ctd class\x3d"second-td"\x3e\r\n          \x3cinput class\x3d"setting-input" type\x3d"text" value\x3d"" data-dojo-attach-point\x3d"widgetRepo" /\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third-td"\x3e\r\n          \x3cspan class\x3d"help-icon" title\x3d"${nls.helpText.widgetRepo}"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d2\x3e\r\n          \x3cinput class\x3d"advanced-settings" type\x3d"button" data-dojo-attach-point\x3d"advance" data-dojo-attach-event\x3d"onclick:_onAdvancedClick" /\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Setting.html dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/Deferred dojo/query dojo/on dojo/topic dijit/form/Select esri/request builder/portalUtils jimu/portalUrlUtils jimu/dijit/Message jimu/dijit/LoadingShelter dojo/dom-style dojo/dom-class dojo/NodeList-dom jimu/dijit/ServiceURLInput".split(" "),function(l,m,n,q,r,b,s,x,h,t,e,y,z,f,u,p,k,v,A,w,B){return l([m,n,q],
{templateString:r,baseClass:"setting",label:"setting",itemId:null,currentPortalUrl:null,shelter:null,adSettings:null,_onlineGeometryUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",_onlineGeocodeUrl:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",_onlinePrintTaskUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",_onlineRouteUrl:"http://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",
postMixInProperties:function(){this.nls=b.mixin({},builderNls.common);this.nls=b.mixin(this.nls,builderNls.settings)},postCreate:function(){this.inherited(arguments);this.adSettings=t(".advanced-setting-hide",this.domNode);this.advance.value=this.nls.showAdSetting;this.shelter=new v({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this.own(e(this.btnLoadHelperServices,"click",b.hitch(this,this._loadAndSaveHelperServices)));this.own(e(this.portalUrl,"blur",b.hitch(this,this._getTrimPortalUrl)));
this.own(e(this.geoServiceUrl,"Fetch",b.hitch(this,"_onGeometryServiceFetch")));this.own(e(this.geoServiceUrl,"FetchError",b.hitch(this,"_onGeometryServiceFetchError")));this.initSetting()},_getTrimPortalUrl:function(a){a.target.value&&(this.portalUrl.value=b.trim(this.portalUrl.value))},initSetting:function(){this.shelter.show();f({url:"/builder/rest/settings/getInfo",handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(a){this.shelter.hide();a&&a.success&&(this.bing.value=a.bing||
"",this.portalUrl.value=a.portalUrl||"",this.geoServiceUrl.setValue(a.geoServiceUrl||""),this.geocodeServiceUrl.setValue(a.geocodeServiceUrl||""),this.routeServiceUrl.setValue(a.routeServiceUrl||""),this.printTaskUrl.setValue(a.printTaskUrl||""),this.proxyUrl.value=a.proxyUrl||"",this.appId.value=a.appId||"",this.themeRepo.value=a.themeRepo||"",this.widgetRepo.value=a.widgetRepo||"",this.itemId=a.itemId||"",this.localeSelect.set("value",a.locale||""),this.currentPortalUrl=this.portalUrl.value)}),
b.hitch(this,function(a){this.shelter.hide()}))},_requestPortal:function(){var a=this.portalUrl.value;a.endWith("/")||(a+="/");return f({sync:!0,url:a+"sharing/rest/portals/self?f\x3dpjson",handleAs:"json",callbackParamName:"callback",timeout:1E4},{useProxy:!1})},_verified:function(){this.shelter.show();var a=new h;if(p.isSamePortalUrl(this.portalUrl.value,this.currentPortalUrl)){this.shelter.hide();var c=setTimeout(b.hitch(this,function(){clearTimeout(c);a.resolve(this.itemId)}),500)}else this._requestPortal().then(b.hitch(this,
function(){u.getDefaultWebMap(this.portalUrl.value).then(b.hitch(this,function(b){a.resolve(b)}),b.hitch(this,function(){a.reject(this.nls.webMapError+": "+this.portalUrl.value)})).always(b.hitch(this,function(){this.shelter.hide()}))}),b.hitch(this,function(b){this.shelter.hide();a.reject(this.nls.loadServiceError)}));return a},_loadAndSaveHelperServices:function(){this.shelter.show();this._requestPortal().then(b.hitch(this,function(a){if(a=a.helperServices){var c=[],d=this._onlineGeometryUrl;a.geometry&&
a.geometry.url&&(d=a.geometry.url);c.push({name:"geoServiceUrl",newValue:d});d=this._onlineGeocodeUrl;if(a.geocode&&0<a.geocode.length){var g=a.geocode[0];g&&g.url&&(d=g.url)}c.push({name:"geocodeServiceUrl",newValue:d});d=this._onlinePrintTaskUrl;a.printTask&&a.printTask.url&&(d=a.printTask.url);c.push({name:"printTaskUrl",newValue:d});d=this._onlineRouteUrl;a.route&&a.route.url&&(d=a.route.url);c.push({name:"routeServiceUrl",newValue:d});0<c.length&&s.forEach(c,b.hitch(this,function(a){this[a.name].setValue(a.newValue)}))}this.shelter.hide()}),
b.hitch(this,function(a){this.shelter.hide();new k({message:this.nls.loadServiceError})}))},_onAdvancedClick:function(a){this.adSettings.toggleClass("advanced-setting-hide");this.adSettings.every(function(a,b){return!w.contains(a,"advanced-setting-hide")})?a.target.value=this.nls.hideAdSetting:a.target.value=this.nls.showAdSetting},_onGeometryServiceFetch:function(a){if(a.url){var b=a.url.split("/");if("geometryserver"===b[b.length-1].toLowerCase()){a.deferred.resolve("valid");return}}a.deferred.reject("invalid")},
_onGeometryServiceFetchError:function(a){new k({message:this.nls.geometryServiceError})},_getContent:function(){var a=p.getStandardPortalUrl(b.trim(this.portalUrl.value)),c=b.trim(this.geoServiceUrl.value),d=b.trim(this.geocodeServiceUrl.value),g=b.trim(this.routeServiceUrl.value),e=b.trim(this.printTaskUrl.value),f=b.trim(this.proxyUrl.value),h=b.trim(this.bing.value),k=b.trim(this.appId.value),l=b.trim(this.widgetRepo.value),m=b.trim(this.themeRepo.value),n=this.localeSelect.get("value");return{portalUrl:"http://"===
a?"":a,geoServiceUrl:"http://"===c?"":c,geocodeServiceUrl:"http://"===d?"":d,routeServiceUrl:"http://"===g?"":g,printTaskUrl:"http://"===e?"":e,proxyUrl:"http://"===f?"":f,locale:n,bing:"http://"===h?"":h,appId:k,widgetRepo:l,themeRepo:m}},save:function(a){var c=new h;this._verified().then(b.hitch(this,function(d){a||(a=this._getContent());a.geoServiceUrl?(d&&b.mixin(a,{itemId:d}),f({url:"/builder/rest/settings/update",handleAs:"json",content:a},{usePost:!0}).then(b.hitch(this,function(a){a.success?
(this.proxyUrl.value&&(esri.config.defaults.io.proxyUrl=this.proxyUrl.value),c.resolve()):c.reject()}),b.hitch(this,function(){c.reject()}))):c.reject(this.nls.geometryServiceError)}),b.hitch(this,function(a){c.reject(a)}));return c}})});