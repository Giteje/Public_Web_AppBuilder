//>>built
require({cache:{"url:builder/config/templates/WidgetChoosePage.html":'\x3cdiv class\x3d"widget-choose-page"\x3e\r\n  \r\n  \x3cdiv class\x3d"section search" data-dojo-attach-point\x3d"searchSectionNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"searchInputNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"list widget-list" data-dojo-attach-point\x3d"widgetListNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/request/xhr dojo/topic dojo/aspect dojo/on dojo/Deferred dojo/promise/all dojo/mouse dojo/query dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/WidgetChoosePage.html jimu/dijit/Search jimu/WidgetManager jimu/dijit/LoadingShelter jimu/dijit/Message jimu/utils ../serviceUtils ../utils".split(" "),function(n,d,b,e,z,p,A,g,q,r,B,h,C,s,t,u,v,w,x,k,l,m,y){return n([s,t],{templateString:u,postMixInProperties:function(){this.nls=
d.mixin({},builderNls.common);this.widgetManager=w.getInstance()},startup:function(){this.inherited(arguments);this.searchDijit=new v({placeholder:"Widget Name",onSearch:d.hitch(this,this.searchWidget),searchWhenInput:!0},this.searchInputNode);this._getWidgets();this.own(g(window,"resize",d.hitch(this,this.resize)));setTimeout(d.hitch(this,function(){this.resize()}),100);this.loading=new x({hidden:!0});this.loading.placeAt(this.domNode);this.loading.startup()},searchWidget:function(a){var c;c=""===
a?this.allWidgets:e.filter(this.allWidgets,function(c){if(-1<c.name.toUpperCase().indexOf(a.toUpperCase()))return!0});this._createWidgetNodes(c)},resize:function(){var a=b.getContentBox(this.domNode).h-50-10,c=a-60;b.setStyle(this.searchSectionNode,{height:a+"px"});b.setStyle(this.widgetListNode,{height:c+"px"})},setAppConfig:function(a){this.appConfig=a},_getWidgets:function(){var a={};this.appConfig.map["2D"]&&(a.support2D=!0);this.appConfig.map["3D"]&&(a.support3D=!0);this.appConfig.map["2D"]&&
this.appConfig.map["3D"]&&(a.support2D=!0,a.support3D=!0);a["properties.inPanel"]=!0;m.searchWidgets(a).then(d.hitch(this,function(a){a.success&&(this.allWidgets=a.widgets,this._createWidgetNodes(this.allWidgets))}))},_createWidgetNodes:function(a){b.empty(this.widgetListNode);e.forEach(a,function(a){l.processManifest(a,window.builderNls._locale);this._createWidgetNode(a)},this)},_createWidgetNode:function(a){var c,f;c=b.create("div",{"class":"widget-node"},this.widgetListNode);f=b.create("div",{"class":"box"},
c);b.create("div",{"class":"box-border"},c);b.create("img",{"class":"icon",src:a.icon},f);b.create("div",{"class":"label",innerHTML:a.label,title:a.label},c);c.setting={name:a.name,label:a.label};c.setting=d.mixin(c.setting,a.properties);c.setting.icon=y.getAppWidgetPath(appId,a.name)+"images/icon.png";c.setting.uri="widgets/"+a.name+"/Widget";l.processWidgetSetting(c.setting);c.box=f;this.own(g(c,"click",d.hitch(this,this._onWidgetClick,c)));return c},_onWidgetClick:function(a){"addBtn"===this.fromNode.type?
b.hasClass(a,"jimu-state-selected")?b.removeClass(a,"jimu-state-selected"):b.addClass(a,"jimu-state-selected"):(h(".jimu-state-selected",this.domNode).removeClass("jimu-state-selected"),b.addClass(a,"jimu-state-selected"))},onOk:function(){var a=h(".jimu-state-selected",this.domNode);if(0===a.length)new k({message:"Please select widget."});else{this.loading.show();var c=e.map(a,function(a){return d.clone(a.setting)}),b=[];e.forEach(c,function(a){b.push(this._copyWidget(a))},this);r(b).then(d.hitch(this,
function(a){var b;for(b=0;b<a.length;b++)if(!a[b].success){new k({message:a[b].message});this.loading.hide();return}this.loading.hide();p.publish("widgetChoosePageOk",c,this.fromNode);this.popup.close()}))}},_copyWidget:function(a){var c=0,b;this.appConfig.visitElement(d.hitch(this,function(b){b.name===a.name&&c++}));0===c?(a.label=a.label,b=m.copyWidgetToApp(appId,a.name,a.label)):0<c&&(b=new q,a.label=a.label+"_"+(c+1),b.resolve({success:!0}));return b}})});