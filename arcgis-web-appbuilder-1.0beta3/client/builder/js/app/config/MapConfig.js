//>>built
require({cache:{"url:builder/config/templates/MapConfig.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"map-info-section"\x3e\r\n\t\t\x3cdiv class\x3d"map-info map-selected-section" data-dojo-attach-point\x3d"mapSelectedSection" style\x3d"display:block;"\x3e\r\n\t\t\t\x3cdiv class\x3d"map-selected-meta-data"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"map-selected-img" data-dojo-attach-point\x3d"divMapSelectedImg" data-dojo-attach-event\x3d"click:_showMapSelector"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"detail-info"\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"overflow:hidden;"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"web-map-icon" style\x3d"float:left;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv style\x3d"float:right;width:140px;"\x3e\r\n\t\t\t\t\t\t\t\x3cspan style\x3d"float:left;margin-left:5px;"\x3eWeb Map by\x3c/span\x3e\r\n\t\t\t\t\t\t\t\x3ca data-dojo-attach-point\x3d"owner" href\x3d"#" target\x3d"_blank" style\x3d"display:block;color:#15a4fa;text-decoration:none;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"margin-top:5px;"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.lastModified}:\x3c/span\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lastModified" style\x3d"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"margin-top:5px;"\x3e\r\n\t\t\t\t\t\t\x3ca data-dojo-attach-point\x3d"webMapDetails" href\x3d"#" target\x3d"_blank" style\x3d"text-decoration:none;color:#15a4fa;"\x3e${nls.moreDetails}...\x3c/a\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv nowrap class\x3d"map-config-btn choose-map-btn" title\x3d"${nls.changeMap}" data-dojo-attach-event\x3d"click:_showMapSelector"\x3e${nls.changeMap}\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"map-info-title" data-dojo-attach-point\x3d"mapTitle"\x3e\x3c/div\x3e\r\n\t\t\t\x3cp class\x3d"snippet" data-dojo-attach-point\x3d"snippet"\x3e\x3c/p\x3e\r\n\t\t\t\x3cp class\x3d"statement"\x3e${nls.statement}\x3c/p\x3e\r\n\t\t\t\x3cspan class\x3d"map-config-btn" data-dojo-attach-point\x3d"btnInitialExtent" style\x3d"margin-top:15px;"\x3e${nls.setInitialExtent}\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"map-config-btn" data-dojo-attach-point\x3d"restore"  style\x3d"margin-top:15px;"data-dojo-attach-event\x3d"onClick:_restoreToDefaultWebMapExtent"\x3e${nls.restoreInitialExtent}\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/MapConfig.html dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys builder/portalUtils jimu/portalUrlUtils jimu/dijit/Message jimu/utils esri/geometry/Extent jimu/dijit/Popup ./MapSelector".split(" "),function(k,d,l,m,n,b,w,e,p,h,q,r,s,t,x,u,v){return k([l,m],{templateString:n,baseClass:"map-config",currentItemId:null,appConfig:null,map:null,postMixInProperties:function(){this.nls=b.mixin({},
builderNls.common);this.nls=b.mixin(this.nls,builderNls.mapConfig)},postCreate:function(){this.inherited(arguments);this._init()},_init:function(){this.own(d.subscribe("mapLoaded",b.hitch(this,function(a){this._setMap(a)})));this.own(d.subscribe("mapChanged",b.hitch(this,function(a){this._setMap(a);this._restoreToDefaultWebMapExtent()})));this.own(p(this.btnInitialExtent,"click",b.hitch(this,this._onBtnInitialExtentClicked)))},_setInitialExtent:function(){try{d.publish("configChanged","map",{mapOptions:{extent:this.map.extent.toJson()}},
{reCreateMap:!1})}catch(a){}},_blinkMapContainer:function(){var a=0,c=setInterval(b.hitch(this,function(){e.toggleClass(this.map.container,"toggle-map-border");a++;6===a&&clearInterval(c)}),200)},_onBtnInitialExtentClicked:function(){this.map&&(this._setInitialExtent(),this._blinkMapContainer())},_restoreToDefaultWebMapExtent:function(a){t.restoreToDefaultWebMapExtent(this.map,this.map.webMapResponse,this.appConfig&&this.appConfig.geometryService).then(b.hitch(this,function(){this._setInitialExtent();
a&&this._blinkMapContainer()}),b.hitch(this,function(a){"string"===typeof a&&new s({message:a})}))},_showMapSelector:function(){var a=new v,c=new u({width:1024,titleLabel:this.nls.selectWebMap,content:a,container:"main-page",onClose:b.hitch(this,function(){a=null;return!0}),buttons:[{label:this.nls.ok,key:h.ENTER,onClick:b.hitch(this,function(){var b=a.getSelectedMapItem();c.close();a=null;this._selectItem(b)})},{label:this.nls.cancel,key:h.ESCAPE,onClick:b.hitch(this,function(){c.close();a=null})}]})},
_selectItem:function(a){a&&(this._hasSameWebMap(this.appConfig,{map:{portalUrl:a.portalUrl,itemId:a.id}})||d.publish("configChanged","map",{portalUrl:a.portalUrl,itemId:a.id}))},_hasSameWebMap:function(a,b){var f=a&&a.map,d=f&&f.itemId,g=b&&b.map,e=g&&g.itemId;return(f=r.isSamePortalUrl(f&&f.portalUrl,g&&g.portalUrl))&&d===e},_setMap:function(a){this.map=a},setAppConfig:function(a){if(this.appConfig){var b=this._hasSameWebMap(this.appConfig,a);this.appConfig=a;b||this._requestCurrentItem()}else this.appConfig=
a,this._requestCurrentItem()},_requestCurrentItem:function(){var a=this.appConfig&&this.appConfig.map&&this.appConfig.map.itemId;if(a){var a={q:"id:"+a,num:1,f:"json"},c=q.getPortal(this.appConfig.map&&this.appConfig.map.portalUrl);c&&c.queryItems(a).then(b.hitch(this,function(a){this.domNode&&(a=a.results,0<a.length&&this._showSelectedWebMap(a[0]))}),b.hitch(this,function(a){}))}},_showSelectedWebMap:function(a){a.thumbnailUrl&&e.setStyle(this.divMapSelectedImg,"backgroundImage","url("+a.thumbnailUrl+
")");this.snippet.innerHTML=a.snippet||"";this.lastModified.innerHTML=(new Date(a.modified)).toLocaleDateString();this.lastModified.title=this.lastModified.innerHTML;this.webMapDetails.href=a.detailsPageUrl;this.owner.innerHTML=a.owner||"";this.owner.title=this.owner.innerHTML;this.owner.href=a.ownerPageUrl||"";this.mapTitle.innerHTML=a.title;e.setStyle(this.mapSelectedSection,"display","block")}})});