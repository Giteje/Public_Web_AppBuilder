//>>built
require({cache:{"builder/ConfigApp":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/cookie dojo/topic dojo/io-query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/ConfigApp.html ./config/LeftPane ./utils ./serviceUtils jimu/utils jimu/WidgetManager jimu/dijit/ViewStack esri/urlUtils esri/geometry/Extent esri/tasks/GeometryService esri/config esri/urlUtils dojo/request dijit/registry builder/tokenUtils".split(" "),function(q,c,b,g,
l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z){return q([p,m],{templateString:f,baseClass:"config-app",_PreviewMoreIframeSrc:"",_isPortrait:!0,_deviceInfo:null,appId:null,label:"config",postCreate:function(){this.inherited(arguments);this.own(l(this.viewerNode,"load",c.hitch(this,function(){window.configWindow=this.viewerNode.contentWindow})));this.own(l(this.viewer2Node,"load",c.hitch(this,function(){window.previewWindow=this.viewer2Node.contentWindow})));this.viewStack=new w({viewType:"dom",views:[this.previewConfig,
this.previewMore]});g.addClass(this.viewStack.domNode,"preview-viewstack");g.place(this.viewStack.domNode,this.rightPreviewSection);this._showPreviewConfig();this._republishBuilderEvents();this.own(s.subscribe("showPreviewConfig",c.hitch(this,function(){this._showPreviewConfig()})));this.own(s.subscribe("showPreviewMore",c.hitch(this,function(){this._showPreviewMore()})));this.own(s.subscribe("onDeviceSelected",c.hitch(this,this.onDeviceSelected)));this.own(l(this.btnPortrait,"click",c.hitch(this,
function(){this._resizePreviewMore(!0)})));this.own(l(this.btnLandscape,"click",c.hitch(this,function(){this._resizePreviewMore(!1)})));this._createLeftPane();this.widgetManager=u.getInstance();window.setConfigViewerTopic=c.hitch(this,function(a){this.configViewerTopic=a;this.own(this.configViewerTopic.subscribe("appConfigLoaded",c.hitch(this,this.onAppConfigLoaded)));this.own(this.configViewerTopic.subscribe("appConfigChanged",c.hitch(this,this.onAppConfigChanged)));this.own(this.configViewerTopic.subscribe("mapLoaded",
c.hitch(this,this.onMapLoaded)));this.own(this.configViewerTopic.subscribe("mapChanged",c.hitch(this,this.onMapChanged)));this.own(this.configViewerTopic.subscribe("preloadWidgetsLoaded",c.hitch(this,this.onPreloadWidgetsLoaded)));this.own(this.configViewerTopic.subscribe("mapCreatedFailed",c.hitch(this,this.onMapCreatedFailed)));this.own(this.configViewerTopic.subscribe("configUserSignIn",c.hitch(this,function(a){s.publish("externalUserSignIn",a);this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",
a)})))});window.setPreviewViewerTopic=c.hitch(this,function(a){this.previewViewerTopic=a;var d=c.clone(this.appConfig);d.mode="preview";this.previewViewerTopic.publish("resetConfig",d);this.own(this.previewViewerTopic.subscribe("previewUserSignIn",c.hitch(this,function(a){s.publish("externalUserSignIn",a);this.configViewerTopic.publish("externalUserSignIn",a)})));this.own(this.previewViewerTopic.subscribe("mapLoaded",c.hitch(this,function(){this._copyConfigMapExtent2PreviewExtent()})));window.previewWindow.require("jimu/tokenUtils",
function(a){var y=d.portalUrl;a.setPortalUrl(y);(a=z.getPortalCredential(y))&&this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",a)})});this._updateUrl();this._updateAppId();this.showAppName()},_updateUrl:function(){var a=window.location.href,d=a.indexOf("?"),e=n.queryToObject(a.substr(d+1,a.length));e.id!==this.id&&(e.id||(e=e.apiurl?{apiurl:e.apiurl}:{}),e.id=this.id,a=a.substr(0,d)+"?"+decodeURIComponent(n.objectToQuery(e)),history.pushState&&window.history.pushState({path:a},
"",a))},_createLeftPane:function(){this.leftPane=new t({});this.leftPane.placeAt(this.leftPaneNode)},_updateAppId:function(){window.appId=this.id;var a=v.getAppPathById(this.id);jimuConfig.widgetsPackage={name:"widgets",location:v.getAppWidgetsPackageLoacation(this.id)};jimuConfig.themesPackage={name:"themes",location:v.getAppThemesPackageLoacation(this.id)};var d=x.urlToObject(window.location.href).query||{};delete d.id;d.mode="preview";this._PreviewMoreIframeSrc=v.appendParamsToAppPath(a,d);d.mode=
"config";g.attr(this.viewerNode,"src",v.appendParamsToAppPath(a,d))},setAppId:function(a){if(this.id===a){var d=c.clone(this.leftPane.lastAppConfig);this.leftPane.destroy();this._createLeftPane({appId:a});this._setAppConfig(d,!0);this.configViewerTopic.publish("resetConfig",d)}else this.id=a,g.setStyle(this.leftPane.coverNode,"display",""),this._updateAppId()},showAppName:function(){var a=C.byId("header");"stemapp"===this.id?a.setAppName("stemapp"):this.name?a.setAppName(this.name):r.getAppInfo(this.id).then(c.hitch(this,
function(d){a.setAppName(d.name)}))},_republishBuilderEvents:function(){this.own(s.subscribe("configChanged",c.hitch(this,function(a,d,e){this.configViewerTopic.publish("configChanged",a,d,e)})));this.own(s.subscribe("resetConfig",c.hitch(this,function(a){this.configViewerTopic.publish("resetConfig",a)})));this.own(s.subscribe("themeChanged",c.hitch(this,function(a){this.configViewerTopic.publish("themeChanged",a)})));this.own(s.subscribe("layoutChanged",c.hitch(this,function(a){this.configViewerTopic.publish("layoutChanged",
a)})));this.own(s.subscribe("styleChanged",c.hitch(this,function(a){this.configViewerTopic.publish("styleChanged",a)})));this.own(s.subscribe("actionTriggered",c.hitch(this,function(a,d,e){this.configViewerTopic.publish("actionTriggered",a,d,e)})));this.own(s.subscribe("builderUserSignIn",c.hitch(this,function(a){this.configViewerTopic&&this.configViewerTopic.publish("externalUserSignIn",a);this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",a)})))},startup:function(){this.inherited(arguments);
this.leftPane.startup();this.viewStack.startup()},destroy:function(){d.defaults.geometryService=null;this.leftPane.destroy();this.leftPane=null;this.inherited(arguments)},_getGeomtryServiceByAppConfig:function(a){return new e(a.geometryService)},onAppConfigLoaded:function(a){a=x.reCreateObject(a);d.defaults.geometryService=this._getGeomtryServiceByAppConfig(a);s.publish("appConfigLoaded",a);this._setAppConfig(a,!0);(a=z.getPortalCredential(a.portalUrl))&&this.configViewerTopic.publish("externalUserSignIn",
a)},onMapLoaded:function(a){s.publish("mapLoaded",a)},onMapChanged:function(a){s.publish("mapChanged",a)},onAppConfigChanged:function(a,e,b){a=x.reCreateObject(a);d.defaults.geometryService=this._getGeomtryServiceByAppConfig(a);s.publish("appConfigChanged",a,e,b);this._setAppConfig(a,!1)},onPreloadWidgetsLoaded:function(){s.publish("preloadWidgetsLoaded")},onMapCreatedFailed:function(){s.publish("mapCreatedFailed")},_setAppConfig:function(a,d){this.leftPane.setAppConfig(a,d);this.appConfig=a;window.appConfig=
a},_showPreviewConfig:function(){this.viewStack.switchView(this.previewConfig)},_showPreviewMore:function(){this.viewStack.switchView(this.previewMore);if(!this.viewer2Node.src&&this._PreviewMoreIframeSrc)this._initPreviewMoreViewerPosition(),g.attr(this.viewer2Node,"src",this._PreviewMoreIframeSrc);else{var a=c.clone(this.appConfig);a.mode="preview";this._copyConfigMapExtent2PreviewExtent();this.previewViewerTopic.publish("resetConfig",a)}},_copyConfigMapExtent2PreviewExtent:function(){var a=window.configWindow&&
window.configWindow._viewerMap,d=window.previewWindow&&window.previewWindow._viewerMap;a&&d&&d.setExtent(a.extent)},_initPreviewMoreViewerPosition:function(){var a=g.getMarginBox(this.previewMore);g.setStyle(this.viewer2Container,{width:a.w-220+"px",height:a.h-130+"px"});g.setStyle(this.previewMoreIframeSection,"marginTop","50px")},_setPreviewMoreViewerPosition:function(){var a=g.getMarginBox(this.previewMore).h,d=g.getMarginBox(this.viewer2Container),e=g.getStyle(this.viewer2Container,"paddingTop"),
b=g.getStyle(this.viewer2Container,"paddingBottom"),a=(a-(d.h+e+b))/2;0>a&&(a=0);g.setStyle(this.previewMoreIframeSection,"marginTop",a+"px")},onDeviceSelected:function(a,d){this._deviceInfo=a;g.setStyle(this.previewMoreDes,"display","block");this.previewMoreDes.innerHTML=d?a.width+" x "+a.height:a.title+" "+a.width+" x "+a.height;this._resizePreviewMore(this._isPortrait)},_resizePreviewMore:function(d){var e=window.configWindow&&window.configWindow._viewerMap,b=window.previewWindow&&window.previewWindow._viewerMap,
h=e&&e.extent.toJson();d?this._showPortrait():this._showLandscape();b&&h&&setTimeout(function(){var d=new a(h);b.setExtent(d)},500)},_showPortrait:function(){this._deviceInfo&&(this._isPortrait=!0,g.setStyle(this.viewer2Container,{width:this._deviceInfo.width+44+"px",height:this._deviceInfo.height+44+"px"}),g.addClass(this.btnPortrait,"selected"),g.removeClass(this.btnLandscape,"selected"),this._setPreviewMoreViewerPosition())},_showLandscape:function(){this._deviceInfo&&(this._isPortrait=!1,g.setStyle(this.viewer2Container,
{width:this._deviceInfo.height+44+"px",height:this._deviceInfo.width+44+"px"}),g.removeClass(this.btnPortrait,"selected"),g.addClass(this.btnLandscape,"selected"),this._setPreviewMoreViewerPosition())}})})},"builder/config/LeftPane":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/keys dojo/cookie dojo/request/xhr dojo/aspect dojo/query dojo/json dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/LeftPane.html ./MapConfig ./ThemeConfig ./WidgetConfig ./AttributeConfig ./TabContainer2 ../serviceUtils ../CreateAppNew ../AGOLTemplate/AGOLTemplate jimu/portalUrlUtils jimu/portalUtils jimu/utils jimu/dijit/ViewStack jimu/dijit/Message jimu/dijit/Popup dijit/registry jimu/dijit/QRCode".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z,y,E,H,F,G,D,I){return q([v,r,x],{templateString:u,postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.leftPane);this.nls=c.mixin(this.nls,builderNls.agolTemplate)},postCreate:function(){this.inherited(arguments);this._initPreviewItems();this.themePane=new h({},this.appPaneNode);this.mapPane=new w({},this.mapPaneNode);this.mapPane.startup();this.widgetPane=new a({},this.widgetPaneNode);
this.attributePane=new e({},this.attributePaneNode);this.tab=new d({tabs:[{title:this.nls.themes,content:this.themePane},{title:this.nls.map,content:this.mapPane},{title:this.nls.widgets,content:this.widgetPane},{title:this.nls.attributes,content:this.attributePane}],selected:this.nls.themes},this.tabsNode);this._bindEvents();this.viewStack=new H({viewType:"dom",views:[this.configSection,this.previewSection]});b.place(this.viewStack.domNode,this.content);b.setStyle(this.viewStack.domNode,"width",
"100%");b.setStyle(this.viewStack.domNode,"height","100%");this._showConfigSection();this._showLoadingCover();this._initFootMenu()},_bindEvents:function(){this.own(g.subscribe("leavePage",c.hitch(this,this._onLeavePage)));this.own(l(this.btnPreview,"click",c.hitch(this,this._showPreviewSection)));this.own(l(this.btnConfig,"click",c.hitch(this,this._showConfigSection)));this.own(l(this.btnSave,"click",c.hitch(this,this._onSave)));this.own(l(this.customWidth,"blur",c.hitch(this,this._onCustomSizeChanged)));
this.own(l(this.customHeight,"blur",c.hitch(this,this._onCustomSizeChanged)));this.own(g.subscribe("preloadWidgetsLoaded",c.hitch(this,this._onPreloadWidgetsLoaded)));this.own(g.subscribe("mapCreatedFailed",c.hitch(this,this._onMapCreatedFailed)));this.own(g.subscribe("startChangeTheme",c.hitch(this,this._onStartChangeTheme)))},_onMapChanged:function(a){this.map=a},_onPreloadWidgetsLoaded:function(){this._hideLoadingCover()},_onMapCreatedFailed:function(){this._hideLoadingCover()},_onStartChangeTheme:function(){this._showLoadingCover()},
_showLoadingCover:function(){b.setStyle(this.coverNode,"display","block")},_hideLoadingCover:function(){b.setStyle(this.coverNode,"display","none")},_showConfigSection:function(){b.setStyle(this.btnPreview,"display","block");b.setStyle(this.btnConfig,"display","none");this.viewStack.switchView(this.configSection);g.publish("showPreviewConfig")},_showPreviewSection:function(){b.setStyle(this.btnPreview,"display","none");b.setStyle(this.btnConfig,"display","block");this.viewStack.switchView(this.previewSection);
g.publish("showPreviewMore")},startup:function(){this.inherited(arguments);this.tab.startup();var a="",a=window.isXT?"http://"+window.location.host+path+"apps/"+appId:portalUrl+"apps/webappviewer/index.html?id\x3d"+appId;b.create("a",{href:a,target:"_blank",innerHTML:this.nls.launch},this.btnHomePage);new I({text:a,width:75,height:75},this.qrcodeImage);b.setAttr(this.qrcodeDescription,"innerHTML",this.nls.qrcodeDesc);m(".qrcode-image table").style("margin","0px")},destroy:function(){this.themePane.destroy();
this.mapPane.destroy();this.widgetPane.destroy();this.attributePane.destroy();this.themePane=this.widgetPane=this.mapPane=this.themePane=null;this.inherited(arguments)},_initFootMenu:function(){window.isXT&&(b.setStyle(this.footMenu,"top","-60px"),b.setStyle(this.exportMenu,"display","none"))},_onSave:function(){this._appHasChanged()&&("stemapp"===appId?new F({message:this.nls.canNotSaveMeg}):(b.setAttr(this.btnSave,"innerHTML",this.nls.saving),this._saveApp().then(c.hitch(this,function(a){a.success&&
(this._disableSaveButton(),this._disableUnloadDlg())}),c.hitch(this,function(){this._enableSaveButton()}))))},_onSaveAs:function(){"stemapp"===appId?new F({message:this.nls.canNotSaveMeg}):B.popupDlg({createFromId:appId,appConfig:this.appConfig},this.nls.saveAs)},_onExportAsTemplate:function(){var a={id:appId,name:D.byId("header").getAppName()};y.getPortal(z.getPortalUrlFromLocation()).getItemData(a.id).then(c.hitch(this,function(d){a.agolTemplateJson=d.agolTemplateJson;d=this.appConfig.getCleanConfig();
d=c.clone(d);delete d.agolTemplateJson;d.visitElement=this.appConfig.visitElement;d.visitElement(function(a){!a.widgets&&(a.uri&&void 0===a.visible)&&(a.visible=!0)});delete d.visitElement;delete d._buildInfo;d=new C({appConfig:d,fullAppConfig:this.appConfig,app:a});new G({content:d,container:"main-page",titleLabel:this.nls.title,width:1040,height:625,buttons:[{label:this.nls.download,key:k.ENTER,onClick:c.hitch(d,d._onExportClick)},{label:this.nls.saved,key:k.ENTER,onClick:c.hitch(d,d._onSaveClick)},
{label:this.nls.cancel,key:k.ESCAPE,onClick:c.hitch(d,d._onCancelClick)}]});d.startup()}))},_enableSaveButton:function(){b.addClass(this.btnSave,"save-enable");b.setStyle(this.btnSave,"cursor","pointer");b.setAttr(this.btnSave,"innerHTML",this.nls.save)},_disableSaveButton:function(){b.removeClass(this.btnSave,"save-enable");b.setStyle(this.btnSave,"cursor","default");b.setAttr(this.btnSave,"innerHTML",this.nls.saved)},_saveApp:function(){var a=new t;A.saveApp(appId,this.appConfig.getCleanConfig()).then(c.hitch(this,
function(d){d.success?(this.lastAppConfig=c.clone(this.appConfig),a.resolve(d),(d=main.getViewByLabel("apps"))&&window.isXT&&d.refresh()):(new F({message:this.nls.saveFailedMeg+": "+d.message}),a.reject())}),c.hitch(this,function(d){new F({message:this.nls.saveFailedMeg});console.error(d);a.reject()}));return a},setAppConfig:function(a,d){this.appConfig=a;this.themePane.setAppConfig(a,d);this.mapPane.setAppConfig(a,d);this.widgetPane.setAppConfig(a,d);this.attributePane.setAppConfig(a,d);d&&(this.lastAppConfig=
c.clone(a));this._appHasChanged()?(this._enableSaveButton(),this._enableUnloadDlg()):(this._disableSaveButton(),this._disableUnloadDlg())},_hideAllContent:function(){b.setStyle(this.mapPane.domNode,"display","none");b.setStyle(this.widgetPane.domNode,"display","none");b.setStyle(this.themePane.domNode,"display","none")},_initPreviewItems:function(){b.empty(this.previewTbody);var a=[];a.push({"class":"iPhone6",title:"iPhone6",width:375,height:667});a.push({"class":"iPhone6-plus",title:"iPhone6 plus",
width:414,height:736});a.push({"class":"iPhone5",title:"iPhone5/5C/5S",width:320,height:568});a.push({"class":"iPhone4",title:"iPhone4/4S",width:320,height:480});a.push({"class":"iPad-Air",title:"iPad Air",width:768,height:1024});a.push({"class":"iPad4",title:"iPad with Retina Display",width:768,height:1024});a.push({"class":"new-iPad",title:"The New iPad",width:768,height:1024});a.push({"class":"iPad-mini",title:"iPad Mini",width:768,height:1024});a.push({"class":"Samsung-Galaxy-S4",title:"Samsung Galaxy S4",
width:360,height:640});a.push({"class":"Samsung-Note-3",title:"Samsung Note 3",width:360,height:640});a.push({"class":"Nexus-5",title:"Nexus 5",width:360,height:598});a.push({"class":"Nexus-4",title:"Nexus 4",width:384,height:598});a.push({"class":"Nexus-7",title:"Nexus 7",width:600,height:960});a.push({"class":"htc-one",title:"HTC One",width:360,height:640});a.push({"class":"xiaomi-3",title:"Xiaomi 3",width:360,height:640});a.push({"class":"LG-G2",title:"LG G2",width:360,height:598});var d=Math.ceil(a.length/
4),e;for(e=0;e<d;e++){var y=b.toDom("\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e");b.place(y,this.previewTbody)}d=m("td",this.previewTbody);for(e=0;e<a.length;e++){var y=d[e],h=this._createPreviewItem(a[e]);b.place(h,y)}},_createPreviewItem:function(a){var d=b.toDom('\x3cdiv class\x3d"preview-item"\x3e\x3cdiv class\x3d"preview-item-bg"\x3e\x3cdiv class\x3d"preview-item-thumbnail"\x3e\x3c/div\x3e\x3cdiv class\x3d"preview-selected-icon"\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"preview-item-title"\x3e\x3c/span\x3e\x3c/div\x3e');
d.args=a;var e=m(".preview-item-bg",d)[0],y=m(".preview-item-thumbnail",d)[0],h=m(".preview-item-title",d)[0];this.own(l(e,"click",c.hitch(this,this._onPreviewItemBgClick)));a["class"]&&b.addClass(y,a["class"]);h.innerHTML=a.title||"";return d},_onPreviewItemBgClick:function(a){a=a.target||a.srcElement;b.hasClass(a,"preview-item-thumbnail")&&(a=a.parentNode,m(".preview-item-bg",this.previewTbody).removeClass("selected"),b.addClass(a,"selected"),a=a.parentNode.args,this.customWidth.value=a.width,this.customHeight.value=
a.height,g.publish("onDeviceSelected",a,!1))},_onCustomSizeChanged:function(){var a=function(a){var d=!1;!isNaN(a)&&!isNaN(parseFloat(a))&&0<parseInt(a,10)&&(d=!0);return d},d=this.customWidth.value,e=this.customHeight.value;a(d)&&a(e)&&(m(".preview-item-bg",this.previewTbody).removeClass("selected"),d=parseInt(d,10),e=parseInt(e,10),g.publish("onDeviceSelected",{width:d,height:e},!0))},_appHasChanged:function(){var a=c.clone(this.appConfig.getCleanConfig()),d=c.clone(this.lastAppConfig.getCleanConfig());
a.theme&&(a.theme.styles&&d.theme&&d.theme.styles)&&(a.theme.styles.splice(1,a.theme.styles.length),d.theme.styles.splice(1,d.theme.styles.length));return!E.isEqual(a,d)},_enableUnloadDlg:function(){window.onbeforeunload=c.hitch(this,function(){return this.nls.theApp+' "'+D.byId("header").getAppName()+'" '+this.nls.unloadMessage})},_disableUnloadDlg:function(){window.onbeforeunload=null},_onLeavePage:function(a){var d=D.byId("header");if(this._appHasChanged())var e=new G({content:"\x3cdiv style\x3d'font-size: 14px'\x3e\x3cimg class\x3d'alert-image'  src\x3d'builder/css/images/alert.png'  style\x3d'float:left;margin-left:12px;margin-right:22px;'\x3e\x3c/img\x3e"+
this.nls.unSaveMegBegin+d.getAppName()+this.nls.unSaveMegEnd+"\x3c/div\x3e",titleLabel:this.nls.toHomeTitle,width:425,height:180,buttons:[{label:this.nls.save,onClick:c.hitch(this,function(){"stemapp"===appId?(new F({message:this.nls.canNotSaveMeg}),e.close()):this._saveApp().then(c.hitch(this,function(y){e.close();y.success&&(window.onbeforeunload=null,d.setAppName(""),a())}),c.hitch(this,function(a){console.error(this.nls.saveFailedMeg,a)}))})},{label:this.nls.doNotSave,onClick:c.hitch(this,function(){e.close();
window.onbeforeunload=null;d.setAppName("");a()})},{label:this.nls.cancel,onClick:c.hitch(this,function(){e.close()})}]});else window.onbeforeunload=null,d.setAppName(""),a()}})})},"builder/config/MapConfig":function(){define("dojo/_base/declare dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/MapConfig.html dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/on dojo/keys builder/portalUtils jimu/portalUrlUtils jimu/dijit/Message jimu/utils esri/geometry/Extent jimu/dijit/Popup ./MapSelector".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h){return q([b,g],{templateString:l,baseClass:"map-config",currentItemId:null,appConfig:null,map:null,widgetsConfigCache:null,postMixInProperties:function(){this.nls=k.mixin({},builderNls.common);this.nls=k.mixin(this.nls,builderNls.mapConfig)},postCreate:function(){this.inherited(arguments);this._init()},_init:function(){this.widgetsConfigCache={};this.own(c.subscribe("mapLoaded",k.hitch(this,function(a){this._setMap(a)})));this.own(c.subscribe("mapChanged",
k.hitch(this,function(a){this._setMap(a);this._restoreToDefaultWebMapExtent()})));this.own(m(this.btnInitialExtent,"click",k.hitch(this,this._onBtnInitialExtentClicked)))},_setInitialExtent:function(){try{c.publish("configChanged","map",{mapOptions:{extent:this.map.extent.toJson()}},{reCreateMap:!1})}catch(a){console.error(a)}},_blinkMapContainer:function(){var a=0,e=setInterval(k.hitch(this,function(){n.toggleClass(this.map.container,"toggle-map-border");a++;6===a&&clearInterval(e)}),200)},_onBtnInitialExtentClicked:function(){this.map&&
(this._setInitialExtent(),this._blinkMapContainer())},_restoreToDefaultWebMapExtent:function(a){x.restoreToDefaultWebMapExtent(this.map,this.map.webMapResponse,this.appConfig&&this.appConfig.geometryService).then(k.hitch(this,function(){this._setInitialExtent();a&&this._blinkMapContainer()}),k.hitch(this,function(a){"string"===typeof a&&new r({message:a});console.error(a)}))},_showMapSelector:function(){var a=new h,e=new w({width:1024,titleLabel:this.nls.selectWebMap,content:a,container:"main-page",
onClose:k.hitch(this,function(){try{a&&a.domNode&&a.destroy()}catch(d){console.error(d)}a=null;return!0}),buttons:[{label:this.nls.ok,key:f.ENTER,onClick:k.hitch(this,function(){var d=a.getSelectedMapItem();this._selectItem(d,e)})},{label:this.nls.cancel,key:f.ESCAPE,onClick:k.hitch(this,function(){e.close()})}]})},_selectItem:function(a,e){if(a)if(this._hasSameWebMap(this.appConfig,{map:{portalUrl:a.portalUrl,itemId:a.id}}))e.close();else{var d=k.clone(this.appConfig);d.map.portalUrl=a.portalUrl;
d.map.itemId=a.id;var b=this._tryResetWidgetsConfigWhenMapSwitched(d);if(0<b.length){var b=s.map(b,k.hitch(this,function(a){return a.label})),h=n.toDom("\x3cdiv style\x3d'font-size:14px;line-height:22px;'\x3e\x3cdiv\x3e"+this.nls.mapSwitchConfimationTip+"\x3c/div\x3e\x3cdiv style\x3d'margin-top:25px;margin-bottom:20px;color:#596679;'\x3e"+this.nls.theseWidgetsAre+":\x3c/div\x3e\x3cdiv class\x3d'reset-widget-list' style\x3d'color:#596679;'\x3e\x3c/div\x3e\x3cdiv style\x3d'margin-top:25px;'\x3e"+this.nls.sureToSwitch+
"\x3c/div\x3e\x3c/div\x3e"),f=p(".reset-widget-list",h)[0];s.forEach(b,k.hitch(this,function(a,d){var e=n.create("div",{innerHTML:a},f);0!==d&&(e.style.marginTop="10px")}));var z=new w({content:h,titleLabel:this.nls.mapSwitchConfimation,autoHeight:!0,width:640,buttons:[{label:this.nls.ok,onClick:k.hitch(this,function(){e.close();z.close();c.publish("resetConfig",d)})},{label:this.nls.cancel,onClick:k.hitch(this,function(){z.close()})}]})}else e.close(),c.publish("configChanged","map",{portalUrl:a.portalUrl,
itemId:a.id})}},_hasSameWebMap:function(a,e){var d=a&&a.map,b=d&&d.itemId,h=e&&e.map,c=h&&h.itemId;return(d=v.isSamePortalUrl(d&&d.portalUrl,h&&h.portalUrl))&&b===c},_setMap:function(a){this.map=a},setAppConfig:function(a){this._cacheWidgetsConfig(a);if(this.appConfig){var e=this._hasSameWebMap(this.appConfig,a);this.appConfig=a;e||this._requestCurrentItem()}else this.appConfig=a,this._requestCurrentItem()},_cacheWidgetsConfig:function(a){a=k.clone(a);var e=v.getItemUrl(a.map.portalUrl||a.portalUrl,
a.map.itemId),e=v.setHttpProtocol(e),d={};this.widgetsConfigCache[e]=d;e=a.widgetOnScreen&&a.widgetOnScreen.widgets;a=a.widgetPool&&a.widgetPool.widgets;e&&0<e.length&&s.forEach(e,k.hitch(this,function(a){d[a.id]=a.config}));a&&0<a.length&&s.forEach(a,k.hitch(this,function(a){d[a.id]=a.config}))},_tryResetWidgetsConfigWhenMapSwitched:function(a){var e=v.getItemUrl(a.map.portalUrl||a.portalUrl,a.map.itemId),e=v.setHttpProtocol(e),d=this.widgetsConfigCache[e],e=a.widgetPool&&a.widgetPool.widgets;a=
s.filter(a.widgetOnScreen&&a.widgetOnScreen.widgets,k.hitch(this,function(a){return!1===a.keepConfigAfterMapSwithched}));e=s.filter(e,k.hitch(this,function(a){return!1===a.keepConfigAfterMapSwithched}));a=a.concat(e);var b=[];s.forEach(a,k.hitch(this,function(a){var e=a.config,h=d&&d[a.id];h?a.config=h:delete a.config;h=a.config;(e||h)&&b.push(a)}));return b},_requestCurrentItem:function(){var a=this.appConfig&&this.appConfig.map&&this.appConfig.map.itemId;if(a){var a={q:"id:"+a,num:1,f:"json"},e=
t.getPortal(this.appConfig.map&&this.appConfig.map.portalUrl);e&&e.queryItems(a).then(k.hitch(this,function(a){this.domNode&&(a=a.results,0<a.length&&this._showSelectedWebMap(a[0]))}),k.hitch(this,function(a){console.debug("query item from portal failed",a)}))}},_showSelectedWebMap:function(a){a.thumbnailUrl&&n.setStyle(this.divMapSelectedImg,"backgroundImage","url("+a.thumbnailUrl+")");this.snippet.innerHTML=a.snippet||"";this.lastModified.innerHTML=(new Date(a.modified)).toLocaleDateString();this.lastModified.title=
this.lastModified.innerHTML;this.webMapDetails.href=a.detailsPageUrl;this.owner.innerHTML=a.owner||"";this.owner.title=this.owner.innerHTML;this.owner.href=a.ownerPageUrl||"";this.mapTitle.innerHTML=a.title;n.setStyle(this.mapSelectedSection,"display","block")}})})},"builder/portalUtils":function(){define(["jimu/BasePortalUtils","builder/tokenUtils"],function(q,c){var b=new q;b.declaredClass="builder.PortalUtils";b.setTokenUtils(c);return b})},"builder/tokenUtils":function(){define(["jimu/BaseTokenUtils",
"dojo/topic"],function(q,c){var b=new q;b.declaredClass="builder.TokenUtils";b.isRightWindowScope=function(){return this.isInBuilderWindow()};b.tryPublishUserSignInToExternal=function(b){this.isRightWindowScope()&&c.publish("builderUserSignIn",b)};b.tryPublishUserSignOutToExternal=function(b){this.isRightWindowScope()&&c.publish("builderUserSignOut",b)};b.startup();return b})},"builder/config/MapSelector":function(){define("dojo/_base/declare dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/MapSelector.html dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/on jimu/utils jimu/dijit/TabContainer3 builder/portalUtils jimu/portalUrlUtils jimu/dijit/Search builder/config/MapTable".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h){return q([b,g,l],{templateString:k,baseClass:"map-selector",tab:null,isPublicTabShow:!1,_user:null,_group:null,_webMapQueryString:"",_allPublicPortalQuery:null,_filterPublicPortalQuery:null,_allPublicOnlineQuery:null,_filterPublicOnlineQuery:null,_allOrganizationQuery:null,_filterOrganizationQuery:null,_allMyContentQuery:null,_filterMyContentQuery:null,_allGroupQuery:null,_filterGroupQuery:null,_signIn:!1,portal:null,postMixInProperties:function(){this.nls=
n.mixin({},builderNls.common);this.nls=n.mixin(this.nls,builderNls.mapConfig)},postCreate:function(){this.inherited(arguments);this._webMapQueryString=" "+v.getItemQueryStringByTypes(["Web Map"])+" ";this.portal=x.getPortal(this._getPortalUrl());this._initSearchQuery();this._initTabs();this._initPortalRadio();this._initMapTables();this._initPrivate();this._initPublic();this._bindMapTableEvents();this._updateUIbySignIn()},startup:function(){this.tab._started||(this.tab.startup(),this.tab._started=
!0)},_initTabs:function(){var a={title:this.nls.myContent,content:this.mycontentTabNode},e={title:this.nls.myOrganization,content:this.organizationTabNode},d={title:this.nls.myGroup,content:this.groupTabNode},b={title:this.nls.publicMap,content:this.publicTabNode};this.isPublicTabShow=!1;this.tab=new r({tabs:[a,e,d,b]},this.tabNode);this.own(t(this.tab,"tabChanged",n.hitch(this,function(a){m.setStyle(this.signinSection,"display","none");a!==this.nls.publicMap?(this.isPublicTabShow=!1,this._updateUIbySignIn()):
this.isPublicTabShow=!0})))},_bindMapTableEvents:function(){this.own(t(this.mycontentMapTable,"select",n.hitch(this,this._onMapSelected)));this.own(t(this.organizationMapTable,"select",n.hitch(this,this._onMapSelected)));this.own(t(this.groupMapTable,"select",n.hitch(this,this._onMapSelected)));this.own(t(this.publicPortalMapTable,"select",n.hitch(this,this._onMapSelected)));this.own(t(this.publicOnlineMapTable,"select",n.hitch(this,this._onMapSelected)))},_onMapSelected:function(a){if(a=a&&a.selectedNode)this.mycontentMapTable.unselect(),
this.organizationMapTable.unselect(),this.groupMapTable.unselect(),this.publicPortalMapTable.unselect(),this.publicOnlineMapTable.unselect(),m.addClass(a,"selected")},_updateUIbySignIn:function(){m.setStyle(this.signinSection,"display","none");var a=f(".organization-tab-content-main,.group-tab-content-main,.mycontent-tab-content-main",this.domNode);this.portal.haveSignIn()?a.style("display","block"):(a.style("display","none"),this.isPublicTabShow||m.setStyle(this.signinSection,"display","block"))},
_initPortalRadio:function(){var a=this._getPortalUrl(),a=u.getServerByUrl(a);u.isArcGIScom(a)?(this.portalPublicRaido.disabled=!0,this.onlinePublicRaido.checked=!0,m.setStyle(this.portalPublicRaido,"display","none"),m.setStyle(this.portalServer,"display","none")):(this.portalPublicRaido.disabled=!1,this.portalPublicRaido.checked=!0,this.portalServer.innerHTML=a)},_initSearchQuery:function(){var a="esri_"+(s.locale&&s.locale.slice(0,2)||"en").toLowerCase(),e=p.filter("esri_he esri_fr esri_ja esri_nl esri_th esri_tr esri_nb esri_ro esri_it esri_pl esri_po esri_ru esri_pt esri_en esri_ar esri_et esri_es esri_ko esri_cs esri_da esri_zh esri_sv esri_lt esri_fi esri_lv esri_de".split(" "),
n.hitch(this,function(d){return d!==a})),d="";p.forEach(e,n.hitch(this,function(a){d+=" -owner:"+a+" "}));e=" ";this.portal.user&&this.portal.user.orgId&&(e=" orgid:"+this.portal.user.orgId+" ");e=e+this._webMapQueryString+" AND access:public "+d;this._allPublicPortalQuery=this._getQuery({sortField:"numViews",sortOrder:"desc",q:e});this._filterPublicPortalQuery=this._getQuery({q:e,basicQ:e});this._allPublicOnlineQuery=this._getQuery({sortField:"numViews",sortOrder:"desc",q:'(group:"c755678be14e4a0984af36a15f5b643e" OR group:"b8787a74b4d74f7fb9b8fac918735153") '+
this._webMapQueryString+" AND access:public"});this._filterPublicOnlineQuery=this._getQuery({q:this._webMapQueryString+" AND access:public"});this._allOrganizationQuery=this._getQuery();this._filterOrganizationQuery=this._getQuery();this._allMyContentQuery=this._getQuery();this._filterMyContentQuery=this._getQuery();this._allGroupQuery=this._getQuery();this._filterGroupQuery=this._getQuery()},_getQuery:function(a){return n.mixin({start:1,num:16,f:"json"},a||{})},_getPortalUrl:function(){return u.getStandardPortalUrl(window.portalUrl)},
_initMapTables:function(){var a=this._getPortalUrl();this.portalPublicRaido.disabled||(this.publicPortalMapTable.set("portalUrl",a),this.publicPortalMapTable.searchAllMaps(this._allPublicPortalQuery),this.publicPortalMapTable.set("filteredQuery",this._filterPublicPortalQuery));this.publicOnlineMapTable.set("portalUrl","http://www.arcgis.com");this.publicOnlineMapTable.searchAllMaps(this._allPublicOnlineQuery);this.publicOnlineMapTable.set("filteredQuery",this._filterPublicOnlineQuery)},_initPublic:function(){this.own(t(this.portalPublicRaido,
"click",n.hitch(this,this._onPublicRaidoClicked)));this.own(t(this.onlinePublicRaido,"click",n.hitch(this,this._onPublicRaidoClicked)));this._onPublicRaidoClicked()},_onPublicRaidoClicked:function(){this.portalPublicRaido.checked?(this.publicPortalMapTable.show(),this.publicOnlineMapTable.hide()):this.onlinePublicRaido.checked&&(this.publicPortalMapTable.hide(),this.publicOnlineMapTable.show())},_onPublicSearch:function(a){(a=a&&n.trim(a))?(this.publicPortalMapTable.showFilterMapsSection(),this.publicOnlineMapTable.showFilterMapsSection(),
this.portalPublicRaido.checked?(this._filterPublicPortalQuery.q=a+this._filterPublicPortalQuery.basicQ,this._filterPublicPortalQuery.start=1,this.publicPortalMapTable.searchFilteredMaps(this._filterPublicPortalQuery)):this.onlinePublicRaido.checked&&(this._filterPublicOnlineQuery.q=a+this._webMapQueryString+" AND access:public",this._filterPublicOnlineQuery.start=1,this.publicOnlineMapTable.searchFilteredMaps(this._filterPublicOnlineQuery))):(this.publicPortalMapTable.showAllMapsSection(),this.publicOnlineMapTable.showAllMapsSection())},
_initPrivate:function(){this._resetPortalMaps();this.own(c.subscribe("userSignIn",n.hitch(this,this._onSignIn)));this.own(c.subscribe("userSignOut",n.hitch(this,this._onSignOut)));this.own(t(this.groupsSelect,"change",n.hitch(this,this._onGroupsSelectChange)));var a=u.getServerByUrl(this._getPortalUrl());u.isArcGIScom(a)&&(a="ArcGIS.com");this.signinSection.title=this.nls.signInTo+" "+a;this.portal.haveSignIn()&&this._onSignIn()},_onOrganizationSearch:function(a){if(a=a&&n.trim(a)){if(this._allOrganizationQuery){var e=
this._allOrganizationQuery.q;e&&(this._filterOrganizationQuery.q=a+" "+e,this._filterOrganizationQuery.start=1,this.organizationMapTable.searchFilteredMaps(this._filterOrganizationQuery))}}else this.organizationMapTable.showAllMapsSection()},_onMyContentSearch:function(a){if(a=a&&n.trim(a)){if(this._allMyContentQuery){var e=this._allMyContentQuery.q;e&&(this._filterMyContentQuery.q=a+" "+e,this._filterMyContentQuery.start=1,this.mycontentMapTable.searchFilteredMaps(this._filterMyContentQuery))}}else this.mycontentMapTable.showAllMapsSection()},
_onGroupSearch:function(a){if(a=a&&n.trim(a)){if(this._allGroupQuery){var e=this._allGroupQuery.q;e&&(this._filterGroupQuery.q=a+" "+e,this._filterGroupQuery.start=1,this.groupMapTable.searchFilteredMaps(this._filterGroupQuery))}}else this.groupMapTable.showAllMapsSection()},_onSignIn:function(){this._updateUIbySignIn();this._signIn||(this._signIn=!0,this.portal.getUser().then(n.hitch(this,function(a){this.domNode&&(this._resetPortalMaps(),this._searchOrganization(a),this._searchMyContent(a),this._searchGroups(a))})))},
_onSignOut:function(){this._signIn=!1;this._resetPortalMaps();this._updateUIbySignIn()},_resetPortalMaps:function(){this.organizationMapTable.clear();this.mycontentMapTable.clear();this._resetGroupsSection()},_searchOrganization:function(a){this.organizationMapTable.clear();a=" orgid:"+a.orgId+" AND "+this._webMapQueryString+" AND (access:org OR access:public) ";var e=this._getPortalUrl();this._allOrganizationQuery=this._getQuery({q:a});this._filterOrganizationQuery=this._getQuery({q:a});this.organizationMapTable.set("portalUrl",
e);this.organizationMapTable.searchAllMaps(this._allOrganizationQuery)},_searchMyContent:function(a){this.mycontentMapTable.clear();var e=this._getPortalUrl();a="owner:"+a.username+" AND "+this._webMapQueryString;this._allMyContentQuery=this._getQuery({q:a});this._filterMyContentQuery=this._getQuery({q:a});this.mycontentMapTable.set("portalUrl",e);this.mycontentMapTable.searchAllMaps(this._allMyContentQuery)},_searchGroups:function(a){this._resetGroupsSection();m.setStyle(this.groupsSection,"display",
"block");a=a.getGroups();if(0<a.length){m.setStyle(this.groupSearch.domNode,"display","block");this.groupMapTable.show();m.empty(this.groupsSelect);for(var e=0;e<a.length;e++){var d=a[e];m.create("option",{value:d.id,innerHTML:d.title},this.groupsSelect)}this._onGroupsSelectChange()}this._updateUIbyGroups(a.length)},_resetGroupsSection:function(){m.setStyle(this.groupsSection,"display","none");m.empty(this.groupsSelect);m.create("option",{value:"nodata",innerHTML:this.nls.noneGroups},this.groupsSelect);
this.groupMapTable.clear();m.setStyle(this.groupSearch.domNode,"display","none");this.groupMapTable.hide();this._updateUIbyGroups(0)},_updateUIbyGroups:function(a){0===a?m.setStyle(this.groupsSection,"top","15px"):m.setStyle(this.groupsSection,"top","70px")},_onGroupsSelectChange:function(){var a=this.groupsSelect.value;this.groupMapTable.clear();if("nodata"===a)m.setStyle(this.groupSearch,"display","none"),this.groupMapTable.hide();else{m.setStyle(this.groupSearch,"display","block");this.groupMapTable.show();
var e=this._getPortalUrl(),a="group:"+a+" AND "+this._webMapQueryString;this._allGroupQuery=this._getQuery({q:a});this._filterGroupQuery=this._getQuery({q:a});this.groupMapTable.set("portalUrl",e);this.groupMapTable.searchAllMaps(this._allGroupQuery)}},getSelectedMapItem:function(){var a=null,e=f(".map-item-bg.selected",this.domNode);0<e.length&&(a=e[0].parentNode.item);return a}})})},"builder/config/MapTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/MapTable.html dojo/Evented dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/Deferred dojo/query dojo/on jimu/utils builder/portalUtils jimu/portalUrlUtils jimu/dijit/LoadingIndicator".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u){return q([c,b,g,k],{templateString:l,baseClass:"map-table",query:null,filteredQuery:null,portalUrl:null,hidden:!1,nls:null,originalSelectedId:null,postMixInProperties:function(){this.nls=s.mixin({},builderNls.common);this.nls=s.mixin(this.nls,builderNls.mapConfig)},postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&this.hide();this.portalUrl&&(this.portalUrl=x.getStandardPortalUrl(this.portalUrl));this.own(t(this.allMapsTableDiv,
"scroll",s.hitch(this,this._onAllMapsSectionScroll)));this.own(t(this.filteredMapsTableDiv,"scroll",s.hitch(this,this._onFilteredMapsSectionScroll)));this.showAllMapsSection();this.searchAllMaps()},show:function(){p.setStyle(this.domNode,"display","block")},hide:function(){p.setStyle(this.domNode,"display","none")},searchAllMaps:function(b){this.showAllMapsSection();b&&(this.query=s.mixin({},b),this.query.start=1,this.clearAllMapsSection());this.portalUrl&&this.query&&0<this.query.start&&(this.allMapsShelter.show(),
r.getPortal(this.portalUrl).queryItems(this.query).then(s.hitch(this,function(b){this.domNode&&(this.allMapsShelter.hide(),this.query.start=b.nextStart,this._createMapItems(b,this.allMapsTbody))}),s.hitch(this,function(b){console.error(b);this.domNode&&this.allMapsShelter.hide()})))},searchFilteredMaps:function(b){this.showFilterMapsSection();b&&(this.filteredQuery=s.mixin({},b),this.filteredQuery.start=1,this.clearFilteredMapsSection());this.portalUrl&&this.filteredQuery&&0<this.filteredQuery.start&&
(this.filteredMapsShelter.show(),r.getPortal(this.portalUrl).queryItems(this.filteredQuery).then(s.hitch(this,function(b){this.domNode&&(this.filteredMapsShelter.hide(),this.filteredQuery.start=b.nextStart,this._createMapItems(b,this.filteredMapsTbody),0===this._getWebMapCount(this.filteredMapsTbody)&&(p.setStyle(this.filteredMapsTableDiv,"display","none"),p.setStyle(this.searchNoneTipSection,"display","block")))}),s.hitch(this,function(b){console.error(b);this.domNode&&(this.filteredMapsShelter.hide(),
0===this._getWebMapCount(this.filteredMapsTbody)&&(p.setStyle(this.filteredMapsTableDiv,"display","none"),p.setStyle(this.searchNoneTipSection,"display","block")))})))},clear:function(){this.clearAllMapsSection();this.clearFilteredMapsSection()},clearAllMapsSection:function(){p.empty(this.allMapsTbody)},clearFilteredMapsSection:function(){p.empty(this.filteredMapsTbody)},showAllMapsSection:function(){p.setStyle(this.allMapsSection,"display","block");p.setStyle(this.filteredMapsSection,"display","none")},
showFilterMapsSection:function(){p.setStyle(this.allMapsSection,"display","none");p.setStyle(this.filteredMapsSection,"display","block");p.setStyle(this.filteredMapsTableDiv,"display","block");p.setStyle(this.searchNoneTipSection,"display","none")},_onAllMapsSectionScroll:function(){this._isScrollToBottom(this.allMapsTableDiv)&&this.searchAllMaps()},_onFilteredMapsSectionScroll:function(){this._isScrollToBottom(this.filteredMapsTableDiv)&&this.searchFilteredMaps()},_isScrollToBottom:function(b){return v.isScrollToBottom(b)},
_createMapItems:function(b,h){var a=n.filter(b.results,s.hitch(this,function(a){return"web map"===a.type.toLowerCase()}));if(0!==a.length){var e={},d,c=f("td.empty",h),B;if(0<c.length){var m=a.splice(0,c.length);for(B=0;B<c.length;B++){var z=c[B];d=this._createMapItem(m[B]);e[d.item.id]=d;p.place(d,z);p.removeClass(z,"empty")}}if(0!==a.length){c=Math.ceil(a.length/5);for(B=0;B<c;B++){d=p.toDom("\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e");
p.place(d,h);m=f("td",d);for(z=0;z<m.length;z++){var y=m[z];(d=a[5*B+z])?(d=this._createMapItem(d),e[d.item.id]=d,p.place(d,y)):p.addClass(y,"empty")}}if(!this.getSelectedMapItem()&&(this.appConfig&&this.appConfig.map.itemId)&&(d=e[this.appConfig.itemId]))a=f(".map-item-bg",d),p.addClass(a,"selected")}}},_getWebMapCount:function(b){return f(".map-item-div",b).length},_createMapItem:function(b){var h=p.toDom("\x3cdiv class\x3d'map-item-div'\x3e\x3cdiv class\x3d'map-item-bg'\x3e\x3cdiv class\x3d'map-item-thumbnail'\x3e\x3c/div\x3e\x3ca target\x3d'_blank' class\x3d'map-item-detail-icon'\x3e\x3c/a\x3e\x3c/div\x3e\x3cspan class\x3d'map-item-title'\x3e\x3c/span\x3e\x3c/div\x3e"),
a=f(".map-item-bg",h)[0],e=f(".map-item-thumbnail",h)[0],d=f(".map-item-title",h)[0];f(".map-item-detail-icon",h)[0].href=b.detailsPageUrl;h.item=b;b.thumbnailUrl?p.setStyle(e,"backgroundImage","url("+b.thumbnailUrl+")"):e.innerHTML=this.nls.noneThumbnail;this.own(t(a,"click",s.hitch(this,this._onMapItemBgClick)));d.innerHTML=b.title;return h},unselect:function(){f(".map-item-bg",this.domNode).removeClass("selected")},_onMapItemBgClick:function(b){b=(b.target||b.srcElement).parentNode;p.hasClass(b,
"map-item-bg")&&(this.unselect(),p.addClass(b,"selected"),this.emit("select",{mapTable:this,selectedNode:b}))},getSelectedMapItem:function(){var b=null,h=f(".map-item-bg.selected",this.domNode);0<h.length&&(b=h[0].parentNode.item);return b}})})},"builder/config/ThemeConfig":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/mouse dojo/query dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/ThemeConfig.html dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-attr dojo/_base/array dojo/Deferred dojo/request dojo/dom jimu/utils jimu/dijit/Message ./ThemeManager ../serviceUtils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C){return q([m,f],{templateString:t,themeLoadDef:void 0,constructor:function(){},postMixInProperties:function(){this.nls=c.mixin({},builderNls.common,builderNls.themes)},startup:function(){this.inherited(arguments);this.themeManager=new B;this.themeLoadDef=this.themeManager.loadThemes();this.themeLoadDef.then(c.hitch(this,function(a){this.initThemePage(a)}))},initThemePage:function(a){var d,e,h,f,A,B;w.forEach(a,function(a){A=b.create("div",{"class":"catalog-theme-content-div"},
this.themeList);d=b.create("div",{"class":"catalog-theme-div"},A);b.create("div",{"class":"catalog-theme-name-div",innerHTML:a.getLabel()},A);B=b.create("div",{"class":"catalog-theme-img-div"},d);v.create("img",{src:a.getIcon(),"class":"catalog-theme-img"},B);e=v.create("div",{"class":"theme-cl-selected-div"},d);v.create("img",{"class":"theme-cl-selected-img",src:"builder/css/images/check.png"},e);l(d,"click",c.hitch(this,this._onStartChangeTheme,a.getName()));h=v.create("div",{"class":""},this.styleList);
this.initStyle(a,h);f=v.create("div",{"class":""},this.layoutList);this.initLayout(a,f);a.domNodes.theme=d;a.domNodes.themeSL=e;a.domNodes.styleList=h;a.domNodes.layoutList=f},this)},initStyle:function(a,d){var e,h,f,A;e=v.create("div",{"class":"style-section"},d);v.create("div",{innerHTML:this.nls.styleTitle,"class":"style-text"},e);A=v.create("div",{"class":"style-color-content"},e);w.forEach(a.getStyles(),function(a){h=v.create("div",{"class":"style-div"},A);x.set(h,"backgroundColor",a.styleColor);
a.domNode=h;l(h,"click",c.hitch(this,this._onStyleChanged,a.name));f=v.create("div",{"class":"style-selected-div"},h);v.create("img",{"class":"style-selected-img",src:"builder/css/images/check.png"},f);a.selectedNode=f},this);b.setStyle(d,"display","none")},initLayout:function(a,d){var e;e=v.create("div",{"class":"layout-section",id:a.getName()+"-layout-section"},d);v.create("div",{innerHTML:this.nls.layoutTitle,"class":"layout-text"},e);w.forEach(a.getLayouts(),function(d){this._drawLayout(a,d,e)},
this);b.setStyle(d,"display","none")},_drawLayout:function(a,d,e){d.domClass||(d.domClass=" ");e=v.create("div",{"class":"layout-div "+d.domClass,title:d.label},e);a=d.icon?a.getUrl()+d.icon:"builder/css/images/current_layout.png";v.create("img",{"class":"layout-image",src:a},e);d.domNode=e;l(e,"click",c.hitch(this,this._onLayoutChanged,d.name));a=v.create("div",{"class":"layout-selected-div"},e);v.create("img",{"class":"layout-selected-img",src:"builder/css/images/check.png"},a);d.selectedNode=a},
_onStyleChanged:function(a){this.changeStyle(a,null,!0)},_onLayoutChanged:function(a){this.changeLayout(a,null,!0)},_onStartChangeTheme:function(a){var d=new A({message:this.nls.themeChangeMessage,buttons:[{label:this.nls.ok,onClick:c.hitch(this,function(){d.close();this.changeTheme(a,!0)})},{label:this.nls.cancel}]})},changeStyle:function(a,d,e){d||(d=this.themeManager.getCurrentTheme());d.currentStyleName!==a&&(d.currentStyleName&&b.removeClass(d.getCurrentStyle().domNode,"style-selected"),d.changeCurrentStyle(a),
b.addClass(d.getCurrentStyle().domNode,"style-selected"),e&&g.publish("styleChanged",c.clone(d.getCurrentStyle())))},changeLayout:function(a,d,e){d||(d=this.themeManager.getCurrentTheme());d.currentLayoutName!==a&&(d.currentLayoutName&&b.removeClass(d.getCurrentLayout().domNode,"layout-selected"),d.changeCurrentLayout(a),b.addClass(d.getCurrentLayout().domNode,"layout-selected"),e&&g.publish("layoutChanged",c.clone(d.getCurrentLayout())))},_copyThemeFromRepo:function(a){var d=new h,e=this.themeManager.getThemeByName(a);
e.loadLayouts().then(c.hitch(this,function(){var b=e.getLayoutByName("default");C.copyThemeToApp(appId,a,e.appConfig?e.appConfig.getCleanConfig():b.layoutConfig).then(c.hitch(this,function(a){a.success?d.resolve():(d.reject(),console.error("change theme error, response of 'copytheme' unsuccess"))}),function(a){d.reject(a);console.error("change theme error"+a)})}));return d},changeTheme:function(a,d){var e=new h;this.themeManager.currentThemeName!==a?(g.publish("startChangeTheme"),this._copyThemeFromRepo(a).then(c.hitch(this,
function(){this.themeManager.currentThemeName&&(b.removeClass(this.themeManager.getCurrentTheme().domNodes.theme,"catalog-theme-selected"),b.setStyle(this.themeManager.getCurrentTheme().domNodes.styleList,"display","none"),b.setStyle(this.themeManager.getCurrentTheme().domNodes.layoutList,"display","none"));this.themeManager.changeCurrentTheme(a);d&&g.publish("themeChanged",c.clone(this.themeManager.getCurrentTheme()));b.addClass(this.themeManager.getCurrentTheme().domNodes.theme,"catalog-theme-selected");
b.setStyle(this.themeManager.getCurrentTheme().domNodes.styleList,"display","block");b.setStyle(this.themeManager.getCurrentTheme().domNodes.layoutList,"display","block");e.resolve()}))):e.resolve();return e},setAppConfig:function(a,d){var h,f;this.themeLoadDef.then(c.hitch(this,function(){d?(w.forEach(this.themeManager.themes,function(a){this.changeStyle("default",a,!1);this.changeLayout("default",a,!1);a.clear()},this),this.changeTheme(a.theme.name,!1).then(c.hitch(this,function(){a.theme.styles&&
a.theme.styles[0]&&this.changeStyle(a.theme.styles[0],this.themeManager.getCurrentTheme(),!1);h=e.byId(this.themeManager.getCurrentTheme().getName()+"-layout-section");f=this.themeManager.getCurrentTheme().getLayoutByAppConfig(a.getCleanConfig());f||(f=this.themeManager.getCurrentTheme().addLayout("appLayout",a.getCleanConfig(),"app-layout"),this._drawLayout(this.themeManager.getCurrentTheme(),f,h));this.changeLayout(f.name,this.themeManager.getCurrentTheme(),!1);this.themeManager.getCurrentTheme().setAppConfig(a);
b.setStyle(this.themeList,"display","block")}))):this.themeManager.getCurrentTheme()&&this.themeManager.getCurrentTheme().setAppConfig(a)}))}})})},"builder/config/ThemeManager":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/request dojo/on dojo/Deferred dojo/promise/all ./Theme ../serviceUtils jimu/utils".split(" "),function(q,c,b,g,l,k,s,n,p,m){return q(null,{themes:void 0,constructor:function(){this.currentThemeName=null;this.themes=[]},loadThemes:function(){var f=new k;
p.getAllThemes().then(b.hitch(this,function(b){b.success?(b.themes=b.themes.sort(function(b,c){return b.name>c.name}),c.forEach(b.themes,function(b){m.processManifestLabel(b,dojoConfig.locale);this.themes.push(new n(b))},this),f.resolve(this.themes)):(console.error("Gets themes failed! The response of getThemes is 'unsuccess'!"),f.reject(this.themes))}),function(b){console.error("Gets themes failed!"+b);f.reject(this.themes)});return f},changeCurrentTheme:function(b){this.currentThemeName=b},getCurrentTheme:function(){return this.getThemeByName(this.currentThemeName)},
getThemeByName:function(b){for(var c=0;c<this.themes.length;c++)if(b===this.themes[c].getName())return this.themes[c]}})})},"builder/config/Theme":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/Deferred dojo/promise/all dojo/request jimu/utils".split(" "),function(q,c,b,g,l,k,s,n){return q(null,{appConfig:void 0,currentStyleName:void 0,currentLayoutName:void 0,_manifest:void 0,constructor:function(b){this._manifest=b;this.domNodes={}},clear:function(){var c;
this.appConfig=null;for(c=0;c<this._manifest.layouts.length;c++)if("appLayout"===this._manifest.layouts[c].name){this._manifest.layouts[c].domNode&&b.destroy(this._manifest.layouts[c].domNode);this._manifest.layouts.splice(c,1);break}},loadLayouts:function(){var b=new l,m=[],f=g.filter(this._manifest.layouts,function(b){return"appLayout"!==b.name});g.forEach(f,function(b){m.push(s(this._manifest.url+b.uri,{handleAs:"json"}))},this);k(m).then(c.hitch(this,function(c){g.forEach(f,function(b,f){b.layoutConfig=
c[f]},this);b.resolve()}),function(){b.reject()});return b},setAppConfig:function(b){this.appConfig=b},getName:function(){return this._manifest.name},getLabel:function(){return this._manifest.label},getIcon:function(){return this._manifest.icon},getLayouts:function(){return this._manifest.layouts},getStyles:function(){return this._manifest.styles},getUrl:function(){return this._manifest.url},getCurrentStyle:function(){return this.getStyleByName(this.currentStyleName)},getCurrentLayout:function(){return this.getLayoutByName(this.currentLayoutName)},
changeCurrentStyle:function(b){this.currentStyleName=b},changeCurrentLayout:function(b){this.currentLayoutName=b},addLayout:function(b,c,f){var g,k=this.getLayouts();for(g=0;g<k.length;g++)if(k[g].name===b)return null;b={description:"this is current app layout",name:b,label:window.builderNls.themes.appLayout,layoutConfig:c,domClass:f};this._manifest.layouts.push(b);return b},getStyleByName:function(b){var c,f=null;for(c=0;c<this._manifest.styles.length;c++)if(this._manifest.styles[c].name===b){f=
this._manifest.styles[c];break}return f},getLayoutByName:function(b){var c,f=null;for(c=0;c<this._manifest.layouts.length;c++)if(this._manifest.layouts[c].name===b){f=this._manifest.layouts[c];break}return f},getLayoutByAppConfig:function(b){var c,f=null;for(c=0;c<this._manifest.layouts.length;c++)if(this.isAppUseLayout(b,this._manifest.layouts[c].layoutConfig)){f=this._manifest.layouts[c];break}return f},isAppUseLayout:function(b,g){var f=c.clone(b),k=c.clone(g);f.map||(f.map={});k.map||(k.map=f.map);
f.map.position||(f.map.position={left:0,top:0});k.map.position||(k.map.position=f.map.position);if(!n.isEqual(f.map.position,k.map.position))return!1;f.widgetOnScreen||(f.widgetOnScreen={});k.widgetOnScreen||(k.widgetOnScreen={});f.widgetOnScreen.widgets||(f.widgetOnScreen.widgets=[]);k.widgetOnScreen.widgets||(k.widgetOnScreen.widgets=[]);f.widgetOnScreen.groups||(f.widgetOnScreen.groups=[]);k.widgetOnScreen.groups||(k.widgetOnScreen.groups=[]);var l,r;l=f.widgetOnScreen.widgets.length<k.widgetOnScreen.widgets.length?
f.widgetOnScreen.widgets.length:k.widgetOnScreen.widgets.length;for(r=0;r<l;r++){f.widgetOnScreen.widgets[r].positionRelativeTo||(f.widgetOnScreen.widgets[r].positionRelativeTo="map");k.widgetOnScreen.widgets[r].positionRelativeTo||(k.widgetOnScreen.widgets[r].positionRelativeTo=f.widgetOnScreen.widgets[r].positionRelativeTo);if(f.widgetOnScreen.widgets[r].positionRelativeTo!==k.widgetOnScreen.widgets[r].positionRelativeTo)return!1;f.widgetOnScreen.widgets[r].position||(f.widgetOnScreen.widgets[r].position=
{left:0,top:0});k.widgetOnScreen.widgets[r].position||(k.widgetOnScreen.widgets[r].position=f.widgetOnScreen.widgets[r].position);if(!n.isEqual(f.widgetOnScreen.widgets[r].position,k.widgetOnScreen.widgets[r].position))return!1}l=f.widgetOnScreen.groups.length<k.widgetOnScreen.groups.length?f.widgetOnScreen.groups.length:k.widgetOnScreen.groups.length;for(r=0;r<l;r++){f.widgetOnScreen.groups[r].panel||(f.widgetOnScreen.groups[r].panel={});k.widgetOnScreen.groups[r].panel||(k.widgetOnScreen.groups[r].panel=
f.widgetOnScreen.groups[r].panel);f.widgetOnScreen.groups[r].panel.positionRelativeTo||(f.widgetOnScreen.groups[r].panel.positionRelativeTo="map");k.widgetOnScreen.groups[r].panel.positionRelativeTo||(k.widgetOnScreen.groups[r].panel.positionRelativeTo=k.widgetOnScreen.groups[r].panel.positionRelativeTo);if(f.widgetOnScreen.groups[r].panel.positionRelativeTo!==k.widgetOnScreen.groups[r].panel.positionRelativeTo)return!1;f.widgetOnScreen.groups[r].panel.position||(f.widgetOnScreen.groups[r].panel.position=
{left:0,top:0});k.widgetOnScreen.groups[r].panel.position||(k.widgetOnScreen.groups[r].panel.position=f.widgetOnScreen.groups[r].panel.position);if(!n.isEqual(f.widgetOnScreen.groups[r].panel.position,k.widgetOnScreen.groups[r].panel.position))return!1}return!0},getLayoutFromConfig:function(b){var k={};b=c.clone(b);b.widgetOnScreen&&(k.widgetOnScreen={},b.widgetOnScreen.widgets&&(k.widgetOnScreen.widgets=[],g.forEach(b.widgetOnScreen.widgets,function(b,c){k.widgetOnScreen.widgets[c]={position:b.position?
b.position:{left:0,top:0}}})),b.widgetOnScreen.groups&&(k.widgetOnScreen.groups=[],g.forEach(b.widgetOnScreen.groups,function(b,c){k.widgetOnScreen.groups[c]={position:b.position?b.position:{left:0,top:0}}})));b.map&&(k.map={position:b.map.position});return k}})})},"builder/serviceUtils":function(){define("dojo/_base/lang dojo/cookie dojo/i18n dojo/request/xhr dojo/Deferred dojo/json dojo/_base/array esri/request jimu/utils jimu/portalUrlUtils builder/portalUtils dojo/promise/all builder/tokenUtils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v){function r(a,b,e,h,c,y){b.title=a.name;b.isWebTier=y;b.portalUrl=e;b.map.itemId=h;b.geometryService=c.helperServices.geometry.url;a.webmap||(b.map.mapOptions||(b.map.mapOptions={}),b.map.mapOptions.extent=c.defaultExtent);b.httpProxy=window.isXT?{useProxy:!0,url:"/proxy.js"}:{useProxy:!0,url:b.portalUrl+"sharing/proxy"}}function x(a,b){var e=new l,h={title:a.name,type:"Web Mapping Application",typeKeywords:"Web AppBuilder",text:k.stringify(b),snippet:a.description,
tags:a.tags};f.getPortal(m.getPortalUrlFromLocation()).getUser().then(function(b){a.folderId===b.username&&(a.folderId="");b.addItem(h,a.folderId).then(function(h){h.success?(h.user=b,e.resolve(h),b.addItem({title:a.name,type:"Code Attachment",typeKeywords:"Code, Web Mapping Application, Javascript",relationshipType:"WMA2Code",originItemId:h.id,url:m.getItemUrl(m.getPortalUrlFromLocation(),h.id)+"/package"},a.folderId).then(function(a){a.success||console.error(builderNls.serviceUtils.createCodeAttachmentError)},
function(a){console.error(builderNls.serviceUtils.createCodeAttachmentError,a.message)})):e.resolve(h)},function(a){e.reject(a)})},function(a){e.reject(a)});return e}function u(a){var b=new l;g("stemapp/"+a+"/list.json",{handleAs:"json"}).then(function(e){return w(e,a).then(function(a){b.resolve({success:!0,manifests:a})})},function(a){b.reject({success:!1,message:a.message})});return b}function w(a,b){var e=[],c=new l;a._buildInfo&&a._buildInfo.widgetManifestsMerged?g("stemapp/"+b+"/"+b+"-manifest-builder.json",
{handleAs:"json"}).then(function(a){var d=[],e;for(e in a)d.push(a[e]);return h(d,b).then(function(){c.resolve(d)})}):(s.forEach(a[b],function(a){e.push(g("stemapp/"+b+"/"+a+"/manifest.json",{handleAs:"json"}))}),t(e).then(function(a){return h(a,b).then(function(){c.resolve(a)})}));return c}function h(d,b){var e=[],h=new l;s.forEach(d,function(d){d.category="widgets"===b?"widget":"theme";d.url="stemapp/"+d.category+"s/"+d.name+"/";d.amdFolder=d.category+"s/"+d.name+"/";e.push(a(d))});t(e).then(function(){h.resolve()},
function(a){h.reject(a)});return h}function a(a){p.addManifestProperies(a);return p.addI18NLabel(a)}var e={getAppList:function(){var a=new l,b;isXT?(b=f.getPortal(window.portalUrl),b.getUser().then(function(b){g("/builder/rest/apps/list/"+b.username,{handleAs:"json"}).then(function(b){a.resolve(b)},function(b){a.reject(b)})},function(b){a.reject(b)})):(b=m.getPortalUrlFromLocation(),(b=f.getPortal(b))?b.getUser().then(function(b){b.getItemsByKeywords("Web AppBuilder").then(function(b){var e=[];(b=
b&&b.results)&&0<b.length&&(e=s.map(b,function(a){return{name:a.title,description:a.description,id:a.id}}));a.resolve(e)},function(b){console.error(b);a.reject({success:!1,message:""})})},function(b){console.error(b);a.reject({success:!1,message:""})}):a.reject({success:!1,message:""}));return a},getAppInfo:function(a){if(isXT)return g("/builder/rest/apps/"+a,{handleAs:"json"});var b=new l;f.getPortal(m.getPortalUrlFromLocation()).getItemById(a).then(function(a){b.resolve({name:a.title,description:a.description,
id:a.id})});return b},updateApp:function(a){var b=new l;isXT?f.getPortal(window.portalUrl).getUser().then(function(e){g("/builder/rest/apps/updateapp",{handleAs:"json",method:"POST",data:{id:a.id,name:a.name,description:a.description,modified:e.username||"",creator:a.creator}}).then(function(a){b.resolve(a)},function(a){b.reject(a)})},function(a){b.reject(a)}):b.resolve({success:!0});return b},createApp:function(a){var b=new l,h,c=window.portalUrl,z=f.getPortal(c);h=z.loadSelfInfo();var y=z.getUser(),
z=null;a.webmap?(z=new l,z.resolve(a.webmap)):z=f.getDefaultWebMap(c);if(isXT){var k=g("/builder/rest/signininfo/getcurrentinfo",{handleAs:"json"});h=[h,y,z,k];t(h).then(function(e){var h=e[1],y={map:{}};r(a,y,c,e[2],e[0],e[3].info.isWebTier?!0:!1);g("/builder/rest/apps/createapp",{handleAs:"json",method:"POST",data:{name:a.name,description:a.description,is3D:a.is3D,creator:h.username||"",modified:h.username||"",extraPropertyOfAppConfig:JSON.stringify(y)}}).then(function(a){b.resolve(a)},function(a){b.reject(a)})},
function(a){console.error(a);b.reject({success:!1,message:builderNls.serviceUtils.createError})})}else y=e.getPredefinedAppConfig("true"===a.is3D?"default3DApp":"default2DApp"),k=v.isWebTierPortal(c),h=[h,y,z,k],t(h).then(function(e){var h=e[1];r(a,h,c,e[2],e[0],e[3]);x(a,h).then(function(a){a.success?(b.resolve({success:!0,newAppId:a.id}),setTimeout(q.hitch(this,function(){a.user.updateItem(a.id,{url:m.getDeployContextFromLocation()+"apps/webappviewer/index.html?id\x3d"+a.id}).then(function(a){a.success||
console.error(builderNls.serviceUtils.createUrlError)},function(a){console.error(builderNls.serviceUtils.createUrlError,a.message||"")})}),2E3)):(b.reject({success:!1,message:builderNls.serviceUtils.createError}),console.error(builderNls.serviceUtils.createError,builderNls.serviceUtils.addItemUnsuccess))},function(a){b.reject({success:!1,message:builderNls.serviceUtils.createError});console.error(builderNls.serviceUtils.createError,a.message||"")})},function(a){console.error(a);b.reject({success:!1,
message:builderNls.serviceUtils.createError})});return b},duplicateApp:function(a,b){var e=new l;isXT?f.getPortal(window.portalUrl).getUser().then(function(b){g("/builder/rest/apps/duplicateapp",{handleAs:"json",method:"POST",data:{name:a.name,description:a.description,id:a.createFromId,is3D:a.is3D,creator:b.username||"",modified:b.username||""}}).then(function(a){e.resolve(a)},function(a){e.reject(a)})},function(a){console.error(builderNls.serviceUtils.createError,a);e.reject({message:builderNls.serviceUtils.createError})}):
x(a,b).then(function(a){a.success?(e.resolve({success:!0,newAppId:a.id}),a.user.updateItem(a.id,{url:m.getDeployContextFromLocation()+"apps/webappviewer/index.html?id\x3d"+a.id}).then(function(a){},function(a){console.error(builderNls.serviceUtils.duplicateUrlError,a.message||"")})):(e.reject({success:!1,message:builderNls.serviceUtils.duplicateError}),console.error(builderNls.serviceUtils.duplicateError,builderNls.serviceUtils.addItemUnsuccess))},function(a){e.reject({success:!1,message:builderNls.serviceUtils.duplicateError});
console.error(builderNls.serviceUtils.duplicateError,a.message||"")});return e},saveApp:function(a,b){var e=new l,h;isXT?(h=f.getPortal(window.portalUrl),h.getUser().then(function(h){g("/builder/rest/apps/"+a+"/saveconfig",{data:{appConfig:k.stringify(b),modified:h.username},method:"POST",handleAs:"json"}).then(function(a){e.resolve(a)},function(a){e.reject(a)})},function(a){e.reject(a)})):(h=f.getPortal(m.getPortalUrlFromLocation()),h.getUser().then(function(c){h.getItemData(a).then(function(h){b.agolTemplateJson=
h.agolTemplateJson;c.updateItem(a,{text:k.stringify(b)}).then(function(a){e.resolve({success:!0,newAppId:a.id})},function(a){e.reject({success:!1,message:a.message})})},function(a){console.error(a.message||a);e.reject({success:!1,message:a.message})})},function(a){e.reject({success:!1,message:a.message})}));return e},getPredefinedAppConfig:function(a){return g("builder/predefined-apps/"+a+"/config.json",{handleAs:"json"})},copyThemeToApp:function(a,b,e){if(isXT)return g("/builder/rest/apps/"+a+"/copytheme",
{handleAs:"json",method:"POST",data:{themeName:b,layoutConfig:JSON.stringify(e)}});a=new l;a.resolve({success:!0});return a},copyWidgetToApp:function(a,b,e){if(isXT)return g.post("/builder/rest/apps/"+a+"/copywidget",{data:{widgetName:b,widgetLabel:e},handleAs:"json"});a=new l;a.resolve({success:!0});return a},getAllThemes:function(){if(isXT)return g("/builder/rest/themes/getall",{handleAs:"json"});var a=new l;u("themes").then(function(b){a.resolve({success:!0,themes:b.manifests})},function(b){a.reject(b)});
return a},searchWidgets:function(a){if(isXT)return g("/builder/rest/widgets/search?q\x3d"+JSON.stringify(a),{handleAs:"json"});var b=new l;u("widgets").then(function(e){var h=[];s.forEach(e.manifests,function(b){a["properties.inPanel"]===b.properties.inPanel&&(a.support2D===b.support2D||a.support3D===b.support3D)&&h.push(b)});b.resolve({success:!0,widgets:h})},function(a){b.reject(a)});return b},saveAgolTemplate:function(a,b){var e=new l;if(isXT)g("/builder/rest/apps/updateagoltemplateinapp",{handleAs:"json",
method:"POST",data:{id:a.id,agolTemplateJson:b}}).then(q.hitch(this,function(a){!0===a.success?e.resolve():(console.error("The response of save agol template is 'unsuccess'!"),e.reject("The response of save agol template is 'unsuccess'!"))}),function(a){console.error(a.message||a);e.reject("Save AGOLTemplate failed!")});else{var h=f.getPortal(m.getPortalUrlFromLocation());h.getUser().then(function(c){h.getItemData(a.id).then(function(h){h.agolTemplateJson=b;c.updateItem(a.id,{text:k.stringify(h)}).then(function(){e.resolve()},
function(a){console.error(a.message||a);e.reject("Save AGOLTemplate failed when updateItem!")})},function(a){console.error(a.message||a);e.reject("Save AGOLTemplate failed when get app's itemData!")})},function(a){console.error(a.message||a);e.reject("Save AGOLTemplate failed when get current user!")})}return e}};return e})},"builder/config/WidgetConfig":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/WidgetConfig.html ./AppWidgetsPage".split(" "),
function(q,c,b,g,l,k){return q([b,g],{templateString:l,postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.widgets)},postCreate:function(){this.inherited(arguments);this.appWidgetsPage=new k({},this.appWidgetsPageNode)},startup:function(){this.inherited(arguments);this.appWidgetsPage.startup()},destroy:function(){this.appWidgetsPage.destroy();this.appWidgetsPage=null;this.inherited(arguments)},setAppConfig:function(b){this.appConfig=b;this.appWidgetsPage&&
this.appWidgetsPage.setAppConfig(b)}})})},"builder/config/AppWidgetsPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/topic dojo/on dojo/mouse dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AppWidgetsPage.html ./WidgetsList ./MoveableNode ./WidgetSettingPage ./GroupSettingPage ./WidgetChoosePage ../utils jimu/utils jimu/PoolControllerMixin jimu/WidgetManager jimu/dijit/ViewStack jimu/dijit/Popup".split(" "),function(q,c,b,g,l,k,s,n,p,
m,f,t,v,r,x,u,w,h,a,e,d){return q([n,p],{templateString:m,postCreate:function(){this.inherited(arguments);this.widgetOnScreen=new f({name:"widgetOnScreen"},this.noncontrollerPreloadWidgetsNode);this.poolWidgets=new f({name:"poolWidgets"},this.poolWidgetsListNode);this.viewStack=new e({viewType:"dom",views:[this.preloadWidgetsNode,this.poolWidgetsNode]});this.viewStack.placeAt(this.domNode);this.poolControllerClass=q([n,h]);this.own(l.subscribe("editWidget",c.hitch(this,this._onEditWidget)));this.own(l.subscribe("chooseWidget",
c.hitch(this,this._onChooseWidget)));this.own(l.subscribe("editGroup",c.hitch(this,this._onEditGroup)))},postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.widgets);this.nls.widgets||(this.nls.widgets="Widgets")},startup:function(){this.inherited(arguments);this.viewStack.startup();this.widgetOnScreen.startup();this.poolWidgets.opened=!1;this.widgetOnScreen.opened=!0},destroy:function(){this.widgetOnScreen.destroy();this.poolWidgets.destroy();
this.poolWidgets=this.widgetOnScreen=null;g.forEach(this.controllers,function(a){a.destroy()});this.controllers=[];this.inherited(arguments)},setAppConfig:function(a){this.appConfig&&w.isEqual(this.appConfig.widgetOnScreen,a.widgetOnScreen)&&w.isEqual(this.appConfig.widgetPool,a.widgetPool)?this.appConfig=a:(this.appConfig=a,this._createControllerWidgetNodes(),b.setStyle(this.noncontrollerPreloadWidgetsNode,{top:this.controllerWidgetsHeight+20+"px"}),this.widgetOnScreen.setSettings(this._getNonControllerPreloadWidgets()),
this.widgetOnScreen.setAppConfig(this.appConfig),this.poolWidgets._started&&(0<this.controllers.length?this._initWidgetPool(this.controllers[0]):(this._initWidgetPool(null),this.viewStack.switchView(this.preloadWidgetsNode))),this.widgetChoosePage&&this.widgetChoosePage.setAppConfig(a),this.widgetSettingPage&&this.widgetSettingPage.setAppConfig(a))},_getNonControllerPreloadWidgets:function(){var a=[];this.appConfig.visitElement(function(b,e,d,h){!b.isController&&h&&a.push(b)});return a},_createControllerWidgetNodes:function(){g.forEach(this.controllers,
function(a){b.destroy(a.node);a.destroy()},this);this.controllers=[];g.forEach(this.appConfig.widgetOnScreen.widgets,function(a){a.isController&&this._createControllerWidgetNode(a)},this);this.controllerWidgetsHeight=118*this.controllers.length;b.setStyle(this.controllerWidgetsNode,{height:this.controllerWidgetsHeight+"px"})},_createControllerWidgetNode:function(a){var e=b.create("div",{"class":"controller-widget"},this.controllerWidgetsNode),d=new t({type:"widget",w:74,h:118,setting:a,listName:"controllerWidgets",
style:{left:"30px"}});b.place(d.domNode,e);d.startup();d=b.create("div",{"class":"action-node"},e);b.create("div",{"class":"action-text",innerHTML:this.nls.setControlledWidgets},d);b.create("div",{"class":"action-arrow",innerHTML:"\x3e"},d);a=new this.poolControllerClass(a);a.appConfig=this.appConfig;a.node=e;this.controllers.push(a);this.own(k(d,"click",c.hitch(this,this._openWidgetPool,a)))},_openWidgetPool:function(a){!1!==a.visible&&(this.currentController=a,this.viewStack.switchView(this.poolWidgetsNode),
this.poolWidgets.controller=a,this.poolWidgets.opened=!0,this.widgetOnScreen.opened=!1,this.controllerLabelNode.innerHTML=a.label,this._initWidgetPool(a),this.poolWidgets._started||this.poolWidgets.startup())},_initWidgetPool:function(a){this.poolWidgets.setSettings(a?a.getAllConfigs():[]);this.poolWidgets.setAppConfig(this.appConfig)},_onBackWidgetsClick:function(){this._createControllerWidgetNodes();this.viewStack.switchView(this.preloadWidgetsNode);this.poolWidgets.opened=!1;this.widgetOnScreen.opened=
!0},_onEditWidget:function(a){this.widgetSettingPage=new v({appConfig:this.appConfig},this.widgetSettingPageNode);this.widgetSettingPage.setting=c.clone(a);a=new d({titleLabel:this.nls.configLabel+" "+a.label,content:this.widgetSettingPage,container:"main-page",buttons:[{label:this.nls.ok,onClick:c.hitch(this.widgetSettingPage,this.widgetSettingPage.onOk)},{label:this.nls.cancel,onClick:c.hitch(this.widgetSettingPage,this.widgetSettingPage.onCancel)}],onClose:c.hitch(this.widgetSettingPage,this.widgetSettingPage.onClose)});
b.addClass(a.domNode,"widget-setting-popup");this.widgetSettingPage.startup()},_onChooseWidget:function(a,b){this.widgetChoosePage=new x({appConfig:this.appConfig},this.widgetChoosePageNode);this.widgetChoosePage.fromNode=a;this.widgetChoosePage.fromList=b;new d({titleLabel:this.nls.chooseWidget,content:this.widgetChoosePage,container:"main-page",buttons:[{label:this.nls.ok,onClick:c.hitch(this.widgetChoosePage,this.widgetChoosePage.onOk)},{label:this.nls.cancel}]});this.widgetChoosePage.startup()},
_onEditGroup:function(a,b){this.groupSettingPage=new r({setting:c.clone(b)});new d({titleLabel:b.label,content:this.groupSettingPage,container:"main-page",buttons:[{label:this.nls.ok,onClick:c.hitch(this.groupSettingPage,this.groupSettingPage.onOk)},{label:this.nls.cancel}]});this.groupSettingPage.startup()},_getPopupSize:function(){var a=b.getContentBox("main-page"),d={};1024>=a.w?(d.width=a.w-20,d.height=a.h-20):(d.width=1024,d.height=768);return d}})})},"builder/config/WidgetsList":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/topic dojo/aspect dojo/request/xhr dojo/on dojo/Deferred dojo/mouse dojo/query dojo/NodeList-dom dijit/_WidgetBase ./MoveableNode ./LinkList".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x){function u(a){var b={};a.l&&(b.left=a.l+"px");a.t&&(b.top=a.t+"px");a.w&&(b.width=a.w+"px");a.h&&(b.height=a.h+"px");return b}var w,h=q([v],{postCreate:function(){this.inherited(arguments);this.domNode=b.create("div",{"class":"node-margin"});this.type="addBtn"===this.node.type?"addMargin":"margin"}});return q([v],{postCreate:function(){this.nodeList=new x({name:this.name});this.own(l.subscribe("widgetChoosePageOk",c.hitch(this,this._onWidgetChoosePageOk)));
this.own(l.subscribe("widgetSettingPageOk",c.hitch(this,this._onWidgetSettingPageOk)))},startup:function(){this.inherited(arguments);var a=b.getContentBox(this.domNode);this.position=b.position(this.domNode);w=Math.floor(a.w/89);this.settings&&this.initNodes()},setSettings:function(a){this.settings=a;this.initNodes()},setAppConfig:function(a){this.appConfig=a},addWidget:function(a){a=this.createMoveableNode("widget",a);this.nodeList.insertNode(a);this.placeNodes()},createMoveableNode:function(a,e){var d=
b.getContentBox(this.domNode);d.h=Infinity;var h=new r({type:a,w:74,h:118,setting:e,listName:this.name,parentBox:d});b.place(h.domNode,this.domNode);h.startup();this.bindMoveEvent(h);"group"===a&&(k.after(h,"openGroup",c.hitch(this,this.openGroup,h)),k.after(h,"closeGroup",c.hitch(this,this.closeGroup,h)));h.on("removeNode",c.hitch(this,function(){"poolWidgets"===this.name?(h.gnode?(this.nodeList.removeNode(h),this._reopenGroup()):this.nodeList.removeNode(h),this.placeNodes(),this.publishPoolChangeEvent()):
l.publish("configChanged",h.setting.id,h.setting)}));this.createMarginNode(h);this.own(n(h.domNode,"click",c.hitch(this,function(){("addBtn"===a||"widget"===a&&!e.uri)&&l.publish("chooseWidget",h,this.name)})));return h},openGroup:function(a){var b,d,h,f,k,z,y;this.openedGNode&&this.openedGNode!==a&&this.openedGNode.closeGroup(this.openedGNode);b=a.setting.widgets;k=this.getNodePosition(this.nodeList.getNodeIndex(a)).r;z=Math.ceil(b.length/w);d=k*w+1;h=this.nodeList.getNodeByIndex(d);for(f=this.nodeList.getCount()+
1;f<d;f++)y=this.createMoveableNode("empty"),y.gnode=a,this.nodeList.insertNode(y,h);this.openedGNode=a;this.openedGNode.panelRow=k+1;this.createGroupPanel(k+1,z);b.forEach(c.hitch(this,function(b){b=this.createMoveableNode("widget",b);b.gnode=a;this.nodeList.insertNode(b,h)}));b=w*z-b.length;for(f=0;f<b;f++)y=this.createMoveableNode("empty"),y.gnode=a,this.nodeList.insertNode(y,h);this.placeNodes()},createGroupPanel:function(a,e){this.groupPanel=b.create("div",{"class":"widget-group-panel",style:u({l:5,
t:118*(a-1)-10,h:118*e+0*(e-1),w:89*w-15+20})},this.domNode);b.create("div",{"class":"group-triangle",style:{left:89*((this.openedGNode.pos.c-1)%w)+37+"px"}},this.groupPanel);this.groupPanel.type="panel"},closeGroup:function(a){var e=[];a.setting.widgets=[];this.nodeList.visitNodes(c.hitch(this,function(b){b.gnode===a&&("empty"!==b.type&&a.setting.widgets.push(b.setting),e.push(b))}));e.forEach(c.hitch(this,function(a){this.nodeList.removeNode(a)}));0===a.setting.widgets.length?this.nodeList.removeNode(a):
a.updateSmallWidgets();this.placeNodes();b.destroy(this.groupPanel);this.openedGNode=null},initNodes:function(){this.shadowNode&&b.destroy(this.shadowNode);var a=this.settings,a="widgetOnScreen"===this.name?a.sort(firstBy(function(a,b){return a.inPanel!==b.inPanel?a.inPanel-b.inPanel:0}).thenBy(function(a,b){return a.uri&&!b.uri?-1:!a.uri&&b.uri?1:0}).thenBy(function(a,b){return a.uri&&b.uri?a.label.localeCompare(b.label):!a.uri&&!b.uri?a.placeholderIndex-b.placeholderIndex:0})):a.sort(function(a,
b){return a.index-b.index}),e;this.openedGNode&&(e=this.openedGNode.label,this.closeGroup(this.openedGNode));this.nodeList.destroyAllNodes();"poolWidgets"===this.name&&(this.addBtn=this.createMoveableNode("addBtn"),this.nodeList.insertNode(this.addBtn));a.forEach(c.hitch(this,function(a){var b;a.widgets?0<a.widgets.length?b=this.createMoveableNode("group",a):console.log("empty group"):b=this.createMoveableNode("widget",a);b&&this.nodeList.insertNode(b)}));this.nodeList.insertNode(this.createMoveableNode("empty"));
this.placeNodes();if(e&&(a=this.nodeList.getNodeByLabel(e)))this.openGroup(a),a.status="open"},_removeActive:function(){f(".node-margin-active",this.domNode).removeClass("node-margin-active");f(".empty-node-active",this.domNode).removeClass("empty-node-active");f(".node-active",this.domNode).removeClass("node-active")},bindMoveEvent:function(a){"addBtn"!==a.type&&a.dnd&&(k.after(a.dnd,"onMove",c.hitch(this,function(e,d,h){e=this.getMousePosition(h);this.mouseNode=this.getNodeByMousePosition(a,e);
this._removeActive();this.mouseNode&&"margin"===this.mouseNode.type?b.addClass(this.mouseNode.domNode,"node-margin-active"):this.mouseNode&&"empty"===this.mouseNode.type?b.addClass(this.mouseNode.domNode,"empty-node-active"):this.mouseNode&&("group"===this.mouseNode.type||"widget"===this.mouseNode.type)&&b.addClass(this.mouseNode.domNode,"node-active")}),!0),k.after(a.dnd,"onMoveStart",c.hitch(this,function(){this.createShadowNode(a);b.setStyle(a.boxNode,"cursor","move")}),!0),k.after(a.dnd,"onMoveStop",
c.hitch(this,function(){var e=!1;b.setStyle(a.boxNode,"cursor","pointer");this.mouseNode&&(a===this.mouseNode?console.log("move to the same node"):"margin"===this.mouseNode.type?(this.moveNodeToMargin(a,this.mouseNode),e=!0):"empty"===this.mouseNode.type?this.mouseNode.gnode&&"group"===a.type?console.log("not allow move group to opened group, revert"):(this.moveNodeToEmpty(a,this.mouseNode),e=!0):"group"===this.mouseNode.type?"group"===a.type?console.log("not allow move group to closed group, revert"):
"open"===this.mouseNode.status?console.log("please put widget into the opened group panel"):a.gnode&&a.gnode===this.mouseNode?console.log("the moving widget is already in the group"):(this.moveWidgetToGroup(a,this.mouseNode),e=!0):"widget"===this.mouseNode.type&&("group"===a.type?console.log("not allow move group to widget, revert"):a.gnode||this.mouseNode.gnode?console.log("can not nest group"):(this.moveWidgetToWidget(a,this.mouseNode),e=!0)),this._reopenGroup());b.destroy(this.shadowNode);e&&this.publishPoolChangeEvent();
this.placeNodes()}),!0))},_reopenGroup:function(){if(this.openedGNode){var a=this.openedGNode;this.closeGroup(a);this.nodeList.isExist(a)&&this.openGroup(a)}},getNodePosition:function(a){var b={},d;d=Math.ceil(a/w);a%=w;0===a&&(a=w);b.t=118*(d-1);b.l=89*(a-1)+15;b.w=74;b.h=118;b.r=d;b.c=a;return b},getMarginNodePosition:function(a){var b={};a=a.pos;b.l=a.l-7.5-2.5;b.t=a.t;b.w=5;b.h=118;return b},createMarginNode:function(a){var e=new h({label:a.label,node:a});b.place(e.domNode,this.domNode);return a.margin=
e},getMousePosition:function(a){return{x:a.pageX-this.position.x,y:a.pageY-this.position.y+this.domNode.scrollTop}},moveNodeToMargin:function(a,b){var d=this.getNodeByMarginNode(b);console.log("moveNodeToMargin");f(".node-margin-active",this.domNode).removeClass("node-margin-active");d.gnode&&!a.gnode?a.gnode=d.gnode:!d.gnode&&a.gnode&&(a.gnode=null);this.nodeList.moveNode(a,d)},moveNodeToEmpty:function(a,b){console.log("moveNodeToEmpty");f(".empty-node-active",this.domNode).removeClass("empty-node-active");
b.gnode&&!a.gnode?a.gnode=b.gnode:!b.gnode&&a.gnode&&(a.gnode=null);this.nodeList.moveNode(a,b)},getNodeByMarginNode:function(a){var b;this.nodeList.visitNodes(function(d){d.margin===a&&(b=d)});return b},placeNodes:function(){var a,e;this.nodeList.visitNodes(c.hitch(this,function(d,h){a=this.getNodePosition(h);d.pos=a;b.setStyle(d.domNode,u(a));e=this.getMarginNodePosition(d);d.margin.pos=e;b.setStyle(d.margin.domNode,u(e))}));this.nodeList.printNodeList()},moveWidgetToGroup:function(a,b){console.log("moveWidgetToGroup");
b.addWidget(a);this.nodeList.removeNode(a)},moveWidgetToWidget:function(a,b){var d;console.log("moveWidgetToWidget");d=this.createMoveableNode("group",{label:this._getGroupLabel(),widgets:[a.setting,b.setting]});this.nodeList.insertNode(d,b);this.nodeList.removeNode(a);this.nodeList.removeNode(b)},createShadowNode:function(a){this.shadowNode=b.create("div",{"class":"node-shadow",style:u(b.getMarginBox(a.domNode))},this.domNode)},getNodeByMousePosition:function(a,b){var d;this.nodeList.visitNodes(function(h){if("addBtn"!==
h.type){if(b.x>h.pos.l+10&&(b.x<h.pos.l+h.pos.w-10&&b.y>h.pos.t+10&&b.y<h.pos.t+h.pos.h-10)&&h!==a)return d=h,!0;if(b.x>h.margin.pos.l&&(b.x<h.margin.pos.l+h.margin.pos.w&&b.y>h.margin.pos.t&&b.y<h.margin.pos.t+h.margin.pos.h)&&h.margin!==a)return d=h.margin,!0}});return d},_getGroupLabel:function(){var a=-1;this.appConfig.visitElement(c.hitch(this,function(b){if(b.widgets)if("New Group"===b.label)a=0;else if(b.label.startWith("New Group")){var d=b.label.lastIndexOf("_");-1<d&&(b=parseInt(b.label.substr(d+
1,b.label.length),10),a=Math.max(a,b))}}));return-1===a?"New Group":"New Group_"+(a+1)},_onWidgetChoosePageOk:function(a,b){if(b.listName===this.name)if(1===a.length){var d;"addBtn"===b.type?d=a[0]:(d=c.clone(b.setting),c.mixin(d,a[0]));l.publish("editWidget",d)}else"addBtn"===b.type&&(g.forEach(a,function(a){this.addWidget(a)},this),this.publishPoolChangeEvent())},_onWidgetSettingPageOk:function(a){this.opened&&(a.id?l.publish("configChanged",a.id,a):"poolWidgets"===this.name&&(this.addWidget(a),
this.publishPoolChangeEvent()))},publishPoolChangeEvent:function(){var a=[],b=[];this.nodeList.visitNodes(function(d,h){"widget"===d.type&&!d.gnode?(d.setting.index=h,b.push(d.setting)):"group"===d.type&&(d.setting.index=h,a.push(d.setting))});l.publish("configChanged","widgetPool",{widgets:b,groups:a},{controllerId:this.controller.id})}})})},"builder/config/MoveableNode":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Evented dojo/aspect dojo/mouse dojo/topic dojo/query ./Mover dojo/dnd/move dojo/mouse dojo/NodeList-dom dojo/NodeList-manipulate dijit/_WidgetBase jimu/dijit/Message jimu/utils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w){return q([x,l],{type:"",label:"",isMoving:!1,isMouseDown:!1,postMixInProperties:function(){this.nls=b.mixin({},builderNls.common);this.nls=b.mixin(this.nls,builderNls.widgets)},postCreate:function(){this.inherited(arguments);"addBtn"===this.type?(this.label="addBtn",this.createAddBtn()):"empty"===this.type?(this.label="empty",this.createEmptyNode()):("widget"===this.type?this.createWidgetNode():this.createGroupNode(),"poolWidgets"===this.listName&&(this.dnd=
new f.boxConstrainedMoveable(this.domNode,{handle:this.boxNode,box:this.parentBox,within:!0,delay:5,mover:m}),this.bindMoveEvent()));c.addClass(this.domNode,"moveable");c.setStyle(this.domNode,{width:this.w+"px",height:this.h+"px"})},bindMoveEvent:function(){k.after(this.dnd,"onMoveStart",b.hitch(this,function(){this.isMoving=!0}),!0);k.after(this.dnd,"onMoveStop",b.hitch(this,function(){this.isMoving=!1}),!0)},_createWidgetIconNode:function(){var b=this.setting.icon;if(this.setting.icon.startWith("widgets")||
this.setting.icon.startWith("themes"))b=require(w.getRequireConfig()).toUrl(this.setting.icon);this.iconNode=c.create("img",{"class":"icon",src:b,style:{width:"40px",height:"40px",margin:(this.w-40)/2+"px"}},this.boxNode)},_createPlaceholderNode:function(){this.placeholderNode=c.create("div",{"class":"placehoder",style:{width:"40px",height:"40px",margin:(this.w-40)/2+"px"}},this.boxNode);c.create("div",{"class":"placehoder-inner",innerHTML:this.setting.placeholderIndex,style:{width:"24px",height:"24px",
lineHeight:"24px",borderRadius:"12px",margin:"7px"}},this.placeholderNode)},createWidgetNode:function(){c.addClass(this.domNode,"widget-node");this.boxNode=c.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);this.setting.uri?this._createWidgetIconNode():this._createPlaceholderNode();this.label=this.setting.label?this.setting.label:this.nls.defaultWidgetLabel;this.name=this.setting.name?this.setting.name:this.nls.defaultWidgetLabel;this.labelNode=c.create("div",
{"class":"label",innerHTML:this.label,title:this.label},this.domNode);!1===this.setting.visible&&c.addClass(this.domNode,"hide");this.own(g(this.boxNode,s.enter,b.hitch(this,function(){n.publish("actionTriggered",this.setting.id,"highLight");this.setting.uri&&(this.editNode=this._createEditNode(),this.own(g(this.editNode,"click",b.hitch(this,function(b){b.stopPropagation();n.publish("editWidget",this.setting)}))),!1===this.setting.inPanel?(this.switchNode=this._createSwitchNode(),this.own(g(this.switchNode,
"click",b.hitch(this,function(h){h.stopPropagation();h=b.clone(this.setting);!1===h.visible?(h.visible=!0,c.removeClass(this.domNode,"hide")):(h.visible=!1,c.addClass(this.domNode,"hide"));n.publish("configChanged",h.id,h)})))):(this.dropNode=this._createDropNode(),this.own(g(this.dropNode,"click",b.hitch(this,function(h){h.stopPropagation();var a=new u({message:this.nls.dropWidgetMessage,buttons:[{label:this.nls.ok,onClick:b.hitch(this,function(){"poolWidgets"===this.listName?console.log("list name poolWidgets"):
(this.setting.uri="",this.setting.label=this.nls.defaultWidgetLabel,this.setting.name=void 0,this.setting.placeholderIndex="?",this.setting.config=void 0,this.label=this.nls.defaultWidgetLabel,this.labelNode.innerHTML=this.label,c.destroy(this.iconNode),this._createPlaceholderNode());this.emit("removeNode");a.close()})},{label:this.nls.cancel}]})})))))})));this.own(g(this.boxNode,s.leave,b.hitch(this,function(){n.publish("actionTriggered",this.setting.id,"removeHighLight");this.editNode&&c.destroy(this.editNode);
this.dropNode&&c.destroy(this.dropNode);this.switchNode&&c.destroy(this.switchNode)})))},createGroupNode:function(){c.addClass(this.domNode,"group-node");this.boxNode=c.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);this.label=this.setting.label?this.setting.label:"Group";this.name=this.setting.name?this.setting.name:"Group";this.labelNode=c.create("div",{"class":"label",innerHTML:this.setting.label,title:this.setting.label},this.domNode);this._createSmallWidgets();
this.own(g(this.boxNode,s.enter,b.hitch(this,function(){n.publish("actionTriggered",this.setting.id,"highLight");this.editNode=this._createEditNode();this.own(g(this.editNode,"click",b.hitch(this,function(b){b.stopPropagation();n.publish("editGroup",this,this.setting)})));this.own(g(this.editNode,"mousedown",function(b){b.stopPropagation()}));this.own(g(this.editNode,"mouseup",function(b){b.stopPropagation()}));"poolWidgets"===this.listName&&(this.dropNode=this._createDropNode(),this.own(g(this.dropNode,
"click",b.hitch(this,function(h){var a=new u({message:this.nls.dropGroupMessage,buttons:[{label:this.nls.ok,onClick:b.hitch(this,function(){this.emit("removeNode");a.close()})},{label:this.nls.cancel}]});h.stopPropagation()}))),this.own(g(this.dropNode,"mousedown",function(b){b.stopPropagation()})),this.own(g(this.dropNode,"mouseup",function(b){b.stopPropagation()})))})));this.own(g(this.boxNode,s.leave,b.hitch(this,function(){n.publish("actionTriggered",this.setting.id,"removeHighLight");this.editNode&&
c.destroy(this.editNode);this.dropNode&&c.destroy(this.dropNode)})));this.own(g(this.boxNode,"click",b.hitch(this,function(b){b.preventDefault();b.stopPropagation();"open"===this.status?this.closeGroup():this.openGroup()})))},closeGroup:function(){this.status="close"},openGroup:function(){this.status="open"},createAddBtn:function(){c.addClass(this.domNode,"add-widget-node");var b=c.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);c.create("img",{src:"builder/css/images/add_widget.png"},
b);c.create("div",{"class":"label",innerHTML:this.nls.addWidget},b)},createEmptyNode:function(){c.addClass(this.domNode,"empty-node");c.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode)},_createEditNode:function(){return c.create("div",{"class":"edit-btn",style:{right:"4px",bottom:"4px",width:"25px",height:"25px"}},this.boxNode)},_createDropNode:function(){return c.create("div",{"class":"drop-btn",style:{right:"3px",top:"3px",width:"10px",height:"10px"}},this.boxNode)},
_createSwitchNode:function(){return c.create("div",{"class":"switch-btn",style:{right:"3px",top:"3px",width:"15px",height:"10px"}},this.boxNode)},_createSmallWidgets:function(){p(".small",this.boxNode).remove();var h=[],a=!1;4<this.setting.widgets.length?(h=this.setting.widgets.slice(0,3),a=!0):(h=this.setting.widgets,a=!1);h.forEach(b.hitch(this,function(a){this._createSmallWidget(a)}));a&&this._createSmallMore()},_createSmallWidget:function(b){var a;a=c.create("div",{"class":"small small-widget",
"data-wid":b.id,style:{width:"20px",height:"20px",marginLeft:(this.w-40)/3+"px",marginTop:(this.w-40)/3+"px"}},this.boxNode);var e=b.icon;if(b.icon.startWith("widgets")||b.icon.startWith("themes"))e=require(w.getRequireConfig()).toUrl(b.icon);c.create("img",{src:e,style:{width:"20px",height:"20px"}},a);return a},_createSmallMore:function(){var b;b=c.create("div",{"class":"small small-more",style:{width:"20px",height:"20px",marginLeft:(this.w-40)/3+"px",marginTop:(this.w-40)/3+"px"}},this.boxNode);
c.create("img",{src:"builder/images/more_widget.png",style:{width:"20px"}},b);return b},addWidget:function(b){"group"!==this.type?console.log("can not add widget to widget"):(this.setting.widgets.push(b.setting),this._createSmallWidgets())},updateSmallWidgets:function(){this._createSmallWidgets()},destroy:function(){this.margin&&this.margin.destroy();this.inherited(arguments)}})})},"builder/config/Mover":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/sniff dojo/_base/window dojo/dom dojo/dom-geometry dojo/dom-style dojo/Evented dojo/on dojo/touch dojo/dnd/common dojo/dnd/autoscroll".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v){g.add("ie11",function(){var b=-1,c="",f=null;"Microsoft Internet Explorer"===navigator.appName?(c=navigator.userAgent,f=/MSIE ([0-9]{1,}[.0-9]{0,})/,null!==f.exec(c)&&(b=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(c=navigator.userAgent,f=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!==f.exec(c)&&(b=parseFloat(RegExp.$1)));return b});return c("dojo.dnd.Mover",[p],{constructor:function(c,g,l){function w(b){b.preventDefault();b.stopPropagation()}this.node=
k.byId(c);this.marginBox={l:g.pageX,t:g.pageY};this.mouseButton=g.button;g=this.host=l;c=c.ownerDocument;this.events=[m(c,f.move,b.hitch(this,"onFirstMove")),m(c,f.move,b.hitch(this,"onMouseMove")),m(c,f.release,b.hitch(this,"onMouseUp")),m(c,"dragstart",w),m(c.body,"selectstart",w)];v.autoScrollStart(c);if(g&&g.onMoveStart)g.onMoveStart(this)},onMouseMove:function(b){v.autoScroll(b);var c=this.marginBox;this.host.onMove(this,{l:c.l+b.pageX,t:c.t+b.pageY},b);b.preventDefault();b.stopPropagation()},
onMouseUp:function(b){var c=g("webkit")&&g("mac")&&2===this.mouseButton,f=(g("ie")||g("ie11"))&&-1===this.mouseButton;(c||f?0===b.button:this.mouseButton===b.button)&&this.destroy();b.preventDefault();b.stopPropagation()},onFirstMove:function(b){var c=this.node.style,f,k=this.host;switch(c.position){case "relative":case "absolute":f=Math.round(parseFloat(c.left))||0;c=Math.round(parseFloat(c.top))||0;break;default:c.position="absolute";c=s.getMarginBox(this.node);f=l.doc.body;var h=n.getComputedStyle(f),
a=s.getMarginBox(f,h),h=s.getContentBox(f,h);f=c.l-(h.l-a.l);c=c.t-(h.t-a.t)}this.marginBox.l=f-this.marginBox.l;this.marginBox.t=c-this.marginBox.t;if(k&&k.onFirstMove)k.onFirstMove(this,b);this.events.shift().remove()},destroy:function(){q.forEach(this.events,function(b){b.remove()});var b=this.host;if(b&&b.onMoveStop)b.onMoveStop(this);this.events=this.node=this.host=null}})})},"builder/config/LinkList":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/_base/array"],function(q){return q(null,
{headNode:null,currentNode:null,constructor:function(c){this.name=c.name},visitNodes:function(c){for(var b=this.headNode,g=1;b;)c(b,g),g++,b=b.next},destroyAllNodes:function(){for(var c=this.headNode,b;c;)b=c.next,c.destroy(),c=b;this.headNode=null},getCount:function(){var c=0;this.visitNodes(function(b,g){c=g});return c},isExist:function(c){var b=!1;this.visitNodes(function(g){g===c&&(b=!0)});return b},printNodeList:function(){this.visitNodes(function(c){})},getPreNode:function(c){var b;this.visitNodes(function(g){g.next===
c&&(b=g)});return b},getNodeByIndex:function(c){var b;this.visitNodes(function(g,l){l===c&&(b=g)});return b},getNodeByLabel:function(c){var b;this.visitNodes(function(g){g.label===c&&(b=g)});return b},getNodeIndex:function(c){var b;this.visitNodes(function(g,l){g===c&&(b=l)});return b},removeNode:function(c){var b;(b=this.getPreNode(c))?b.next=c.next:this.headNode=c.next;c.destroy()},removeNodeByIndex:function(c){this.removeNode(this.getNodeByIndex(c))},insertNode:function(c,b){var g,l;g="number"===
typeof b?this.getNodeByIndex(b):b;(l=this.getPreNode(g))?l.next=c:this.headNode=c;c.next=g},moveNode:function(c,b){var g=this.getPreNode(c),l=this.getPreNode(b);c!==b&&c!==l&&(g?g.next=c.next:this.headNode=c.next,c.next=b,l?l.next=c:this.headNode=c)}})})},"builder/config/WidgetSettingPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/config dojo/Deferred dojo/request dojo/topic dojo/aspect dojo/on dojo/mouse dojo/query dojo/string dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/WidgetSettingPage.html ./WidgetDefaultSettingPage jimu/utils jimu/WidgetManager jimu/portalUrlUtils jimu/dijit/ViewStack jimu/dijit/ImageChooser jimu/dijit/LoadingIndicator jimu/dijit/Message dijit/form/CheckBox".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z,y,E){var H={overview:"widget-overview.htm",attributetable:"widget-attribute-table.htm",basemapgallery:"widget-basemap.htm",bookmark:"widget-bookmark.htm",chart:"widget-chart.htm",headercontroller:"widget-header-controller-and-sidebar-controller.htm",sidebarcontroller:"widget-header-controller-and-sidebar-controller.htm",coordinate:"widget-coordinates.htm",directions:"widget-directions.htm",draw:"widget-draw.htm",edit:"widget-edit.htm",geocoder:"widget-geocoder.htm",
geoprocessing:"widget-geoprocessing.htm",homebutton:"widget-home-button.htm",layerlist:"widget-layer-list.htm",legend:"widget-legend.htm",measurement:"widget-measurement.htm",mylocation:"widget-my-location.htm",overviewmap:"widget-overview-map.htm",print:"widget-print.htm",query:"widget-query.htm",scalebar:"widget-scalebar.htm"},F={overview:"#",attributetable:"120000943",basemapgallery:"120000944",bookmark:"120000945",chart:"120000946",headercontroller:"120000963",sidebarcontroller:"120000963",coordinate:"120000947",
directions:"120000948",draw:"120000949",edit:"120000950",geocoder:"120000951",geoprocessing:"120000952",homebutton:"120000953",layerlist:"120000954",legend:"120000955",measurement:"120000956",mylocation:"120000957",overviewmap:"120000958",print:"120000959",query:"120000960",scalebar:"120000961",splash:"120000964"},G={overview:"#",attributetable:"120000943",basemapgallery:"120000944",bookmark:"120000945",chart:"120000946",headercontroller:"120000963",sidebarcontroller:"120000963",coordinate:"120000947",
directions:"120000948",draw:"120000949",edit:"120000950",geocoder:"120000951",geoprocessing:"120000952",homebutton:"120000953",layerlist:"120000954",legend:"120000955",measurement:"120000956",mylocation:"120000957",overviewmap:"120000958",print:"120000959",query:"120000960",scalebar:"120000961",splash:"120000964"};return q([x,u,w],{templateString:h,postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.widgets)},startup:function(){this.inherited(arguments);
this.own(m(window,"resize",c.hitch(this,this.resize)));this.init()},init:function(){this.loading=new z;this.loading.placeAt(this.widgetSettingNode);this.initCommonAttr();this.initWidgetAttr();this.resize()},resize:function(){var a=b.getContentBox(this.domNode);b.setStyle(this.widgetSettingNode,{height:a.h-90+"px"})},onCancel:function(){this.onClose();this.popup.close()},onOk:function(){var a=this._checkLabelExist();if(a)return new y({message:a}),!1;this.iconNode.src&&(this.setting.icon=this.iconNode.src);
this.setting.label=b.getAttr(this.labelNode,"value");if(this.settingDijit){a=this.settingDijit.getConfig(!0);if(!1===a)return!1;this.setting.config=a}n.publish("widgetSettingPageOk",this.setting);this.onClose();this.popup.close()},_checkLabelExist:function(){var a=0,d=b.getAttr(this.labelNode,"value");if(""===v.trim(d))return this.nls.labelRequired;this.appConfig.visitElement(c.hitch(this,function(b){this.setting.id!==b.id&&b.label===d&&a++}));return 0<a?this.nls.labelExists:""},onClose:function(){this.settingViewStack?
(this.settingDijitUI.destroy(),this.settingDijitJSON.destroy(),this.settingViewStack.destroy()):this.settingDijit&&this.settingDijit.destroy()},_getHelpLink:function(a){var b=new k;a=a.toLowerCase();if(window.isXT)s("/webappbuilder/help/cxhelp.js",{handleAs:"json"}).then(c.hitch(this,function(d){var e="#";d&&(d.m&&d.m[G[a]])&&(e="/webappbuilder/help/"+d.m[G[a]]);b.resolve(e)}),c.hitch(this,function(a){console.warn(a);b.resolve("#")}));else{var d=A.getPortalUrlFromLocation();-1<d.indexOf("arcgis.com")?
b.resolve("http://doc.arcgis.com/en/web-appbuilder/create-apps/"+H[a]):s(d+"portalhelp/en/website/help/cxhelp.js",{handleAs:"json"}).then(c.hitch(this,function(e){var h="#";e&&(e.m&&e.m[F[a]])&&(h=d+"portalhelp/en/website/help/"+e.m[F[a]]);b.resolve(h)}),c.hitch(this,function(a){console.warn(a);b.resolve("#")}))}return b},initCommonAttr:function(){var a=this.setting.icon;if(this.setting.icon.startWith("widgets")||this.setting.icon.startWith("themes"))a=require(e.getRequireConfig()).toUrl(this.setting.icon);
b.setAttr(this.iconNode,"src",a);b.setAttr(this.labelNode,"value",this.setting.label);this._getHelpLink(this.setting.name).then(c.hitch(this,function(a){b.setStyle(this.helpNode,"display","inline-block");b.setAttr(this.helpNode,"href",a)}));this.setting.inPanel?(this.imageChooser=new C({},this.imageChooser),this.own(m(this.imageChooser,"imageChange",c.hitch(this,function(a){this.iconNode.src=a})))):b.addClass(this.changeNode,"disable-change-icon")},initWidgetAttr:function(){!1===this.setting.hasConfig?
this.widgetSettingNode.innerHTML='\x3cdiv class\x3d"noconfig-info"\x3e'+this.nls.noConfig+"\x3c/div\x3e":d.getInstance().tryLoadWidgetConfig(this.setting).then(c.hitch(this,function(e){this.setting.config=e;this.setting.hasSettingPage?d.getInstance().loadWidgetSettingPage(this.setting).then(c.hitch(this,function(a){this.widgetSettingNode?(this.settingDijit=a,b.place(this.settingDijit.domNode,this.widgetSettingNode),this.settingDijit.startup(),this.loading.destroy()):a.destroy()})):this.widgetSettingNode&&
(this.settingDijit=new a({config:this.setting.config}),b.place(this.settingDijit.domNode,this.widgetSettingNode),this.settingDijit.startup(),this.loading.destroy())}))},setAppConfig:function(a){this.appConfig=a}})})},"builder/config/WidgetDefaultSettingPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/keys dijit/_WidgetBase ./JSONEditor".split(" "),function(q,c,b,g,l,k){return q([l],{baseClass:"widget-default-setting",postCreate:function(){this.inherited(arguments);this.jsonEditor=
new k({json:this.config});this.jsonEditor.placeAt(this.domNode);this.own(b(this.domNode,"keydown",c.hitch(this,"_onEnterPress")))},_onEnterPress:function(b){(void 0!==b.keyCode?b.keyCode:b.which)===g.ENTER&&b.stopPropagation()},setConfig:function(b){return this.jsonEditor.setJSON(b)},getConfig:function(){return this.jsonEditor.getJSON()}})})},"builder/config/JSONEditor":function(){define(["dojo/_base/declare","dijit/_WidgetBase"],function(q,c){return q([c],{baseClass:"json-editor",postCreate:function(){this.inherited(arguments);
this.editor=ace.edit(this.domNode);this.editor.setTheme("ace/theme/textmate");this.editor.setHighlightActiveLine(!0);this.editor.setValue(JSON.stringify(this.json,null,2));this.editor.getSession().setMode("ace/mode/json")},setJSON:function(b){this.json=b;this.editor.setValue(JSON.stringify(this.json,null,2))},getJSON:function(){return JSON.parse(this.editor.getValue())}})})},"builder/config/GroupSettingPage":function(){define("dojo/_base/declare dojo/dom-attr dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/GroupSettingPage.html".split(" "),
function(q,c,b,g,l,k){return q([g,l],{templateString:k,baseClass:"group-setting-page",postMixInProperties:function(){this.nls=builderNls.groups},startup:function(){this.labelNode.value=this.setting.label},onOk:function(){this.setting.label=c.get(this.labelNode,"value");b.publish("configChanged",this.setting.id,this.setting);this.popup.close()},onCancel:function(){}})})},"builder/config/WidgetChoosePage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/request/xhr dojo/topic dojo/aspect dojo/on dojo/Deferred dojo/promise/all dojo/mouse dojo/query dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/WidgetChoosePage.html jimu/dijit/Search jimu/WidgetManager jimu/dijit/LoadingShelter jimu/dijit/Message jimu/utils ../serviceUtils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A){return q([r,x],{templateString:u,postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.widgetManager=h.getInstance()},startup:function(){this.inherited(arguments);this.searchDijit=new w({placeholder:this.nls.widgetName,onSearch:c.hitch(this,this.searchWidget),searchWhenInput:!0},this.searchInputNode);this._getWidgets();this.own(n(window,"resize",c.hitch(this,this.resize)));setTimeout(c.hitch(this,function(){this.resize()}),
100);this.loading=new a({hidden:!0});this.loading.placeAt(this.domNode);this.loading.startup()},searchWidget:function(a){var b;b=""===a?this.allWidgets:g.filter(this.allWidgets,function(b){if(-1<b.label.toUpperCase().indexOf(a.toUpperCase()))return!0});this._createWidgetNodes(b)},resize:function(){var a=b.getContentBox(this.domNode).h-50-10,d=a-60;b.setStyle(this.searchSectionNode,{height:a+"px"});b.setStyle(this.widgetListNode,{height:d+"px"})},setAppConfig:function(a){this.appConfig=a},_getWidgets:function(){var a=
{};this.appConfig.map["2D"]&&(a.support2D=!0);this.appConfig.map["3D"]&&(a.support3D=!0);this.appConfig.map["2D"]&&this.appConfig.map["3D"]&&(a.support2D=!0,a.support3D=!0);a["properties.inPanel"]=!0;A.searchWidgets(a).then(c.hitch(this,function(a){a.success?(this.allWidgets=a.widgets,this._createWidgetNodes(this.allWidgets)):console.log(a.message)}))},_createWidgetNodes:function(a){b.empty(this.widgetListNode);g.forEach(a,function(a){d.processManifestLabel(a,dojoConfig.locale);this._createWidgetNode(a)},
this)},_createWidgetNode:function(a){var e,h;e=b.create("div",{"class":"widget-node"},this.widgetListNode);h=b.create("div",{"class":"box"},e);b.create("div",{"class":"box-border"},e);b.create("img",{"class":"icon",src:a.icon},h);b.create("div",{"class":"label",innerHTML:a.label,title:a.label},e);e.setting={name:a.name,label:a.label};e.setting=c.mixin(e.setting,a.properties);e.setting.icon="widgets/"+a.name+"/images/icon.png";e.setting.uri="widgets/"+a.name+"/Widget";d.processWidgetSetting(e.setting);
e.box=h;this.own(n(e,"click",c.hitch(this,this._onWidgetClick,e)));return e},_onWidgetClick:function(a){"addBtn"===this.fromNode.type?b.hasClass(a,"jimu-state-selected")?b.removeClass(a,"jimu-state-selected"):b.addClass(a,"jimu-state-selected"):(t(".jimu-state-selected",this.domNode).removeClass("jimu-state-selected"),b.addClass(a,"jimu-state-selected"))},onOk:function(){var a=t(".jimu-state-selected",this.domNode);if(0===a.length)new e({message:this.nls.emptyMessage});else{this.loading.show();var b=
g.map(a,function(a){return c.clone(a.setting)}),d=[];g.forEach(b,function(a){d.push(this._copyWidget(a))},this);m(d).then(c.hitch(this,function(a){var d;for(d=0;d<a.length;d++)if(!a[d].success){new e({message:a[d].message});this.loading.hide();return}this.loading.hide();k.publish("widgetChoosePageOk",b,this.fromNode);this.popup.close()}))}},_copyWidget:function(a){var b=0,d;this.appConfig.visitElement(c.hitch(this,function(d){d.name===a.name&&b++}));0===b?(a.label=a.label,d=A.copyWidgetToApp(appId,
a.name,a.label)):0<b&&(d=new p,a.label=a.label+"_"+(b+1),d.resolve({success:!0}));return d}})})},"builder/utils":function(){define(["dojo/cookie"],function(q){var c={},b=q("appbuilder_xt");c.getAppPathById=function(c){return"stemapp"===c?path+"stemapp/":b?path+"apps/"+c+"/":path+"stemapp/index.html?id\x3d"+c+"/"};c.getAppWidgetPath=function(g,l){return"stemapp"===g||!b?path+"stemapp/widgets/"+l+"/":c.getAppPathById(g)+"widgets/"+l+"/"};c.getAppWidgetsPackageLoacation=function(g){return b?c.getAppPathById(g)+
"widgets":path+"stemapp/widgets"};c.getAppThemesPackageLoacation=function(g){return b?c.getAppPathById(g)+"themes":path+"stemapp/themes"};c.appendParamsToAppPath=function(b,c){var k=b,s;for(s in c)c.hasOwnProperty(s)&&(k=0>k.indexOf("?")?k+"?"+s+"\x3d"+c[s]:k+"\x26"+s+"\x3d"+c[s]);return k};return c})},"builder/config/AttributeConfig":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/dom dojo/aspect dojo/mouse dojo/query dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AttributeConfig.html dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-attr dojo/_base/array builder/portalUtils ../utils jimu/dijit/CheckBox jimu/dijit/ImageChooser".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A){return q([f,t,v],{templateString:r,appConfig:null,selectLinkNode:null,selectProxyRuleNode:null,initedLinks:!1,initedProxy:!1,_currentPortalUrl:null,showProxySetting:!1,showAlwaysUseProxy:!1,postMixInProperties:function(){this.inherited(arguments);this.nls=c.mixin({},builderNls.settings);this.nls=c.mixin(this.nls,builderNls.attributes);this.nls=c.mixin(this.nls,builderNls.common)},postCreate:function(){this.inherited(arguments);this.useProxySetting=
new A({label:this.nls.useProxySetting,checked:!1},this.useProxySetting);this.alwaysUseProxy=new A({label:this.nls.alwaysUseProxyLabel,checked:!1},this.alwaysUseProxy);this._bindEvents()},startup:function(){this.inherited(arguments);this._keepOrder();b.addClass(this.imageChooser.domNode,"no-logo")},_bindEvents:function(){this.own(l(this.titleNode,"change",c.hitch(this,this.onTitleChange)));this.own(l(this.subtitleNode,"change",c.hitch(this,this.onSubtitleChange)));this.own(l(this.imageChooser,"imageChange",
c.hitch(this,"onLogoChange")));this.own(l(this.useProxySetting,"click",c.hitch(this,this._onUseProxySettingChange)));this.own(l(this.alwaysUseProxy,"click",c.hitch(this,this._onAlwaysUseProxyChange)));this.own(l(this.proxyUrlNode,"change",c.hitch(this,this._onProxyUrlChange)));this.own(l(this.proxyUrlNode,"blur",c.hitch(this,this._onProxyUrlBlur)));this.own(l(this.appIdNode,"change",c.hitch(this,this._onAppIdChange)));this.own(l(this.domNode,"click",c.hitch(this,function(){this.selectLinkNode&&(b.removeClass(this.selectLinkNode,
"selected-item"),this.selectLinkNode=null);this.selectProxyRuleNode&&(b.removeClass(this.selectProxyRuleNode,"selected-item"),this.selectProxyRuleNode=null)})))},init:function(a){this.appConfig=a||{};this.initHeader(a);this.initedLinks||(this.initLinks(a),this.initedLinks=!0);this.initedProxy||(this.initProxy(a),this.initedProxy=!0);this._currentPortalUrl!==a.portalUrl&&(this.initAppId(a),this._currentPortalUrl=a.portalUrl)},setAppConfig:function(a){this.init(a)},initHeader:function(a){var e=a.logo;
e&&(e&&(!e.startWith("/")&&!e.startWith("http")&&!e.startWith("data"))&&(e=d.getAppPathById(appId)+e),b.setAttr(this.logoNode,"src",e),w.set(this.noLogoNode,"display","none"),w.set(this.logoNode,"display","block"));a.title&&b.setAttr(this.titleNode,"value",a.title);a.subtitle&&b.setAttr(this.subtitleNode,"value",a.subtitle)},onLogoChange:function(a){b.setAttr(this.logoNode,"src",a);w.set(this.noLogoNode,"display","none");w.set(this.logoNode,"display","block");g.publish("configChanged","app",{logo:a})},
onTitleChange:function(a){g.publish("configChanged","app",{title:a.target.value})},onSubtitleChange:function(a){g.publish("configChanged","app",{subtitle:a.target.value})},initLinks:function(a){b.empty(this.linksListNode);a.links&&a.links.forEach(c.hitch(this,function(a){this.createLinkNode(a)}))},initProxy:function(d){if(d=d.httpProxy)this.useProxySetting.setValue(d.useProxy),this.showProxySetting=!!d.useProxy,this._onUseProxySettingChange(),this.alwaysUseProxy.setValue(d.alwaysUseProxy),this.showAlwaysUseProxy=
!!d.alwaysUseProxy,this._onAlwaysUseProxyChange(),d.url&&b.setAttr(this.proxyUrlNode,"value",d.url),d.rules&&(b.empty(this.proxyRulesListNode),a.forEach(d.rules,c.hitch(this,function(a){this.createProxyRuleNode(a)})))},initAppId:function(a){e.getPortal(a.portalUrl).loadSelfInfo().then(c.hitch(this,function(d){d.supportsOAuth?(b.setStyle(this.appIdSection,"display","none"),b.setAttr(this.appIdNode,"value",a.appId)):b.setStyle(this.appIdSection,"display","none")}),c.hitch(this,function(a){this.shelter.hide();
console.error(a)}))},getLinks:function(){var a=[];p(".links-list .list-item",this.domNode).forEach(c.hitch(this,function(b){var d=p(".first input",b).attr("value")[0];b=p(".second input",b).attr("value")[0];d&&a.push({label:d,url:b})}));return a},getProxy:function(){var a=[],d=b.getAttr(this.proxyUrlNode,"value");p(".proxy-rule-list .list-item",this.domNode).forEach(c.hitch(this,function(b){var d=p(".first input",b).attr("value")[0];b=p(".second input",b).attr("value")[0];d&&a.push({urlPrefix:d,proxyUrl:b})}));
return{useProxy:this.useProxySetting.getValue(),alwaysUseProxy:this.alwaysUseProxy.getValue(),url:d,rules:a}},_bindNodeEvents:function(a,d,e,h,f,k){this.own(l(a,"click",c.hitch(this,function(d){"links"===k?(this.selectLinkNode&&b.removeClass(this.selectLinkNode,"selected-item"),b.addClass(a,"selected-item"),this.selectLinkNode=a):"proxyRules"===k&&(this.selectProxyRuleNode&&b.removeClass(this.selectProxyRuleNode,"selected-item"),b.addClass(a,"selected-item"),this.selectProxyRuleNode=a);d.stopPropagation()})));
this.own(l(d,"dblclick",c.hitch(this,function(){b.setStyle(d,"display","none");b.setStyle(e,"display","block");e.focus();e.select()})));this.own(l(h,"dblclick",c.hitch(this,function(){b.setStyle(h,"display","none");b.setStyle(f,"display","block");f.focus();f.select()})));this.own(l(f,"focus",function(a){a.target.value||(a.target.value="http://")}));this.own(l(e,"blur",c.hitch(this,function(a){b.setAttr(d,{innerHTML:a.target.value||d.innerHTML,style:{display:"block"}});b.setStyle(e,"display","none");
"links"===k?g.publish("configChanged","app",{links:this.getLinks()}):"proxyRules"===k&&this._publishProxy()})));this.own(l(f,"blur",c.hitch(this,function(a){b.setAttr(h,{innerHTML:a.target.value||h.innerHTML,style:{display:"block"}});b.setStyle(f,"display","none");"links"===k?g.publish("configChanged","app",{links:this.getLinks()}):"proxyRules"===k&&this._publishProxy()})))},_createListItem:function(a,d,e,h,c){var f=b.create("div",{"class":"list-item"}),k=b.create("div",{"class":"first"},f);e=b.create("div",
{"class":"mask",innerHTML:d||e,title:e},k);var k=b.create("input",{style:{display:"none"}},k),g=b.create("div",{"class":"second"},f);c=b.create("div",{"class":"mask",innerHTML:h||c,title:c},g);g=b.create("input",{style:{display:"none"}},g);b.setAttr(k,"value",d);b.setAttr(g,"value",h);this._bindNodeEvents(f,e,k,c,g,a);d||this.focusNewItem(f,e,k,a);return f},focusNewItem:function(a,d,e,h){"links"===h?(this.selectLinkNode&&b.removeClass(this.selectLinkNode,"selected-item"),b.addClass(a,"selected-item"),
this.selectLinkNode=a):"proxyRules"===h&&(this.selectProxyRuleNode&&b.removeClass(this.selectProxyRuleNode,"selected-item"),b.addClass(a,"selected-item"),this.selectProxyRuleNode=a);b.setStyle(d,"display","none");b.setStyle(e,"display","block");e.value=d.innerHTML;setTimeout(function(){e.focus();e.select()},0)},createLinkNode:function(a){a=this._createListItem("links",a.label,this.nls.labelPlaceholder,a.url,this.nls.urlPlaceholder);b.place(a,this.linksListNode)},createProxyRuleNode:function(a){a=
this._createListItem("proxyRules",a.urlPrefix,this.nls.prefixPlaceholder,a.proxyUrl,this.nls.proxyUrlPlaceholder);b.place(a,this.proxyRulesListNode)},_keepOrder:function(){var a=b.getMarginBox(this.headerSection),d=b.getMarginBox(this.linksSection),e=b.getMarginBox(this.appIdSection),h=b.getMarginBox(this.useProxySection),a=a.h+d.h+e.h+h.h,d=b.getMarginBox(this.domNode).h;a>d&&b.setStyle(this.domNode,"paddingRight","10px")},onAddLinkClick:function(a){a.stopPropagation();4!==p(".links-list .list-item",
this.domNode).length&&(this.createLinkNode({label:"",url:""}),this._keepOrder())},_onEditItemClick:function(a){var d=p(".first .mask",a)[0];a=p(".first input",a)[0];b.setStyle(d,"display","none");b.setStyle(a,"display","block");a.focus();a.select()},onEditLinkClick:function(){this.selectLinkNode&&this._onEditItemClick(this.selectLinkNode)},onDeleteLinkClick:function(){this.selectLinkNode&&(b.destroy(this.selectLinkNode),g.publish("configChanged","app",{links:this.getLinks()}))},onAddProxyRuleClick:function(a){this.createProxyRuleNode({urlPrefix:"",
proxyUrl:""});this._keepOrder();a.stopPropagation()},onEditProxyRuleClick:function(){this.selectProxyRuleNode&&this._onEditItemClick(this.selectProxyRuleNode)},onDeleteProxyRuleClick:function(){this.selectProxyRuleNode&&(b.destroy(this.selectProxyRuleNode),g.publish("configChanged","app",{httpProxy:this.getProxy()}))},_onUseProxySettingChange:function(){this.useProxySetting.checked?b.setStyle(this.proxySection,"display","block"):b.setStyle(this.proxySection,"display","none");this.showProxySetting!==
this.useProxySetting.checked&&(this._publishProxy(),this.showProxySetting=this.useProxySetting.checked)},_onAlwaysUseProxyChange:function(){this.showAlwaysUseProxy!==this.alwaysUseProxy.checked&&(this._publishProxy(),this.showAlwaysUseProxy=this.alwaysUseProxy.checked)},_onProxyUrlChange:function(){this._publishProxy()},_onProxyUrlBlur:function(){this.proxyUrlNode.value?b.removeClass(this.proxyUrlNode,"error-status"):b.addClass(this.proxyUrlNode,"error-status")},_onAppIdChange:function(){g.publish("configChanged",
"app",{appId:this.appIdNode.value})},_publishProxy:function(){g.publish("configChanged","app",{httpProxy:this.getProxy()})}})})},"builder/config/TabContainer2":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dojo/NodeList-manipulate dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer2.html jimu/dijit/ViewStack".split(" "),function(q,c,b,g,l,k,s,n,p,m,f,t){return q([p,m,k],{templateString:f,_controlNodes:null,
selected:"",tabs:null,"class":"jimu-tab2",postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.leftPane)},postCreate:function(){this.inherited(arguments);this._controlNodes=[];this.viewStack=new t(null,this.containerNode);b.forEach(this.tabs,function(b){this._createTab(b)},this)},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},_createTab:function(b){var f=g.toDom('\x3ctd\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3cdiv class\x3d"tab-item-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item-title"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e');
g.place(f,this.tabTr);var k=s(".tab-item-div",f)[0],m=s(".tab-item-icon",f)[0],f=s(".tab-item-title",f)[0];f.innerHTML=b.title||"";var w=b.title;w===this.nls.themes?(g.addClass(m,"themes"),g.addClass(f,"themes")):w===this.nls.map?(g.addClass(m,"map"),g.addClass(f,"map")):w===this.nls.widgets?(g.addClass(m,"widgets"),g.addClass(f,"widgets")):w===this.nls.attributes&&(g.addClass(m,"attributes"),g.addClass(f,"attributes"));this.viewStack.viewType=b.content.domNode?"dijit":"dom";k.label=b.title;b.content.label=
b.title;this.viewStack.addView(b.content);this.own(l(k,"click",c.hitch(this,this.onSelect,b.title)));this._controlNodes.push(k)},onSelect:function(b){this.selectTab(b)},selectTab:function(f){b.forEach(this._controlNodes,c.hitch(this,function(b){g.removeClass(b,"selected-tab-item-div");b.label===f&&g.addClass(b,"selected-tab-item-div")}));this.viewStack.switchView(f);this.emit("tabChanged",f)}})})},"builder/CreateAppNew":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dojo/Deferred dojo/keys dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/dijit dojo/text!./templates/CreateAppNew.html dojo/on dojo/dom dojo/dom-style dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/cookie dojo/promise/all jimu/dijit/Message jimu/dijit/Popup builder/portalUtils jimu/portalUrlUtils jimu/dijit/LoadingShelter dojo/ready ./serviceUtils ./Tags dijit/form/SimpleTextarea dijit/form/TextBox dijit/form/Select dijit/form/CheckBox".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z,y,E,H,F){function G(a,b,c){var f=B.getPortal(C.getPortalUrlFromLocation()),y=new l,k=new l,g=new l,E=new l;f.getUser().then(h.hitch(this,function(a){y.resolve(a)}),h.hitch(this,function(a){new d({message:builderNls.apps.createAppUrlError});console.error(a.message);y.reject()}));f.getItemById(c).then(h.hitch(this,function(a){k.resolve(a)}),h.hitch(this,function(a){new d({message:builderNls.apps.createAppUrlError});console.error(a.message);
k.reject(a)}));e({user:y,userItem:g}).then(h.hitch(this,function(e){var c={};switch(e.userItem.sharing.access){case "public":c.everyone=!0;c.groups=e.userItem.sharing.groups.toString();break;case "account":case "org":c.org=!0;c.groups=e.userItem.sharing.groups.toString();break;case "shared":c.groups=e.userItem.sharing.groups.toString()}e.user.shareItem(c,a,b).then(h.hitch(this,function(a){E.resolve(a)}),h.hitch(this,function(a){new d({message:builderNls.apps.createAppUrlError});console.error(a.message);
E.reject()}))}));e({user:y,webmapItem:k}).then(h.hitch(this,function(e){if(e.webmapItem.owner===e.user.username)e.user.getItemById(c,e.webmapItem.ownerFolder).then(h.hitch(this,function(a){g.resolve(a)}),h.hitch(this,function(a){new d({message:builderNls.apps.createAppUrlError});console.error(a.message);g.reject(a)}));else{var f={};switch(e.webmapItem.access){case "public":f.everyone=!0;break;case "account":case "org":f.org=!0}e.user.shareItem(f,a,b).then(h.hitch(this,function(a){E.resolve(a)}),h.hitch(this,
function(a){new d({message:builderNls.apps.createAppUrlError});console.error(a.message);E.reject()}))}}))}var D=q([n,p,m],{templateString:t,baseClass:"create-app",appListWidget:null,createFromId:null,is3D:"false",_appBuilderSettings:null,_configureSettings:null,isXT:null,user:null,webmap:null,postMixInProperties:function(){this.nls=h.mixin({},builderNls.common);this.nls=h.mixin(this.nls,builderNls.apps)},postCreate:function(){this.inherited(arguments);this.isXT=a("appbuilder_xt")},constructor:function(){},
startup:function(){this.inherited(arguments);this._initDlgPage()},_initDlgPage:function(){this.appTitle.focus();this.isXT?(x.set(this.tagsTr,"display","none"),x.set(this.folderTr,"display","none"),x.set(this.sharingTr,"display","none"),u.add(this.app2D,"app-image-div-down"),this.createFromId&&x.set(this.div2dAnd3d,"display","none"),this._getInitAppInfo().then(h.hitch(this,function(a){this._setDlgProperties(a)}))):(x.set(this.div2dAnd3d,"display","none"),this.createFromId&&x.set(this.sharingTr,"display",
"none"),B.getPortal(C.getPortalUrlFromLocation()).getUser().then(h.hitch(this,function(a){this.user=a;this._initFolder(a);this._getInitAppInfo().then(h.hitch(this,function(b){f.byId("publish-webmap-tags").loadTags(a).then(h.hitch(this,function(){this._setDlgProperties(b)}))}))}),h.hitch(this,function(a){this._setDlgProperties(D.getDefaultAppInfo());console.error(a.message)})))},_saveAs:function(a){var b=new l;E.duplicateApp(a,this.appConfig).then(h.hitch(this,function(d){this._closePopup();this.destroy();
var e=h.clone(a);e.id=d.newAppId;e.name=d.newName;s.publish("switchToApp",e);(d=main.getViewByLabel("apps"))&&window.isXT&&d.refresh();b.resolve()}),h.hitch(this,function(a){console.error("APP Save As failed!"+a);new d({message:builderNls.apps.saveAsFaied});b.reject()}));return b},_onCancelClick:function(){this._closePopup();this.destroy();console.debug("cancel click")},_onNextClick:function(){if(f.byId("publish-webmap-title").get("value")){var a=this._getDlgProperties(),b=new z;b.placeAt(this.popup.domNode);
b.startup();this.createFromId?this._saveAs(this._convertAppInfo(a)).then(function(){b.destroy()},function(){b.destroy()}):D.create(this._convertAppInfo(a)).then(h.hitch(this,function(){this.appListWidget&&this.appListWidget.refresh();this._closePopup();this.destroy();b.destroy()}),function(){b.destroy()})}else new d({message:this.nls.noAppName})},_closePopup:function(){this.popup&&this.popup.close()},_on2dClick:function(){"true"===this.is3D&&(this.is3D="false",u.add(this.app2D,"app-image-div-down"),
u.remove(this.app3D,"app-image-div-down"))},_on3dClick:function(){},_getInitAppInfo:function(){var a=new l,b=D.getDefaultAppInfo();this.isXT?this.createFromId?E.getAppInfo(this.createFromId).then(h.hitch(this,function(d){b.name=d.name+this.nls._copy;b.description=d.description;this.is3D=b.is3D=d.is3D;a.resolve(b)}),h.hitch(this,function(b){console.error(this.nls.saveAsFaied,b);a.reject()})):a.resolve(b):this.createFromId?B.getPortal(C.getPortalUrlFromLocation()).getItemById(this.createFromId).then(h.hitch(this,
function(d){b.name=d.title+this.nls._copy;b.tags=d.tags;b.description=d.snippet;a.resolve(b)}),h.hitch(this,function(b){console.error(this.nls.saveAsFaied,b);a.reject()})):a.resolve(b);return a},_getDlgProperties:function(){return{name:f.byId("publish-webmap-title").get("value"),tags:f.byId("publish-webmap-tags").get("tags"),description:f.byId("publish-webmap-summary").get("value"),folderId:f.byId("publish-webmap-folder").get("value"),sharing:f.byId("publish-webmap-sharing").get("checked")}},_setDlgProperties:function(a){f.byId("publish-webmap-title").set("value",
a.name);f.byId("publish-webmap-tags").set("tags",a.tags||[]);f.byId("publish-webmap-summary").set("value",a.description);f.byId("publish-webmap-folder").set("value",a.folderId);f.byId("publish-webmap-sharing").set("checked",a.sharing);"true"===a.is3D?(u.add(this.app3D,"app-image-div-down"),u.remove(this.app2D,"app-image-div-down")):(u.add(this.app2D,"app-image-div-down"),u.remove(this.app3D,"app-image-div-down"))},_initFolder:function(a){var b=new l;a.getContent().then(h.hitch(this,function(d){var e=
[{label:a.username,value:""}],e=e.concat(c.map(d.folders,h.hitch(this,function(a){return{label:a.title,value:a.id}})));f.byId("publish-webmap-folder").set("options",e);f.byId("publish-webmap-folder").set("value","");b.resolve()}),function(a){console.error("get userContent error!");b.reject()});return b},_convertAppInfo:function(a){return{name:a.name,description:a.description,tags:a.tags,folderId:a.folderId,sharing:a.sharing,is3D:this.is3D,webmap:this.webmap,createFromId:this.createFromId}}});D.getDefaultAppInfo=
function(){return{name:"",description:"",tags:["AppBuilder App"],folderId:"",sharing:!1,is3D:"false",webmap:null,createFromId:null,creator:null}};D.create=function(a){var b=new l;E.createApp(a).then(h.hitch(this,function(e){if(e.success){var c=h.clone(a);c.id=e.newAppId;s.publish("switchToApp",c);b.resolve();a.sharing&&a.webmap&&G(e.newAppId,a.folderId,a.webmap)}else new d({message:e.message}),b.reject()}),h.hitch(this,function(a){new d({message:a.message});b.reject(a)}));return b};D.popupDlg=function(a,
b){var d=new D(a);new A({content:d,container:"main-page",titleLabel:b||builderNls.apps.appCreateTitle,width:669,autoHeight:!0,buttons:[{label:builderNls.common.ok,key:k.ENTER,onClick:h.hitch(d,d._onNextClick)},{label:builderNls.common.cancel,key:k.ESCAPE,onClick:h.hitch(d,d._onCancelClick)}]});d.startup()};return D})},"dijit/dijit":function(){define("./main ./_base dojo/parser ./_Widget ./_TemplatedMixin ./_Container ./layout/_LayoutWidget ./form/_FormWidget ./form/_FormValueWidget".split(" "),function(q){return q})},
"builder/Tags":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/on dojo/dom dojo/dom-construct dojo/parser dojo/store/Memory dojo/Deferred dojo/sniff dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_WidgetBase dijit/registry dijit/form/TextBox ./AutoComplete builder/portalUtils jimu/portalUrlUtils dojo/text!./templates/Tags.html dojo/domReady!".split(" "),function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a){return b([v,f],{templateString:a,baseClass:"esriAGOTags",_minWidth:"auto",
_maxWidth:"auto",postMixInProperties:function(){this.inherited(arguments);this.nls={addTags:builderNls.apps.addTags,noTagsFound:"No existing tags match."}},postCreate:function(){this.inherited(arguments);this._isIE8=m("ie")},startup:function(){this.inherited(arguments)},loadTags:function(a){var b=new p;this._isIE8?(this._textTags||(this.tagsId="userTags-"+(new Date).getTime(),k.create("div",{id:this.tagsId},this.domNode),this._textTags=new x({placeHolder:this.nls.addTags,trim:!0,style:{minWidth:this._minWidth,
maxWidth:this._maxWidth}},this.tagsId)),b.resolve()):a?a.getTags().then(c.hitch(this,function(a){this._handleTags(a);b.resolve()}),c.hitch(this,function(a){console.error("get user tags error: "+a);this._handleTags({tags:[]});b.resolve()})):(this._handleTags({tags:[]}),b.resolve());return b},_handleTags:function(a){if(a){this._autoComplete&&this._autoComplete.clearTags();var b=[];a.tags&&q.forEach(a.tags,c.hitch(this,function(a){b.push(a)}));this._tagStore?(this._tagStore.query({}).forEach(c.hitch(this,
function(a){this._tagStore.remove(a.tag)})),q.forEach(b,c.hitch(this,function(a){this._tagStore.add(a)}))):this._tagStore=new n({idProperty:"tag",data:b});this._autoComplete||(a=(new Date).getTime(),this.tagsId="userTags-"+a,this.gridId="grid-"+a,this.filterId="filter-"+a,k.create("div",{id:this.tagsId,className:"grid_1"},this.domNode),this._autoComplete=new u({placeholder:this.nls.addTags,noDataMsg:this.nls.noTagsFound,idProperty:"tag",gridId:this.gridId,filterId:this.filterId,minWidth:this._minWidth,
maxWidth:this._maxWidth,matchParam:"first",store:this._tagStore,style:{width:this._minWidth}},this.tagsId))}},_getUniqueTags:function(a){return q.filter(a,c.hitch(this,function(b,h){return q.indexOf(a,b)===h}))},_setValueAttr:function(a){this._setTagsAttr(a)},_getValueAttr:function(){return this._getTagsAttr()},_setTagsAttr:function(a){a&&!(a instanceof Array)&&(a=a.split(","));this._isIE8?this._textTags&&this._textTags.set("value",this._getUniqueTags(a).join(",")):this._autoComplete&&(this._autoComplete.clearTags(),
this._autoComplete.prepopulate(a?this._getUniqueTags(a):[]))},_getTagsAttr:function(){return this._isIE8?this._textTags?this._textTags.get("value"):"":this._autoComplete&&this._autoComplete.values?this._autoComplete.values.join(","):""},_setMinWidthAttr:function(a){this._minWidth=a},_setMaxWidthAttr:function(a){this._maxWidth=a}})})},"builder/AutoComplete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/html dojo/json dojo/keys dojo/on dojo/query dojo/request dojo/string dijit/focus dijit/form/TextBox dijit/registry dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetBase dgrid/OnDemandGrid dgrid/Selection dgrid/Keyboard dojo/NodeList-traverse dojo/NodeList-manipulate".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z){return c([A,e,d],{_attachmentNode:"",_autocompleteList:"",_grid:"",_store:"",_matchParam:"",_idProperty:"",_gridId:"",_filterId:"",_placeHolder:"",_noDataMsg:"",_maxWidth:"",_minWidth:"",_inputTextBox:"",_gridHasFocus:!1,_metaKeyPressed:!1,_shiftKeyPressed:!1,_CSS_STYLES:{CLASS_SELECTOR:".",ALL_SELECTOR:"\x3e",MULTI:"select2-container select2-container-multi",CHOICES:"select2-choices",CHOICE:"select2-search-choice",SEARCH_CHOICE_FOCUS:"select2-search-choice-focus",
SEARCH_FIELD:"select2-search-field",CLOSE_ICON:"select2-search-choice-close"},values:[],_selRows:[],_CHOICE_SELECTOR:"",_CHOICE_FOCUS:"",_CHOICE_FOCUS_ALL:"",constructor:function(a,b){this._attachmentNode=b;this._idProperty=a.idProperty;this._gridId=a.gridId;this._filterId=a.filterId;this._store=a.store;this._placeHolder=a.placeholder;this._noDataMsg=a.noDataMsg;this._maxWidth=a.maxWidth;this._minWidth=a.minWidth;this._matchParam=a.matchParam;this.values=[];this._selRows=[];this._CHOICE_ALL_SELECTOR=
this._CSS_STYLES.CLASS_SELECTOR+this._CSS_STYLES.CHOICE+this._CSS_STYLES.ALL_SELECTOR;this._CHOICE_FOCUS=this._CSS_STYLES.CLASS_SELECTOR+this._CSS_STYLES.SEARCH_CHOICE_FOCUS;this._CHOICE_FOCUS_ALL=this._CHOICE_FOCUS+this._CSS_STYLES.ALL_SELECTOR},buildRendering:function(){this._createContainerNode();this._createTagList();this._createDropDownList();this._createInput();var a=b.hitch(this,function(a,b,d){b=this._inputTextBox?this._inputTextBox.get("value")+"":"";if(1>b.length)return!0;if(!a.tag)return!1;
a=(a.tag+"").toLowerCase().match(RegExp("^"+b.toLowerCase()));return null!==a&&0<a.length?!0:!1}),d=b.hitch(this,function(a,b,d){b=this._inputTextBox?this._inputTextBox.get("value")+"":"";return 1>b.length?!0:!a.tag?!1:~(a.tag+"").toLowerCase().indexOf(b.toLowerCase())?!0:!1}),e=[{field:this._idProperty}],h=[{attribute:this._idProperty,ascending:!0}];this._grid=new (c([B,C,z]))({store:this._store,showHeader:!1,noDataMessage:this._noDataMsg,selectionMode:"extended",allowSelectAll:!0,cellNavigation:!1,
columns:e,sort:h,renderRow:this._renderItem},this._gridId);s.add(this._gridId,"gridHeightLimiter");this._grid.query="first"===this._matchParam?a:d},postCreate:function(){var a;this._inputTextBox.watch("value",b.hitch(this,function(b,d,e){a&&(clearTimeout(a),a=null);this._grid.refresh()}));this._grid.on(".dgrid-row:click",b.hitch(this,function(a){var b="";!this._shiftKeyPressed&&!this._metaKeyPressed?(b=this._grid.row(a).data.tag,this._createTags(b),this._store.remove(b),this._grid.refresh(),this._resetInputTextBox()):
!a.shiftKey&&(!a.metaKey&&!a.ctrlKey)&&(b=this._selRows[0],this._createTags(b),this._store.remove(b),this._grid.refresh(),this._resetInputTextBox())}));this._grid.on("dgrid-deselect",b.hitch(this,function(a){this._selRows=[];for(var b in this._grid.selection)this._selRows.push(b)}));this._grid.on("dgrid-select",b.hitch(this,function(a){this._selRows=[];for(var b in this._grid.selection)this._selRows.push(b)}));this.connect(this.domNode,"keydown","_keydownHandler");window.onkeydown=b.hitch(this,function(a){if(a.shiftKey||
a.ctrlKey||224===a.keyCode)this._metaKeyPressed=!0});this.connect(document,"onkeydown",b.hitch(this,function(a){this._metaKeyPressed=this._shiftKeyPressed=!0}))},_keydownHandler:function(a){var d;void 0!==w.curNode.value&&(d=w.curNode.value.length);var e=r(this._CHOICE_FOCUS,l.byId(this.id)),h=r(this._CSS_STYLES.CLASS_SELECTOR+this._CSS_STYLES.CHOICE,l.byId(this.id)).last();switch(a.keyCode){case t.RIGHT_ARROW:this._navigate(e,d,h,"right");this._hideGrid();break;case t.LEFT_ARROW:this._navigate(e,
d,h,"left");this._hideGrid();break;case t.DOWN_ARROW:a.preventDefault();this._unhighlightTag(e);"none"===p.get(this._gridId,"display")&&this._showGrid();this._gridHasFocus||(this._grid.focus(this._setFocusOnFirstRow(this._grid,0)),this._gridHasFocus=!0);break;case t.UP_ARROW:break;case t.BACKSPACE:var c;if(0===d&&0===r(this._CHOICE_FOCUS_ALL).length&&void 0!==r(this._CHOICE_ALL_SELECTOR)[r(this._CHOICE_ALL_SELECTOR).length-1]&&(c=r(this._CHOICE_ALL_SELECTOR)[r(this._CHOICE_ALL_SELECTOR).length-1].title,
0<r("li",this._attachmentNode).length&&(n.destroy(h[0]),void 0!==c)))try{this._store.add({tag:c})}catch(f){}if(0<r(this._CHOICE_FOCUS_ALL).length&&(c=r(this._CHOICE_FOCUS_ALL).text(),n.destroy(e[0]),void 0!==c))try{this._store.add({tag:c})}catch(k){}this._grid.refresh();0===d&&this._hideGrid();this._removeTag(c);break;case t.CTRL:this._metaKeyPressed=!0;break;case t.META:this._metaKeyPressed=!0;break;case t.SHIFT:this._shiftKeyPressed=!0;break;case t.ENTER:if(0<d){d=w.curNode.value;d=d.split(",");
var g=[];q.forEach(d,function(a,b){-1===q.indexOf(g,a)&&g.push(u.trim(a))});q.forEach(g,b.hitch(this,function(a,b){this._isEmpty(a)||this._contains(this.values,a)||this._createTags(a)}))}else{for(d=0;d<this._selRows.length;d++)this._createTags(this._selRows[d]),this._store.remove(this._selRows[d]);this._metaKeyPressed=this._shiftKeyPressed=!1}this._resetInputTextBox();a.preventDefault();w.focus(l.byId(this._filterId));break;case t.TAB:if(!(w.curNode.id===this._filterId&&0===d)){if(0<d)d=w.curNode.value,
d=d.split(","),g=[],q.forEach(d,function(a,b){-1===q.indexOf(g,a)&&g.push(u.trim(a))}),q.forEach(g,b.hitch(this,function(a,b){this._isEmpty(a)||this._contains(this.values,a)||this._createTags(a)}));else{for(d=0;d<this._selRows.length;d++)this._createTags(this._selRows[d]),this._store.remove(this._selRows[d]);this._metaKeyPressed=this._shiftKeyPressed=!1}this._resetInputTextBox();a.preventDefault();w.focus(l.byId(this._filterId))}break;case t.ESCAPE:this._hideGrid();break;default:-1<d&&("none"===p.get(l.byId(this._gridId),
"display")&&this._showGrid(),this._unhighlightTag(e)),this._metaKeyPressed=!1}},_blurHandler:function(a,d,e){if(!this.focused){if(0<this._inputTextBox.value.length){var h=[];a=this._inputTextBox.value.split(",");q.forEach(a,function(a,b){-1===q.indexOf(h,a)&&h.push(u.trim(a))});q.forEach(h,b.hitch(this,function(a,b){this._isEmpty(a)||this._contains(this.values,a)||this._createTags(a)}));this._resetInputTextBox()}this._hideGrid()}},_resetInputTextBox:function(){a.byId(this._filterId).set("value","")},
_isEmpty:function(a){a=a.replace(/^\s+|\s+$/,"");return 0===a.length?!0:!1},_navigate:function(a,b,d,e){0<a.length&&1>b?("right"===e?this._hightlightTag(a.next()):this._hightlightTag(a.prev()),this._unhighlightTag(a)):1>b&&this._hightlightTag(d)},_contains:function(a,b){return 0<=q.indexOf(a,b)},_hightlightTag:function(a){a.addClass(this._CSS_STYLES.SEARCH_CHOICE_FOCUS)},_unhighlightTag:function(a){a.removeClass(this._CSS_STYLES.SEARCH_CHOICE_FOCUS)},_removeTag:function(a){a&&-1!==q.indexOf(this.values,
a)&&this.values.splice(q.indexOf(this.values,a),1)},_hideGrid:function(){l.byId(this._gridId)&&p.set(l.byId(this._gridId),"display","none");this._gridHasFocus=!1},_showGrid:function(){p.set(l.byId(this._gridId),"display","block");var a=p.get(l.byId(this._attachmentNode),"width");p.set(l.byId(this._gridId),"width",a+"px")},_setFocusOnFirstRow:function(a,b){return r(".dgrid-content .dgrid-cell",this._grid.domNode)[b]||r(".dgrid-content .dgrid-row",this._grid.domNode)[b]},_createTags:function(d){r(this._CHOICE_FOCUS,
l.byId(this.id)).removeClass("select2-search-choice-focus");var e=n.create("li",null,this._autocompleteList);s.add(e,this._CSS_STYLES.CHOICE);e=n.create("div",{title:d},e);m.set(e,this.htmlEncode(d));e=n.create("a",{href:"#"},e);s.add(e,this._CSS_STYLES.CLOSE_ICON);v(e,"click",b.hitch(this,function(a){var b=a.target.parentElement.innerText||a.target.parentElement.textContent;try{this._store.add({tag:b})}catch(d){}this._grid.refresh();this._removeTag(b);n.destroy(a.target.parentNode.parentNode);a.preventDefault()}));
e=a.byId(this._filterId);n.place(e.domNode,this._autocompleteList,"last");this._hideGrid();this.values.push(d)},_renderItem:function(a){return n.create("div",{innerHTML:a.tag})},_createContainerNode:function(){this.domNode=n.create("div",null,this._attachmentNode);s.add(this.domNode,this._CSS_STYLES.MULTI);p.set(this.domNode,"maxWidth",this._maxWidth);p.set(this.domNode,"minWidth",this._minWidth)},_createTagList:function(){this._autocompleteList=n.create("ul",null,this.domNode);s.add(this._autocompleteList,
this._CSS_STYLES.CHOICES)},_createInput:function(){var a=n.create("li",null,this._autocompleteList,"last");s.add(a,this._CSS_STYLES.SEARCH_FIELD);this._inputTextBox=new h({id:this._filterId,placeHolder:this._placeHolder,intermediateChanges:!0,trim:!0,style:{border:"none"}},a);s.add(this._inputTextBox,"inputTextBox");p.set(this._inputTextBox,"width",this._minWidth);w.watch("curNode",b.hitch(this,this._blurHandler))},_createDropDownList:function(){var a=n.create("div",{id:this._gridId},this.domNode);
s.add(a,"dropDownList");p.set(a,"width",this._minWidth)},prepopulate:function(a){q.forEach(a,b.hitch(this,function(a,b){this._createTags(a);this._store.remove(a)}))},clearTags:function(){var a=r(this._CSS_STYLES.CLASS_SELECTOR+this._CSS_STYLES.CHOICE,l.byId(this.id));0<a.length&&(q.forEach(a,b.hitch(this,function(a,b){try{this._store.add({tag:r(this._CHOICE_ALL_SELECTOR,l.byId(this.id))[0].title})}catch(d){}n.destroy(a)})),this.values=[])},addStyledTags:function(a,b){s.add(l.byId(b),this._CSS_STYLES.MULTI);
var d=n.create("ul",null,l.byId(b));s.add(d,this._CSS_STYLES.CHOICES);p.set(d,"border","none");q.forEach(a,function(a,b){var e=n.create("li",null,d);p.set(e,"padding","3px 5px 3px 5px");s.add(e,"select2-search-resultSet");e=n.create("div",{title:a},e);m.set(e,a)})},htmlEncode:function(a){return!a?a:a.replace(/&/g,"\x26amp;").replace(/>/g,"\x26gt;").replace(/</g,"\x26lt;").replace(/"/g,"\x26quot;")}})})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),
function(q,c,b,g,l,k,s,n){function p(a){a.preventDefault()}var m={checkbox:1,radio:1,button:1},f=/\bdgrid-cell\b/,t=/\bdgrid-row\b/,v=q("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=g.mixin({},v.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=g.mixin({},v.defaultHeaderKeyMap))},postCreate:function(){function a(b){var d=b.target;return d.type&&(!m[d.type]||32==b.keyCode)}function d(h){function k(){e._focusedHeaderNode&&
(e._focusedHeaderNode.tabIndex=-1);if(e.showHeader&&(e._focusedHeaderNode=l=g?e.headerNode.getElementsByTagName("th")[0]:e.headerNode))l.tabIndex=e.tabIndex}var g=e.cellNavigation,y=g?f:t,m=h===e.headerNode,l=h;m?(k(),c.after(e,"renderHeader",k,!0)):c.after(e,"renderArray",function(a){return n.when(a,function(a){var b=e._focusedNode||l;if(y.test(b.className)&&s.contains(h,b))return a;for(var d=0,c=h.getElementsByTagName("*"),f;f=c[d];++d)if(y.test(f.className)){b=e._focusedNode=f;break}b.tabIndex=
e.tabIndex;return a})});e._listeners.push(b(h,"mousedown",function(b){a(b)||e._focusOnNode(b.target,m,b)}));e._listeners.push(b(h,"keydown",function(b){if(!b.metaKey&&!b.altKey){var d=e[m?"headerKeyMap":"keyMap"][b.keyCode];d&&!a(b)&&d.call(e,b)}}))}this.inherited(arguments);var e=this;this.tabableHeader&&(d(this.headerNode),b(this.headerNode,"dgrid-cellfocusin",function(){e.scrollTo({x:this.scrollLeft})}));d(this.contentNode)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);
var b=this,d=document.activeElement===this._focusedNode,e=this[this.cellNavigation?"cell":"row"](this._focusedNode),h=e.row||e,c;a=a.element||a;if(a===h.element){c=this.down(h,!0);if(!c||c.element===a)c=this.up(h,!0);this._removedFocus={active:d,rowId:h.id,columnId:e.column&&e.column.id,siblingId:!c||c.element===a?void 0:c.id};setTimeout(function(){b._removedFocus&&b._restoreFocus(h.id)},0);this._focusedNode=null}this.inherited(arguments)},insertRow:function(a){var b=this.inherited(arguments);this._removedFocus&&
!this._removedFocus.wait&&this._restoreFocus(b);return b},_restoreFocus:function(a){var b=this._removedFocus,d;if((a=(a=a&&this.row(a))&&a.element&&a.id===b.rowId?a:"undefined"!==typeof b.siblingId&&this.row(b.siblingId))&&a.element){if(!a.element.parentNode.parentNode){b.wait=!0;return}"undefined"!==typeof b.columnId&&(d=this.cell(a,b.columnId))&&d.element&&(a=d);b.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(k(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=
a.element)}delete this._removedFocus},addKeyHandler:function(a,b,d){return c.after(this[d?"headerKeyMap":"keyMap"],a,b,!0)},_focusOnNode:function(a,d,e){var h="_focused"+(d?"Header":"")+"Node";d=this[h];var c=this.cellNavigation?"cell":"row",m=this[c](a),w,n,u,s,r;if(a=m&&m.element){if(this.cellNavigation){w=a.getElementsByTagName("input");r=0;for(u=w.length;r<u;r++)if(n=w[r],(-1!=n.tabIndex||"lastValue"in n)&&!n.disabled){8>l("ie")&&(n.style.position="relative");n.focus();8>l("ie")&&(n.style.position=
"");s=!0;break}}null!==e&&(e=g.mixin({grid:this},e),e.type&&(e.parentType=e.type),e.bubbles||(e.bubbles=!0));d&&(k(d,"!dgrid-focus[!tabIndex]"),8>l("ie")&&(d.style.position=""),e[c]=this[c](d),b.emit(d,"dgrid-cellfocusout",e));d=this[h]=a;e&&(e[c]=m);h=this.cellNavigation?f:t;!s&&h.test(a.className)&&(8>l("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,a.focus());k(a,".dgrid-focus");e&&b.emit(d,"dgrid-cellfocusin",e)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,
!0)},focus:function(a){this._focusOnNode(a||this._focusedNode,!1)}}),r=v.moveFocusVertical=function(a,b){var d=this.cellNavigation,e=this[d?"cell":"row"](a),e=d&&e.column.id,h=this.down(this._focusedNode,b,!0);d&&(h=this.cell(h,e));this._focusOnNode(h,!1,a);a.preventDefault()};q=v.moveFocusUp=function(a){r.call(this,a,-1)};var x=v.moveFocusDown=function(a){r.call(this,a,1)},u=v.moveFocusPageUp=function(a){r.call(this,a,-this.pageSkip)},w=v.moveFocusPageDown=function(a){r.call(this,a,this.pageSkip)},
h=v.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var d=!this.row(a);this._focusOnNode(this.right(this["_focused"+(d?"Header":"")+"Node"],b),d,a);a.preventDefault()}},a=v.moveFocusLeft=function(a){h.call(this,a,-1)},e=v.moveFocusRight=function(a){h.call(this,a,1)},d=v.moveHeaderFocusEnd=function(a,b){var d;this.cellNavigation&&(d=this.headerNode.getElementsByTagName("th"),this._focusOnNode(d[b?0:d.length-1],!0,a));a.preventDefault()},A=v.moveHeaderFocusHome=function(a){d.call(this,a,!0)},
B=v.moveFocusEnd=function(a,b){var d=this,e=this.cellNavigation,h=this.contentNode,f=h.scrollTop+(b?0:h.scrollHeight),h=h[b?"firstChild":"lastChild"],k=-1<h.className.indexOf("dgrid-preload"),m=k?h[(b?"next":"previous")+"Sibling"]:h,w=m.offsetTop+(b?0:m.offsetHeight),u;if(k){for(;m&&0>m.className.indexOf("dgrid-row");)m=m[(b?"next":"previous")+"Sibling"];if(!m)return}!k||1>h.offsetHeight?(e&&(m=this.cell(m,this.cell(a).column.id)),this._focusOnNode(m,!1,a)):(l("dom-addeventlistener")||(a=g.mixin({},
a)),u=c.after(this,"renderArray",function(h){u.remove();return n.when(h,function(h){h=h[b?0:h.length-1];e&&(h=d.cell(h,d.cell(a).column.id));d._focusOnNode(h,!1,a)})}));f===w&&a.preventDefault()},C=v.moveFocusHome=function(a){B.call(this,a,!0)};v.defaultKeyMap={32:p,33:u,34:w,35:B,36:C,37:a,38:q,39:e,40:x};v.defaultHeaderKeyMap={32:p,35:d,36:A,37:a,39:e};return v})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(q,c,b,g){return q("dijit.form.SimpleTextarea",
g,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);b("ie")&&this.cols&&c.add(this.textbox,"dijitTextAreaCols")},filter:function(b){b&&(b=b.replace(/\r/g,""));return this.inherited(arguments)},
_onInput:function(c){if(this.maxLength){var k=parseInt(this.maxLength),g=this.textbox.value.replace(/\r/g,""),k=g.length-k;if(0<k){var n=this.textbox;if(n.selectionStart){var p=n.selectionStart,m=0;b("opera")&&(m=(this.textbox.value.substring(0,p).match(/\r/g)||[]).length);this.textbox.value=g.substring(0,p-k-m)+g.substring(p-m);n.setSelectionRange(p-k,p-k)}else this.ownerDocument.selection&&(n.focus(),g=this.ownerDocument.selection.createRange(),g.moveStart("character",-k),g.text="",g.select())}}this.inherited(arguments)}})})},
"builder/AGOLTemplate/AGOLTemplate":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AGOLTemplate.html dojo/on dojo/dom dojo/_base/lang dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-attr dojo/json dojo/query dojo/Deferred dojo/keys dojo/request/xhr dijit/form/Select esri/request require ./ConfigNode ./Category ./CategoryManager ./ShowJsonCodePage ./Export ../serviceUtils jimu/utils jimu/WidgetManager jimu/dijit/Message jimu/dijit/Popup".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z,y,E,H,F,G,D,I){return q([l,k],{templateString:s,baseClass:"agol-template",configTree:null,nls:null,lastTemplateJson:null,postMixInProperties:function(){this.nls=m.mixin({},builderNls.common);this.nls=m.mixin(this.nls,builderNls.agolTemplate)},postCreate:function(){this.inherited(arguments)},startup:function(){p.setSelectable(this.contentPart,!1);this.showJsonWidget=new y({},this.showJsonContentDiv);this.configTree=new B(this.appConfig,null,
"app","",0);this.categoryManager=new z(this.configTree,this.appConfig,this.app.agolTemplateJson);this.drawTree(this.configTree,this.treePart);this.drawCategoryPart();this.initWork()},drawTree:function(a,b){var d,e;d=this.drawDomNode(a,b);if(0!==a.childs.length)for(e=0;e<a.childs.length;e++)this.drawTree(a.childs[e],d)},drawDomNode:function(a,d){var e,h,c,k,g,l;l=this.categoryManager.getCategoryByField(a.absolutePath);e=f.create("div",{"class":"tree-node-div",idAttr:a.id},d);l||t.set(e,"display","none");
"leaf"===a.nodeType&&!l&&t.set(e,"color","#cccccc");"leaf"!==a.nodeType&&(c=f.create("div",{"class":"show-subnode-div"},e),k=f.create("img",{"class":"show-subnode-img",src:"builder/css/images/v_right.png",alt:"img"},c));f.create("span",{"class":"line-label-span",innerHTML:a.label?a.label:a.keyString},e);l&&"leaf"===a.nodeType&&(g=f.create("div",{"class":"to-right-div"},e),f.create("img",{"class":"to-right-img",src:"builder/css/images/add_field.png",alt:"img"},g),this.own(n(g,"click",m.hitch(this,
function(b){t.set(g,"display","none");this._onToRightDiv(a,"add",e);b.stopPropagation();this._checkTemplateStatus()}))),-1!==l.findFieldFromDisplay(a.absolutePath)&&t.set(g,"display","none"));h=12*a.level;"leaf"===a.nodeType?t.set(e,"paddingLeft",h+17+"px"):t.set(e,"paddingLeft",h+"px");h=f.create("div",{"class":"tree-node-subdiv"},d);t.set(h,"display","none");"leaf"!==a.nodeType?(t.set(e,"cursor","pointer"),this.own(n(e,"click",m.hitch(this,function(a,b,d){"none"===t.get(b,"display")?(t.set(b,"display",
"block"),r.set(d,"src","builder/css/images/v.png")):(t.set(b,"display","none"),r.set(d,"src","builder/css/images/v_right.png"));-1!==a.absolutePath.search(/widgets\[[0-9]+\]_config$/)&&!a.jsonObject&&this.addWidgetConfigToConfigTree(a.absolutePath)},a,h,k)))):l&&(t.set(e,"cursor","pointer"),this.own(n(e,"click",m.hitch(this,function(a,b){this._onToRightDiv(a,"notAdd",e);b.stopPropagation()},a))));a.lineDomNode=e;a.subLineDomNode=h;a.showSubDivDomNode=c;a.toRightDiv=g;0===a.level&&(b.setStyle(e,"display",
"none"),b.setStyle(h,"display","block"));return h},drawCategoryPart:function(){c.forEach(this.categoryManager.displayCategorys,function(a){this.drawCategory(a)},this)},drawCategory:function(a){var b,d,e,h,k,g,l;b=f.create("div",{"class":"category-div",categoryDiv:a.name},this.categoryPart);h=f.create("div",{"class":"category-head-div",categoryHeadDiv:a.name},b);k=f.create("div",{"class":"category-fold-div"},h);l=f.create("img",{"class":"category-fold-img",src:"builder/css/images/v_right.png",alt:"img"},
k);f.create("div",{"class":"category-title-div",innerHTML:a.title},h);d=f.create("div",{"class":"category-oper-div "},h);k=f.create("div",{"class":"category-oper-item-div category-moveup-div",innerHTML:"\x3cimg src\x3d'builder/css/images/moveup.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);g=f.create("div",{"class":"category-oper-item-div category-movedown-div",innerHTML:"\x3cimg src\x3d'builder/css/images/movedown.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);d=f.create("div",{"class":"category-oper-item-div category-remove-div",
innerHTML:"\x3cimg src\x3d'builder/css/images/delete01.png' alt\x3d'img'\x3e\x3c/img\x3e"},d);e=f.create("div",{"class":"fields-div",fieldsDiv:a.name},b);this.own(n(k,"click",m.hitch(this,function(b){this.categoryManager.moveup(a)&&(f.empty(this.categoryPart),this.drawCategoryPart());this._changeHeighlightCategoryHead(a.name);b.stopPropagation();this._checkTemplateStatus()})));this.own(n(g,"click",m.hitch(this,function(b){this.categoryManager.movedown(a)&&(f.empty(this.categoryPart),this.drawCategoryPart());
this._changeHeighlightCategoryHead(a.name);b.stopPropagation();this._checkTemplateStatus()})));this.own(n(d,"click",m.hitch(this,function(d){this.categoryManager.removeCategoryFromDisplay(a);f.destroy(b);c.forEach(a.displayFields,function(a){var b=this.configTree.findNode(a.fieldPath);b&&(b.setTemplateField(a.fieldJson),b.toRightDiv&&t.set(b.toRightDiv,"display","block"))},this);a.displayFields=[];d.stopPropagation();this._checkTemplateStatus()})));this.own(n(h,"click",m.hitch(this,function(){"block"===
t.get(e,"display")?(t.set(e,"display","none"),r.set(l,"src","builder/css/images/v_right.png")):(t.set(e,"display","block"),r.set(l,"src","builder/css/images/v.png"));this._changeHeighlightCategoryHead(a.name)})));this.drawFields(a,b,e);t.set(e,"display","none")},drawFields:function(a,b,d){c.forEach(a.displayFields,function(e){this.drawField(a,b,d,e)},this)},addWidgetConfigToConfigTree:function(a){var b=new w,d=a.search(/widgets\[[0-9]+\]/),e=a.slice(d,a.length).indexOf("]"),d=a.slice(0,d+e+1);a=d+
"_config";var d=this.configTree.findNode(d),h=this.configTree.findNode(a);a=this.fullAppConfig.getConfigElementById(d.jsonObject.id);a.config&&("string"===typeof a.config&&!a.config.startWith(a.folderUrl))&&(d=a.config.split("/").pop(),a.config=a.folderUrl+d);G.getInstance().tryLoadWidgetConfig(a).then(m.hitch(this,function(a){if(a){var d;h.jsonObject=a;a.geocoder&&a.geocoder.geocoders&&delete a.geocoder.geocoders;for(d in a)a.hasOwnProperty(d)&&(d=h.addChild(a[d],d,h.absolutePath,h.level),this.drawTree(d,
h.subLineDomNode))}b.resolve()}));return b},drawField:function(a,d,h,k){var g,l,y,w,u,s,p,v;this.configTree.findNode(k.fieldPath);v=B.getDefaultTemplateField(k.fieldPath,k.fieldJson.type);for(g in k.fieldJson)k.fieldJson.hasOwnProperty(g)&&(v[g]=k.fieldJson[g]);g=f.create("div",{"class":"field-div",fieldDiv:k.fieldPath},h);this.own(n(g,"click",m.hitch(this,function(a,d){function e(){h=this.configTree.findNode(g);c=b.position(this.treePart).y;f=b.position(h.lineDomNode).y;k=f-c;(0>k||k>t.get(this.categoryPart,
"height"))&&h.lineDomNode.scrollIntoView(!1);this._changeHeighlightFieldDomNode(g);this._changeHeighlightTreeDomNode(h.lineDomNode);this._changeHeighlightCategoryHead(d.name)}var h,c,f,k,g=a.fieldPath;if(h=this.configTree.findNode(g)){for(;h;)t.set(h.subLineDomNode,"display","block"),h=h.parentNode;m.hitch(this,e)()}else this.addWidgetConfigToConfigTree(g).then(m.hitch(this,function(){for(h=this.configTree.findNode(g);h;)t.set(h.subLineDomNode,"display","block"),h=h.parentNode;m.hitch(this,e)()}))},
k,a)));a=f.create("div",{"class":"field-head-div"},g);f.create("span",{"class":"field-head-title-div",innerHTML:m.hitch(this,function(a){var b="",d=a.split("_"),e=m.clone(d);c.forEach(d,function(a,b){var h,c="";if(-1!==a.search(/widgets\[[0-9]+\]$/)||-1!==a.search(/groups\[[0-9]+\]$/)){for(h=0;h<=b;h++)c+=d[h]+"_";h=this.configTree.findNode(c.slice(0,-1));e[b]=h.label}},this);for(a=1;a<e.length;a++)b+=e[a]+"_";return b.slice(0,-1)})(k.fieldPath)},a);y=f.create("div",{"class":"field-fold-div"},a);
w=f.create("img",{"class":"field-fold-img",src:"builder/css/images/v_right.png",alt:"img"},y);y=f.create("div",{"class":"field-oper-div",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'builder/css/images/delete01.png' alt\x3d'img'\x3e\x3c/img\x3e"},a);s=f.create("div",{"class":"field-oper-div",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'builder/css/images/movedown.png' alt\x3d'img'\x3e\x3c/img\x3e"},a);u=f.create("div",{"class":"field-oper-div",innerHTML:"\x3cimg class\x3d'field-oper-img' src\x3d'builder/css/images/moveup.png' alt\x3d'img'\x3e\x3c/img\x3e"},
a);var A=f.create("div",{"class":"field-fixed-content-div",style:"display:none;"},g);f.create("span",{"class":"field-label-span",innerHTML:"Field Label:"},A);l=f.create("input",{"class":"jimu-input field-label-input",type:"text",value:v.label},A);this.own(n(l,"change",m.hitch(this,function(a,b){this._onFieldChange(a,{key:"label",value:b.value})},k.fieldPath,l)));f.create("span",{"class":"field-type-span",innerHTML:"Field Type:  "},A);l=(new e({name:"selectFieldType","class":"field-type-select",options:[{label:"String",
value:"string"},{label:"Boolean",value:"boolean"},{label:"Number",value:"number"},{label:"Options",value:"options"}],value:v.type})).placeAt(A);p=f.create("div",{"class":"field-content-div",style:"display:none;"},g);this.drawFieldContent(k.fieldPath,v,p,l.getValue());this.own(n(l,"change",m.hitch(this,function(a,b,d,e){this.drawFieldContent(a,b,d,e);this._onFieldChange(a,{key:"type",value:e});t.set(d,"display","block")},k.fieldPath,v,p)));this.own(n(a,"click",m.hitch(this,function(){"block"===t.get(p,
"display")?(t.set(p,"display","none"),t.set(A,"display","none"),r.set(w,"src","builder/css/images/v_right.png")):(t.set(p,"display","block"),t.set(A,"display","block"),r.set(w,"src","builder/css/images/v.png"))})));this.own(n(y,"click",m.hitch(this,function(a,b,d,e){var h=a.fieldPath,c=this.configTree.findNode(h);c?(c.setTemplateField(a.fieldJson),c.toRightDiv&&t.set(c.toRightDiv,"display","block")):this.addWidgetConfigToConfigTree(h).then(m.hitch(this,function(){var b=this.configTree.findNode(h);
a.fieldJson&&b.setTemplateField(a.fieldJson)}));c=this.categoryManager.getCategoryByField(h);c.removeFieldFromDisplay(h);f.destroy(b);c.displayIsEmpty()&&(this.categoryManager.removeCategoryFromDisplay(c),f.destroy(d));e.stopPropagation();this._checkTemplateStatus()},k,g,d)));this.own(n(u,"click",m.hitch(this,function(a,b,e){var h=this.categoryManager.getCategoryByField(a);h.moveup(a)&&(f.empty(b),this.drawFields(h,d,b),this._changeHeighlightFieldDomNode(a));e.stopPropagation();this._checkTemplateStatus()},
k.fieldPath,h)));this.own(n(s,"click",m.hitch(this,function(a,b,e){var h=this.categoryManager.getCategoryByField(a);h.movedown(a)&&(f.empty(b),this.drawFields(h,d,b),this._changeHeighlightFieldDomNode(a));e.stopPropagation();this._checkTemplateStatus()},k.fieldPath,h)))},drawFieldContent:function(a,b,d,h){var k,g,l,y;f.empty(d);f.create("span",{"class":"field-tooltip-span",innerHTML:"Tooltip:"},d);k=f.create("input",{"class":"jimu-input field-tooltip-input",type:"text",value:b.tooltip},d);this.own(n(k,
"change",m.hitch(this,function(a,b){this._onFieldChange(a,{key:"tooltip",value:b.value})},a,k)));f.create("br",{},d);"string"===h?(f.create("span",{"class":"field-string-ph-span",innerHTML:"Placeholder:"},d),h=f.create("input",{"class":"jimu-input field-string-ph-input",type:"text",value:b.placeHolder},d),this.own(n(h,"change",m.hitch(this,function(a,b){this._onFieldChange(a,{key:"placeHolder",value:b.value})},a,h))),h=f.create("div",{"class":"field-text-type-div"},d),f.create("span",{"class":"field-text-type-span",
innerHTML:"Text Box Type:"},h),b=(new e({name:"stringOptions","class":"field-string-options",options:[{label:"richtext",value:"richtext"},{label:"textarea",value:"textarea"},{label:"textbox",value:"textbox"}],value:b.stringFieldOption})).placeAt(h),this.own(n(b,"change",m.hitch(this,function(a,b){this._onFieldChange(a,{key:"stringFieldOption",value:b})},a)))):"number"===h?(f.create("span",{"class":"field-num-min-span",innerHTML:"Min Value:"},d),g=f.create("input",{"class":"jimu-input field-num-input field-num-min-input",
type:"text",value:b.constraints.min},d),f.create("br",{},d),f.create("span",{"class":"field-num-max-span",innerHTML:"Max Value:"},d),l=f.create("input",{"class":"jimu-input field-num-input field-num-max-input",type:"text",value:b.constraints.max},d),f.create("br",{},d),f.create("span",{"class":"field-num-places-span",innerHTML:"Places:"},d),y=f.create("input",{"class":"jimu-input field-num-input field-num-places-input",type:"text",value:b.constraints.places},d),this.own(n(g,"change",m.hitch(this,
function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,max:l.value,places:y.value}})},a))),this.own(n(l,"change",m.hitch(this,function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,max:l.value,places:y.value}})},a))),this.own(n(y,"change",m.hitch(this,function(a){this._onFieldChange(a,{key:"constraints",value:{min:g.value,max:l.value,places:y.value}})},a)))):"options"===h&&(h=f.create("div",{"class":"field-options-add-div"},d),k=f.create("div",{"class":"field-options-add-content"},
h),f.create("div",{"class":"field-options-add-img-div",innerHTML:"\x3cimg src\x3d'builder/css/images/add_link.png' alt\x3d'img'\x3e\x3c/img\x3e"},k),f.create("div",{"class":"field-options-add-text-div",innerHTML:"Add a New Options"},k),c.forEach(b.options,function(b){this._onFieldOptionsAdd(a,d,b.label,b.value)},this),this.own(n(h,"click",m.hitch(this,this._onFieldOptionsAdd,a,d,"",""))))},_changeHeighlightFieldDomNode:function(a){u(".field-div",this.categoryPart).removeClass("field-heighlight-div");
v.add(u('div[fieldDiv\x3d"'+a+'"]',this.categoryPart)[0],"field-heighlight-div")},_changeHeighlightTreeDomNode:function(a){this.heighlightTreeDomNode&&v.remove(this.heighlightTreeDomNode,"tree-node-heighlight-div");v.add(a,"tree-node-heighlight-div");this.heighlightTreeDomNode=a},_changeHeighlightCategoryHead:function(a){u(".category-head-div",this.categoryPart).removeClass("category-head-div-selected");a=u("div[categoryHeadDiv\x3d'"+a+"']",this.categoryPart)[0];b.addClass(a,"category-head-div-selected")},
_onToRightDiv:function(a,d,e){var h,c,f=this.categoryManager.getCategoryByField(a.absolutePath);h=this.categoryManager.findDisplayCategory(f.name);c={fieldPath:a.absolutePath,fieldJson:a.getTemplateField()};if(-1===h){if("add"!==d)return;this.categoryManager.addCategoryToDisplay(f);f.addFieldToDisplay(c);this.drawCategory(f);h=u("div[fieldsDiv\x3d'"+f.name+"']",this.categoryPart)[0]}else if(-1===f.findFieldFromDisplay(a.absolutePath)){if("add"!==d)return;f.addFieldToDisplay(c);d=u("div[categoryDiv\x3d'"+
f.name+"']",this.categoryPart)[0];h=u("div[fieldsDiv\x3d'"+f.name+"']",this.categoryPart)[0];this.drawField(f,d,h,c)}else h=u("div[fieldsDiv\x3d'"+f.name+"']",this.categoryPart)[0];t.set(h,"display","block");c=u('div[fieldDiv\x3d"'+a.absolutePath+'"]',this.categoryPart)[0];this._changeHeighlightCategoryHead(f.name);this._changeHeighlightFieldDomNode(a.absolutePath);this._changeHeighlightTreeDomNode(e);a=b.position(this.categoryPart).y;a=b.position(c).y-a;(0>a||a>t.get(this.categoryPart,"height"))&&
c.scrollIntoView(!1)},_onFieldChange:function(a,b){var d=this.configTree.findNode(a),e=this.categoryManager.getCategoryByField(a).getDisplayField(a);e.fieldJson[b.key]=b.value;d.templateField=e.fieldJson;this._checkTemplateStatus()},_onFieldOptionsAdd:function(a,b,d,e){var h=f.create("div",{"class":"field-options-div"},b);f.create("div",{"class":"field-options-label-div",innerHTML:"Label"},h);d=f.create("input",{"class":"jimu-input field-options-label-input",type:"text",value:d},h);this.own(n(d,"change",
m.hitch(this,function(a){this._onFieldChange(a,{key:"options",value:this._getFieldOptions(b)})},a)));f.create("div",{"class":"field-options-value-div",innerHTML:"Value"},h);e=f.create("input",{"class":"jimu-input field-options-value-input",type:"text",value:e},h);this.own(n(e,"change",m.hitch(this,function(a){this._onFieldChange(a,{key:"options",value:this._getFieldOptions(b)})},a)));e=f.create("div",{"class":"field-options-remove-div",innerHTML:"\x3cimg src\x3d'builder/css/images/delete_search.png' alt\x3d'img'\x3e\x3c/img\x3e"},
h);this.own(n(e,"click",m.hitch(this,function(a){f.destroy(h);this._onFieldChange(a,{key:"options",value:this._getFieldOptions(b)})},a)))},_getFieldOptions:function(a){var b=[];u(".field-options-div",a).forEach(m.hitch(this,function(a){b.push({label:u(".field-options-label-input",a).attr("value")[0],value:u(".field-options-value-input",a).attr("value")[0]})}));return b},_onReviewJsonDivClick:function(){var a=this.categoryManager.getTemplateJson();this.showJsonWidget.setConfig(a);r.set(this.rightPartHeadText,
"innerHTML",this.nls.rightPartHead2);t.set(this.showJsonDiv,"display","block");t.set(this.reviewJsonDiv,"display","none");t.set(this.reviewJsonBackDiv,"display","block")},_onReviewJsonBackDivClick:function(){r.set(this.rightPartHeadText,"innerHTML",this.nls.rightPartHead);t.set(this.reviewJsonDiv,"display","block");t.set(this.reviewJsonBackDiv,"display","none");t.set(this.showJsonDiv,"display","none")},_saveAgolTemplate:function(){var a=new w,b=x.stringify(this.categoryManager.getTemplateJson("fullJson"));
H.saveAgolTemplate(this.app,b).then(m.hitch(this,function(){this.app.agolTemplateJson=b;this.lastTemplateJson=this.categoryManager.getTemplateJson();a.resolve()}),function(b){new D({message:b});a.reject()});return a},_onDownloadNodeClick:function(){},_onExportClick:function(){var a="",b=this.categoryManager.getTemplateJson(),a=window.isXT?"http://"+window.location.host+path+"apps/"+this.app.id:window.portalUrl+"apps/webappviewer/index.html?id\x3d"+this.app.id,a=new E({_templateUrl:a,_temlateJson:x.stringify(b)});
new I({content:a,container:"main-page",titleLabel:this.nls.title2,width:669,autoHeight:!0,buttons:[{label:builderNls.common.ok,key:h.ENTER,onClick:m.hitch(a,a._onNextClick)},{label:builderNls.common.cancel,key:h.ESCAPE,onClick:m.hitch(a,a._onCancelClick)}]});a.startup()},_onSaveClick:function(){b.setAttr(this.popup.enabledButtons[1],"innerHTML",this.nls.saving);this._saveAgolTemplate().then(m.hitch(this,function(){this._disaplePopupButton(1,this.nls.saved)}))},_onCancelClick:function(){if(F.isEqual(this.lastTemplateJson,
this.categoryManager.getTemplateJson()))this._closePopup(),this.destroyRecursive();else var a=new I({content:"\x3cdiv\x3e\x3cimg class\x3d'alert-image' src\x3d'builder/css/images/alert.png' style\x3d'float:left;margin-left:12px;margin-right:22px;'\x3e\x3c/img\x3e"+this.nls.unSaveMeg+"\x3c/div\x3e",titleLabel:this.nls.cancelPopupTitle,width:"425",autoHeight:!0,buttons:[{label:this.nls.save,onClick:m.hitch(this,function(){this._saveAgolTemplate().then(m.hitch(this,function(){a.close();this._closePopup();
this.destroyRecursive()}))})},{label:this.nls.doNotSave,onClick:m.hitch(this,function(){a.close();this._closePopup();this.destroyRecursive()})},{label:this.nls.cancel,onClick:m.hitch(this,function(){a.close()})}]})},_closePopup:function(){this.popup&&(this.popup.closeTemplate=!0,this.popup.close())},_checkTemplateStatus:function(){F.isEqual(this.lastTemplateJson,this.categoryManager.getTemplateJson())||this._enablePopupButton(1,this.nls.save)},_disaplePopupButton:function(a,d){this.popup.disableButton(a);
b.setAttr(this.popup.disabledButtons[a],"innerHTML",d)},_enablePopupButton:function(a,d){this.popup.enableButton(a);b.setAttr(this.popup.enabledButtons[a],"innerHTML",d)},_initPopup:function(){this.popup.disableButton(1);this.popup.onClose=m.hitch(this,function(){if(this.popup.closeTemplate)return!0;this._onCancelClick();return!1})},initWork:function(){this.lastTemplateJson=this.categoryManager.getTemplateJson();this._initPopup()}})})},"builder/AGOLTemplate/ConfigNode":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array"],function(q,c,b){var g={},l=q([],{id:null,parentNode:null,keyString:null,absolutePath:null,childs:null,nodeType:null,templateField:null,jsonObject:null,level:null,label:null,isVisible:!1,constructor:function(b,g,l,p,m){var f;this.parentNode=g;this.keyString=l;this.childs=[];this.absolutePath=""===p?l:p+"_"+l;this.jsonObject=b;this.level=m;this.initId();this.initLabel();this.initTemplateField(b);if("object"!==typeof b||null===b)this.nodeType="leaf";else if(c.isArrayLike(b)){this.nodeType=
"array";for(g=0;g<b.length;g++)this.addChild(b[g],this.keyString+"["+g+"]",p,m)}else{this.nodeType="normal";for(f in b)b.hasOwnProperty(f)&&("function"!==typeof b[f]&&"config"!==f)&&this.addChild(b[f],f,this.absolutePath,m);-1!==this.absolutePath.search(/widgets\[[0-9]+\]$/)&&(b.config=null,this.addChild(b.config,"config",this.absolutePath,m).nodeType="normal")}},initId:function(){var b,c;b=this.absolutePath.search(/_widgets\[[0-9]+\]/);c=this.absolutePath.search(/_groups\[[0-9]+\]/);-1!==b||-1!==
c?-1!==this.absolutePath.search(/_widgets\[[0-9]+\]$/)||-1!==this.absolutePath.search(/_groups\[[0-9]+\]$/)?this.id=this.parentNode.id+"["+this.jsonObject.id+"]":-1!==b?this.id=this.parentNode.id+"_"+this.keyString:-1!==c&&(this.id=this.parentNode.id+"_"+this.keyString):this.id=this.absolutePath},initLabel:function(){this.label=this.keyString;if(-1!==this.absolutePath.search(/widgets\[[0-9]+\]$/)||-1!==this.absolutePath.search(/groups\[[0-9]+\]$/))this.label=this.jsonObject.label},initTemplateField:function(b){this.templateField=
l.getDefaultTemplateField(this.absolutePath,typeof b,this.label);l.setDefaultValue(this.absolutePath,b,this.id)},getTemplateFieldDefaultValue:function(){return this.templateField.defaultValue},getTemplateField:function(){var b={type:this.templateField.type,fieldName:this.id,label:this.templateField.label,tooltip:this.templateField.tooltip};"leaf"!==this.nodeType&&(b.fieldName+="--");switch(b.type){case "string":b.stringFieldOption=this.templateField.stringFieldOption;b.placeHolder=this.templateField.placeHolder;
break;case "number":b.constraints=this.templateField.constraints;break;case "options":b.options=this.templateField.options}b.id=this.id;b.fieldPath=this.absolutePath;return b},setTemplateField:function(b){this.templateField.type=b.type;this.templateField.label=b.label;this.templateField.tooltip=b.tooltip;"leaf"!==this.nodeType&&(this.templateField.fieldName=this.templateField.fieldName.slice(0,this.templateField.fieldName.length-2));switch(this.templateField.type){case "string":this.templateField.stringFieldOption=
b.stringFieldOption;this.templateField.placeHolder=b.placeHolder;break;case "number":this.templateField.constraints=b.constraints;break;case "options":this.templateField.options=b.options}return b},addChild:function(b,c,g,p){b=new l(b,this,c,g,p+1);this.childs.push(b);return b},isLeaf:function(){var b=!1;this.childs&&0<this.childs.length&&(b=!0);return b},findNode:function(b){var c=[],g,l,m;b.split("_").forEach(function(b){var g=b.search(/\[[0-9]+\]/);-1!==g&&c.push(b.slice(0,g));c.push(b)});l=this;
if(l.keyString!==c[0])return null;for(b=1;b<c.length;b++){m=l.childs.length;for(g=0;g<m;g++)if(l.childs[g].keyString===c[b]){l=l.childs[g];break}if(g===m)return null}return l},setVisible:function(){for(var b=this;b;)b.isVisible=!0,b=b.parentNode},findNodeById:function(b){var c=null;this.traversal(function(g){if(g.id===b)return c=g,!0});return c},traversal:function(b){if(b(this))return!0;for(var c=0;c<this.childs.length;c++)if(this.childs[c].traversal(b))return!0},deserialize:function(c){c&&b.forEach(c.configurationSettings,
function(c){b.forEach(c.fields,function(b){this.findNode(b.fieldName).setTemplateField(b)},this)},this)}});l.getDefaultValue=function(b){return g[b]};l.setDefaultValue=function(b,c,l){var p=null,p=c;"app_portalUrl"===b||"app_map_itemId"===b?p=null:"app_title"===b?p="":"app_subtitle"===b?p="":"object"===typeof c&&(p=!1);g[l]=p};l.getDefaultTemplateField=function(b,c,g){b="string";switch(c){case "number":b="number";break;case "boolean":b="boolean";break;case "object":b="boolean",g="disable"}return{type:b,
label:g,tooltip:"",stringFieldOption:"textbox",placeHolder:g,constraints:{min:0,max:100,places:0},options:[{label:"label1",value:"value1"},{label:"label2",value:"value2"}]}};return l})},"builder/AGOLTemplate/Category":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(q,c,b){return q([],{name:null,title:null,includeFields:null,excludeFields:null,displayFields:null,constructor:function(c,l,k,s,n,p){this.name=l;this.title=k;this.includeFields=s;this.excludeFields=
n;this.displayFields=[];b.forEach(p,function(b){var f=c.findNode(b);f&&this.displayFields.push({fieldPath:b,fieldJson:f.getTemplateField()})},this)},hasField:function(b){var c=!1,k;for(k=0;k<this.includeFields.length;k++)if(0===b.indexOf(this.includeFields[k])){c=!0;break}for(k=0;k<this.excludeFields.length;k++)if(0===b.indexOf(this.excludeFields[k])){c=!1;break}return c},getDisplayField:function(b){b=this.findFieldFromDisplay(b);return-1!==b?this.displayFields[b]:null},findFieldFromDisplay:function(b){var c;
for(c=0;c<this.displayFields.length;c++)if(this.displayFields[c].fieldPath===b)return c;return-1},addFieldToDisplay:function(b){var c;c=this.findFieldFromDisplay(b.fieldPath);-1===c?this.displayFields.push({fieldPath:b.fieldPath,fieldJson:b.fieldJson}):this.displayFields[c].fieldJson=b.fieldJson},removeFieldFromDisplay:function(b){var c;c=this.findFieldFromDisplay(b);0<=c&&this.displayFields.splice(c,1);return b},moveup:function(b){var c;b=this.findFieldFromDisplay(b);return 0<b?(c=this.displayFields[b],
this.displayFields[b]=this.displayFields[b-1],this.displayFields[b-1]=c,!0):!1},movedown:function(b){var c;b=this.findFieldFromDisplay(b);return 0<=b&&b<this.displayFields.length-1?(c=this.displayFields[b],this.displayFields[b]=this.displayFields[b+1],this.displayFields[b+1]=c,!0):!1},displayIsEmpty:function(){return 0===this.displayFields.length},deserialize:function(c,l){this.displayFields=[];b.forEach(c,function(b){function c(b,g){var k=-1,m;m=b.search(RegExp(g));0<=m&&(k=b.slice(m,b.length),k=
k.indexOf("_config"),k=m+k+7);return k}var g,p=b.id,m="";g=c(b.fieldPath,"widgets\\[[0-9]+\\]_config");0<=g&&(m=b.fieldPath.slice(g,b.fieldPath.length));g=c(b.id,"get_[0-9]+\\]_config");0<=g&&(p=b.id.slice(0,g));if(g=l.findNodeById(p))m=g.absolutePath+m,b.fieldPath=m,this.displayFields.push({fieldPath:m,fieldJson:b})},this);return this.displayFields.length}})})},"builder/AGOLTemplate/CategoryManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/request dojo/Deferred dojo/promise/all dojo/json ./ConfigNode ./Category".split(" "),
function(q,c,b,g,l,k,s,n,p){return q([],{categorys:null,displayCategorys:null,constructor:function(b,c,g){this.categorys=[];this.displayCategorys=[];this.initCategorys(c,b);this.deserialize(g,b)},initCategorys:function(c,f){var g=["app_widgetOnScreen_panel","app_widgetPool_panel"];b.forEach(c.widgetOnScreen.widgets,function(b,c){g.push("app_widgetOnScreen_widgets["+c+"]")},this);b.forEach(c.widgetPool.widgets,function(b,c){g.push("app_widgetPool_widgets["+c+"]")},this);b.forEach(c.widgetPool.groups,
function(b,c){g.push("app_widgetPool_groups["+c+"]")},this);var k=new p(f,"Virtual","Virtual",["app_widgetOnScreen","app_widgetPool"],g,[]);this.categorys.push(k);k=new p(f,"Attribute","Attribute",["app"],"app_theme app_map app_widgetOnScreen app_widgetPool app_splashPage app_portalUrl app_appId app_widgetManifestsMerged app_geometryService app_httpProxy isWebTier".split(" "),["app_title","app_subtitle"]);this.categorys.push(k);b.forEach(c.widgetOnScreen.widgets,function(b,c){var g="ScreenWidget_"+
b.id,k="app_widgetOnScreen_widgets["+c+"]",h=[k],k=[k+"_uri",k+"_id",k+"_name",k+"_index",k+"_position",k+"_positionRelativeTo",k+"_isThemeWidget",k+"_placeholderIndex",k+"_keepConfigAfterMapSwithched"];b.uri&&this.categorys.push(new p(f,g,b.label+" widget",h,k))},this);b.forEach(c.widgetOnScreen.groups,function(c,g){var k="ScreenWidgetGroup_"+c.id,l="app_widgetOnScreen_groups["+g+"]",h=[l],a=[l+"_id",l+"_index"];b.forEach(c.widgets,function(b,d){a.push(l+"_widgets["+d+"]_url");a.push(l+"_widgets["+
d+"]__id");a.push(l+"_widgets["+d+"]_uri");a.push(l+"_widgets["+d+"]_id");a.push(l+"_widgets["+d+"]_name");a.push(l+"_widgets["+d+"]_index");a.push(l+"_widgets["+d+"]_position");a.push(l+"_widgets["+d+"]_positionRelativeTo")});this.categorys.push(new p(f,k,c.label,h,a))},this);b.forEach(c.widgetPool.widgets,function(b,c){var g="widgetPoolWidget_"+b.id,k="app_widgetPool_widgets["+c+"]",h=[k],k=[k+"_uri",k+"_id",k+"_name",k+"_index",k+"_keepConfigAfterMapSwithched"];b.uri&&this.categorys.push(new p(f,
g,b.label+" widget",h,k))},this);b.forEach(c.widgetPool.groups,function(c,g){var k="widgetPoolGroup_"+c.id,l="app_widgetPool_groups["+g+"]",h=[l],a=[l+"_id",l+"_index",l+"_panel"];b.forEach(c.widgets,function(b,d){a.push(l+"_widgets["+d+"]_url");a.push(l+"_widgets["+d+"]__id");a.push(l+"_widgets["+d+"]_uri");a.push(l+"_widgets["+d+"]_id");a.push(l+"_widgets["+d+"]_name");a.push(l+"_widgets["+d+"]_index")});this.categorys.push(new p(f,k,c.label,h,a))},this);this.displayCategorys.push(k)},getCategoryByName:function(b){return this.categorys[this.findCategory(b)]},
getCategoryByField:function(b){var c;for(c=0;c<this.categorys.length;c++)if(this.categorys[c].hasField(b))return this.categorys[c];return null},findCategory:function(b){return this._find(b,this.categorys)},findDisplayCategory:function(b){return this._find(b,this.displayCategorys)},_find:function(b,c){var g;for(g=0;g<c.length&&c[g].name!==b;g++);return g===c.length?-1:g},addCategoryToDisplay:function(b){-1===this.findDisplayCategory(b.name)&&this.displayCategorys.push(b)},removeCategoryFromDisplay:function(b){b=
this.findDisplayCategory(b.name);0<=b&&this.displayCategorys.splice(b,1)},moveup:function(b){var c;b=this.findDisplayCategory(b.name);return 0<b?(c=this.displayCategorys[b],this.displayCategorys[b]=this.displayCategorys[b-1],this.displayCategorys[b-1]=c,!0):!1},movedown:function(b){var c;b=this.findDisplayCategory(b.name);return 0<=b&&b<this.displayCategorys.length-1?(c=this.displayCategorys[b],this.displayCategorys[b]=this.displayCategorys[b+1],this.displayCategorys[b+1]=c,!0):!1},getTemplateJson:function(g){var f=
{configurationSettings:[],values:{}};b.forEach(this.displayCategorys,function(k,l){var p={category:k.title,fields:[]};"fullJson"===g&&(p.categoryName=k.name);b.forEach(k.displayFields,function(b,k){var l=c.clone(b.fieldJson);if(!g||"fullJson"!==g)delete l.id,delete l.fieldPath;p.fields[k]=l;f.values[l.fieldName]=n.getDefaultValue(b.fieldJson.fieldName)},this);f.configurationSettings[l]=p},this);return f},deserialize:function(c,f){c&&(b.forEach(this.displayCategorys,function(b){b.displayFields=[]}),
this.displayCategorys=[],c=s.parse(c),b.forEach(c.configurationSettings,function(b){var c=this.getCategoryByName(b.categoryName),g=0;c&&(g=c.deserialize(b.fields,f),0<g&&this.displayCategorys.push(c))},this))}})})},"builder/AGOLTemplate/ShowJsonCodePage":function(){define(["dojo/_base/declare","dijit/_WidgetBase","builder/config/JSONEditor"],function(q,c,b){return q([c],{baseClass:"show-json-code-div",postCreate:function(){this.inherited(arguments);this.jsonEditor=new b({json:this.config});this.jsonEditor.placeAt(this.domNode)},
setConfig:function(b){return this.jsonEditor.setJSON(b)},getConfig:function(){return this.jsonEditor.getJSON()}})})},"builder/AGOLTemplate/Export":function(){define("dojo/_base/declare dojo/_base/lang dijit/dijit dijit/_WidgetBase dijit/_TemplatedMixin dojo/Deferred dojo/promise/all dojo/dom-style dojo/dom-attr jimu/dijit/Message jimu/dijit/LoadingShelter jimu/portalUrlUtils builder/portalUtils builder/CreateAppNew jimu/dijit/Popup ./ExportMessage".split(" "),function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,
x,u){return q([r],{_templateUrl:null,_temlateJson:null,_initDlgPage:function(){this.appTitle.focus();n.set(this.templateTitle,"display","block");window.isXT&&(p.set(this.explain1,"innerHTML",this.nls.explain1),n.set(this.explain1,"display","block"));n.set(this.div2dAnd3d,"display","none");n.set(this.sharingTr,"display","none");v.getPortal(window.portalUrl).getUser().then(c.hitch(this,function(f){this.user=f;this._initFolder(f);var h=this.getDefaultAppInfo();b.byId("publish-webmap-tags").loadTags(f).then(c.hitch(this,
function(){this._setDlgProperties(h)}))}),c.hitch(this,function(b){n.set(this.tagsTr,"display","none");n.set(this.folderTr,"display","none");this._setDlgProperties(this.getDefaultAppInfo());console.error(b.message)}))},getDefaultAppInfo:function(){return{name:"",description:this.nls.templateDefaultSnippet,tags:["template"],folderId:"",sharing:!1,is3D:"false",webmap:null,createFromId:null,creator:null}},_exportedMessage:function(b){b.itemId&&(b.itemUrl=t.getItemDetailsPageUrl(window.portalUrl,b.itemId));
b=new u(b,this.nls);new x({content:b,titleLabel:this.nls.exportMessageTitle,width:"600",autoHeight:!0,buttons:[{label:this.nls.ok}]})},_onNextClick:function(){var b=this._getDlgProperties();if(b.name&&b.tags){var h=new f;h.placeAt(this.popup.domNode);h.startup();this.exportTemplate(b,this._templateUrl,this._temlateJson).then(c.hitch(this,function(a){this._closePopup();this.destroy();h.destroy();this._exportedMessage(a)}),c.hitch(this,function(a){this._closePopup();this.destroy();h.destroy();this._exportedMessage(a)}))}else new m({message:this.nls.noTitleMessage})},
exportTemplate:function(b,h,a){var e=new k,d=new k,f=new k,g=new k,l="http://"+window.location.host+window.location.pathname,m=l.indexOf("index.html");-1!==m&&(l=l.slice(0,m));l+="builder/css/images/templateThumbnail.jpg";v.getPortal(window.portalUrl).getUser().then(function(a){d.resolve(a)},function(a){d.reject(a);console.error(a.message||a);e.reject({itemId:null,message:this.nls.exportTemplateFailed5})});d.then(c.hitch(this,function(d){var c={title:b.name,snippet:b.description,tags:b.tags,url:h,
thumbnailurl:l,type:"Web Mapping Application",typeKeywords:"Configurable, JavaScript",text:a};b.folderId===d.username&&(b.folderId="");d.addItem(c,b.folderId).then(function(a){a.success?f.resolve(a):(console.error(a.message||""),f.reject(this.nls.exportTemplateFailed1))},function(a){f.reject(a);console.error(a.message||a);e.reject({itemId:null,message:this.nls.exportTemplateFailed1})})}));v.getTemplatesGroup(window.portalUrl).then(c.hitch(this,function(a){g.resolve(a)}),function(a){g.reject(a);console.error(a.message||
a);e.reject({itemId:null,message:this.nls.exportTemplateFailed2})});s({user:d,itemRes:f,templateGroup:g}).then(c.hitch(this,function(a){a.user.shareItem({groups:a.templateGroup.id},a.itemRes.id,b.folderId).then(c.hitch(this,function(b){-1===b.notSharedWith.indexOf(a.templateGroup.id)?e.resolve({itemId:a.itemRes.id,message:this.nls.exportSuccessful}):e.reject({itemId:a.itemRes.id,message:this.nls.exportTemplateFailed3,type:"no_permission_to_share"})}),function(b){console.error(b.message||b);e.reject({itemId:a.itemRes.id,
message:this.nls.exportTemplateFailed4})})}));return e}})})},"builder/AGOLTemplate/ExportMessage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/dom-style dojo/dom-attr dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./ExportMessage.html".split(" "),function(q,c,b,g,l,k,s,n,p,m,f){return q([p,m],{baseClass:"agol-template-export-message",templateString:f,constructor:function(b,c){this.exportedInfo=b;this.nls=c},postCreate:function(){this.inherited(arguments);
"no_permission_to_share"===this.exportedInfo.type?(g.setAttr(this.word1,"innerHTML",this.nls.exportTemplateFailed31),this.exportedInfo.itemUrl&&(g.setAttr(this.itemLink,"innerHTML",this.nls.descriptionTemplateUrl21),g.setAttr(this.itemLink,"href",this.exportedInfo.itemUrl)),g.setAttr(this.word2,"innerHTML",this.nls.exportTemplateFailed32)):(this.exportedInfo.message&&g.setAttr(this.resMessage,"innerHTML",this.exportedInfo.message),this.exportedInfo.itemUrl&&(g.setAttr(this.word1,"innerHTML",this.nls.descriptionTemplateUrl1),
g.setAttr(this.itemLink,"innerHTML",this.nls.descriptionTemplateUrl2),g.setAttr(this.itemLink,"href",this.exportedInfo.itemUrl),g.setAttr(this.word2,"innerHTML",this.nls.descriptionTemplateUrl3)))}})})},"jimu/dijit/QRCode":function(){define(["dojo/_base/declare","dijit/_WidgetBase","libs/qrcode"],function(q,c){return q([c],{"class":"jimu-qrcode",postCreate:function(){new QRCode(this.domNode,{text:this.text,width:this.width||128,height:this.height||128,colorDark:this.colorDark||" #000000",colorLight:this.colorLight||
"#ffffff",correctLevel:this.correctLevel||QRCode.CorrectLevel.L})}})})},"libs/qrcode":function(){define(["dojo","dijit","dojox"],function(q,c,b){var g;(function(){function b(c){this.mode=f.MODE_8BIT_BYTE;this.data=c;this.parsedData=[];c=0;for(var a=this.data.length;c<a;c++){var e=[],d=this.data.charCodeAt(c);65536<d?(e[0]=240|(d&1835008)>>>18,e[1]=128|(d&258048)>>>12,e[2]=128|(d&4032)>>>6,e[3]=128|d&63):2048<d?(e[0]=224|(d&61440)>>>12,e[1]=128|(d&4032)>>>6,e[2]=128|d&63):128<d?(e[0]=192|(d&1984)>>>
6,e[1]=128|d&63):e[0]=d;this.parsedData.push(e)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function c(b,a){this.typeNumber=b;this.errorCorrectLevel=a;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function s(b,a){if(void 0==b.length)throw Error(b.length+"/"+a);for(var e=0;e<b.length&&0==b[e];)e++;this.num=Array(b.length-
e+a);for(var d=0;d<b.length-e;d++)this.num[d]=b[d+e]}function n(b,a){this.totalCount=b;this.dataCount=a}function p(){this.buffer=[];this.length=0}function m(){var b=!1,a=navigator.userAgent;/android/i.test(a)&&(b=!0,(aMat=a.toString().match(/android ([0-9]\.[0-9])/i))&&aMat[1]&&(b=parseFloat(aMat[1])));return b}b.prototype={getLength:function(b){return this.parsedData.length},write:function(b){for(var a=0,e=this.parsedData.length;a<e;a++)b.put(this.parsedData[a],8)}};c.prototype={addData:function(c){c=
new b(c);this.dataList.push(c);this.dataCache=null},isDark:function(b,a){if(0>b||this.moduleCount<=b||0>a||this.moduleCount<=a)throw Error(b+","+a);return this.modules[b][a]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(b,a){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++){this.modules[e]=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[e][d]=
null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(b,a);7<=this.typeNumber&&this.setupTypeNumber(b);null==this.dataCache&&(this.dataCache=c.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,a)},setupPositionProbePattern:function(b,a){for(var e=-1;7>=e;e++)if(!(-1>=b+e||this.moduleCount<=
b+e))for(var d=-1;7>=d;d++)-1>=a+d||this.moduleCount<=a+d||(this.modules[b+e][a+d]=0<=e&&6>=e&&(0==d||6==d)||0<=d&&6>=d&&(0==e||6==e)||2<=e&&4>=e&&2<=d&&4>=d?!0:!1)},getBestMaskPattern:function(){for(var b=0,a=0,e=0;8>e;e++){this.makeImpl(!0,e);var d=v.getLostPoint(this);if(0==e||b>d)b=d,a=e}return a},createMovieClip:function(b,a,e){b=b.createEmptyMovieClip(a,e);this.make();for(a=0;a<this.modules.length;a++){e=1*a;for(var d=0;d<this.modules[a].length;d++){var c=1*d;this.modules[a][d]&&(b.beginFill(0,
100),b.moveTo(c,e),b.lineTo(c+1,e),b.lineTo(c+1,e+1),b.lineTo(c,e+1),b.endFill())}}return b},setupTimingPattern:function(){for(var b=8;b<this.moduleCount-8;b++)null==this.modules[b][6]&&(this.modules[b][6]=0==b%2);for(b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=0==b%2)},setupPositionAdjustPattern:function(){for(var b=v.getPatternPosition(this.typeNumber),a=0;a<b.length;a++)for(var e=0;e<b.length;e++){var d=b[a],c=b[e];if(null==this.modules[d][c])for(var f=-2;2>=f;f++)for(var g=
-2;2>=g;g++)this.modules[d+f][c+g]=-2==f||2==f||-2==g||2==g||0==f&&0==g?!0:!1}},setupTypeNumber:function(b){for(var a=v.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!b&&1==(a>>c&1);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(c=0;18>c;c++)d=!b&&1==(a>>c&1),this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d},setupTypeInfo:function(b,a){for(var c=v.getBCHTypeInfo(this.errorCorrectLevel<<3|a),d=0;15>d;d++){var f=!b&&1==(c>>d&1);6>d?this.modules[d][8]=f:8>d?this.modules[d+
1][8]=f:this.modules[this.moduleCount-15+d][8]=f}for(d=0;15>d;d++)f=!b&&1==(c>>d&1),8>d?this.modules[8][this.moduleCount-d-1]=f:9>d?this.modules[8][15-d-1+1]=f:this.modules[8][15-d-1]=f;this.modules[this.moduleCount-8][8]=!b},mapData:function(b,a){for(var c=-1,d=this.moduleCount-1,f=7,g=0,k=this.moduleCount-1;0<k;k-=2)for(6==k&&k--;;){for(var l=0;2>l;l++)if(null==this.modules[d][k-l]){var y=!1;g<b.length&&(y=1==(b[g]>>>f&1));v.getMask(a,d,k-l)&&(y=!y);this.modules[d][k-l]=y;f--; -1==f&&(g++,f=7)}d+=
c;if(0>d||this.moduleCount<=d){d-=c;c=-c;break}}}};c.PAD0=236;c.PAD1=17;c.createData=function(b,a,e){a=n.getRSBlocks(b,a);for(var d=new p,f=0;f<e.length;f++){var g=e[f];d.put(g.mode,4);d.put(g.getLength(),v.getLengthInBits(g.mode,b));g.write(d)}for(f=b=0;f<a.length;f++)b+=a[f].dataCount;if(d.getLengthInBits()>8*b)throw Error("code length overflow. ("+d.getLengthInBits()+"\x3e"+8*b+")");for(d.getLengthInBits()+4<=8*b&&d.put(0,4);0!=d.getLengthInBits()%8;)d.putBit(!1);for(;!(d.getLengthInBits()>=8*
b);){d.put(c.PAD0,8);if(d.getLengthInBits()>=8*b)break;d.put(c.PAD1,8)}return c.createBytes(d,a)};c.createBytes=function(b,a){for(var c=0,d=0,f=0,g=Array(a.length),k=Array(a.length),l=0;l<a.length;l++){var y=a[l].dataCount,m=a[l].totalCount-y,d=Math.max(d,y),f=Math.max(f,m);g[l]=Array(y);for(var u=0;u<g[l].length;u++)g[l][u]=255&b.buffer[u+c];c+=y;u=v.getErrorCorrectPolynomial(m);y=(new s(g[l],u.getLength()-1)).mod(u);k[l]=Array(u.getLength()-1);for(u=0;u<k[l].length;u++)m=u+y.getLength()-k[l].length,
k[l][u]=0<=m?y.get(m):0}for(u=l=0;u<a.length;u++)l+=a[u].totalCount;c=Array(l);for(u=y=0;u<d;u++)for(l=0;l<a.length;l++)u<g[l].length&&(c[y++]=g[l][u]);for(u=0;u<f;u++)for(l=0;l<a.length;l++)u<k[l].length&&(c[y++]=k[l][u]);return c};for(var f={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},t={L:1,M:0,Q:3,H:2},v={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,
30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(b){for(var a=
b<<10;0<=v.getBCHDigit(a)-v.getBCHDigit(v.G15);)a^=v.G15<<v.getBCHDigit(a)-v.getBCHDigit(v.G15);return(b<<10|a)^v.G15_MASK},getBCHTypeNumber:function(b){for(var a=b<<12;0<=v.getBCHDigit(a)-v.getBCHDigit(v.G18);)a^=v.G18<<v.getBCHDigit(a)-v.getBCHDigit(v.G18);return b<<12|a},getBCHDigit:function(b){for(var a=0;0!=b;)a++,b>>>=1;return a},getPatternPosition:function(b){return v.PATTERN_POSITION_TABLE[b-1]},getMask:function(b,a,c){switch(b){case 0:return 0==(a+c)%2;case 1:return 0==a%2;case 2:return 0==
c%3;case 3:return 0==(a+c)%3;case 4:return 0==(Math.floor(a/2)+Math.floor(c/3))%2;case 5:return 0==a*c%2+a*c%3;case 6:return 0==(a*c%2+a*c%3)%2;case 7:return 0==(a*c%3+(a+c)%2)%2;default:throw Error("bad maskPattern:"+b);}},getErrorCorrectPolynomial:function(b){for(var a=new s([1],0),c=0;c<b;c++)a=a.multiply(new s([1,r.gexp(c)],0));return a},getLengthInBits:function(b,a){if(1<=a&&10>a)switch(b){case f.MODE_NUMBER:return 10;case f.MODE_ALPHA_NUM:return 9;case f.MODE_8BIT_BYTE:return 8;case f.MODE_KANJI:return 8;
default:throw Error("mode:"+b);}else if(27>a)switch(b){case f.MODE_NUMBER:return 12;case f.MODE_ALPHA_NUM:return 11;case f.MODE_8BIT_BYTE:return 16;case f.MODE_KANJI:return 10;default:throw Error("mode:"+b);}else if(41>a)switch(b){case f.MODE_NUMBER:return 14;case f.MODE_ALPHA_NUM:return 13;case f.MODE_8BIT_BYTE:return 16;case f.MODE_KANJI:return 12;default:throw Error("mode:"+b);}else throw Error("type:"+a);},getLostPoint:function(b){for(var a=b.getModuleCount(),c=0,d=0;d<a;d++)for(var f=0;f<a;f++){for(var g=
0,k=b.isDark(d,f),l=-1;1>=l;l++)if(!(0>d+l||a<=d+l))for(var m=-1;1>=m;m++)0>f+m||a<=f+m||0==l&&0==m||k==b.isDark(d+l,f+m)&&g++;5<g&&(c+=3+g-5)}for(d=0;d<a-1;d++)for(f=0;f<a-1;f++)if(g=0,b.isDark(d,f)&&g++,b.isDark(d+1,f)&&g++,b.isDark(d,f+1)&&g++,b.isDark(d+1,f+1)&&g++,0==g||4==g)c+=3;for(d=0;d<a;d++)for(f=0;f<a-6;f++)b.isDark(d,f)&&(!b.isDark(d,f+1)&&b.isDark(d,f+2)&&b.isDark(d,f+3)&&b.isDark(d,f+4)&&!b.isDark(d,f+5)&&b.isDark(d,f+6))&&(c+=40);for(f=0;f<a;f++)for(d=0;d<a-6;d++)b.isDark(d,f)&&(!b.isDark(d+
1,f)&&b.isDark(d+2,f)&&b.isDark(d+3,f)&&b.isDark(d+4,f)&&!b.isDark(d+5,f)&&b.isDark(d+6,f))&&(c+=40);for(f=g=0;f<a;f++)for(d=0;d<a;d++)b.isDark(d,f)&&g++;b=Math.abs(100*g/a/a-50)/5;return c+10*b}},r={glog:function(b){if(1>b)throw Error("glog("+b+")");return r.LOG_TABLE[b]},gexp:function(b){for(;0>b;)b+=255;for(;256<=b;)b-=255;return r.EXP_TABLE[b]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},q=0;8>q;q++)r.EXP_TABLE[q]=1<<q;for(q=8;256>q;q++)r.EXP_TABLE[q]=r.EXP_TABLE[q-4]^r.EXP_TABLE[q-5]^r.EXP_TABLE[q-
6]^r.EXP_TABLE[q-8];for(q=0;255>q;q++)r.LOG_TABLE[r.EXP_TABLE[q]]=q;s.prototype={get:function(b){return this.num[b]},getLength:function(){return this.num.length},multiply:function(b){for(var a=Array(this.getLength()+b.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<b.getLength();d++)a[c+d]^=r.gexp(r.glog(this.get(c))+r.glog(b.get(d)));return new s(a,0)},mod:function(b){if(0>this.getLength()-b.getLength())return this;for(var a=r.glog(this.get(0))-r.glog(b.get(0)),c=Array(this.getLength()),
d=0;d<this.getLength();d++)c[d]=this.get(d);for(d=0;d<b.getLength();d++)c[d]^=r.gexp(r.glog(b.get(d))+a);return(new s(c,0)).mod(b)}};n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,
2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,
25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,
74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,
45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,
151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];n.getRSBlocks=
function(b,a){var c=n.getRsBlockTable(b,a);if(void 0==c)throw Error("bad rs block @ typeNumber:"+b+"/errorCorrectLevel:"+a);for(var d=c.length/3,f=[],g=0;g<d;g++)for(var l=c[3*g+0],k=c[3*g+1],m=c[3*g+2],u=0;u<l;u++)f.push(new n(k,m));return f};n.getRsBlockTable=function(b,a){switch(a){case t.L:return n.RS_BLOCK_TABLE[4*(b-1)+0];case t.M:return n.RS_BLOCK_TABLE[4*(b-1)+1];case t.Q:return n.RS_BLOCK_TABLE[4*(b-1)+2];case t.H:return n.RS_BLOCK_TABLE[4*(b-1)+3]}};p.prototype={get:function(b){return 1==
(this.buffer[Math.floor(b/8)]>>>7-b%8&1)},put:function(b,a){for(var c=0;c<a;c++)this.putBit(1==(b>>>a-c-1&1))},getLengthInBits:function(){return this.length},putBit:function(b){var a=Math.floor(this.length/8);this.buffer.length<=a&&this.buffer.push(0);b&&(this.buffer[a]|=128>>>this.length%8);this.length++}};var u=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,
155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,
1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],q=function(){var b=function(a,b){this._el=a;this._htOption=b};b.prototype.draw=function(a){function b(a,d){var c=document.createElementNS("http://www.w3.org/2000/svg",a),e;for(e in d)d.hasOwnProperty(e)&&c.setAttribute(e,d[e]);return c}var d=this._htOption,c=this._el,f=a.getModuleCount();this.clear();var h=b("svg",{viewBox:"0 0 "+String(f)+" "+String(f),width:"100%",height:"100%",fill:d.colorLight});h.setAttributeNS("http://www.w3.org/2000/xmlns/",
"xmlns:xlink","http://www.w3.org/1999/xlink");c.appendChild(h);h.appendChild(b("rect",{fill:d.colorDark,width:"1",height:"1",id:"template"}));for(d=0;d<f;d++)for(c=0;c<f;c++)if(a.isDark(d,c)){var g=b("use",{x:String(d),y:String(c)});g.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");h.appendChild(g)}};b.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)};return b}(),w="svg"===document.documentElement.tagName.toLowerCase()?q:"undefined"==
typeof CanvasRenderingContext2D?function(){var b=function(a,b){this._el=a;this._htOption=b};b.prototype.draw=function(a){for(var b=this._htOption,d=this._el,c=a.getModuleCount(),f=Math.floor(b.width/c),h=Math.floor(b.height/c),g=['\x3ctable style\x3d"border:0;border-collapse:collapse;"\x3e'],l=0;l<c;l++){g.push("\x3ctr\x3e");for(var k=0;k<c;k++)g.push('\x3ctd style\x3d"border:0;border-collapse:collapse;padding:0;margin:0;width:'+f+"px;height:"+h+"px;background-color:"+(a.isDark(l,k)?b.colorDark:b.colorLight)+
';"\x3e\x3c/td\x3e');g.push("\x3c/tr\x3e")}g.push("\x3c/table\x3e");d.innerHTML=g.join("");a=d.childNodes[0];d=(b.width-a.offsetWidth)/2;b=(b.height-a.offsetHeight)/2;0<d&&0<b&&(a.style.margin=b+"px "+d+"px")};b.prototype.clear=function(){this._el.innerHTML=""};return b}():function(){function b(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}function a(a,b){var d=this;d._fFail=b;d._fSuccess=a;if(null===d._bSupportDataURI){var c=
document.createElement("img"),e=function(){d._bSupportDataURI=!1;d._fFail&&_fFail.call(d)};c.onabort=e;c.onerror=e;c.onload=function(){d._bSupportDataURI=!0;d._fSuccess&&d._fSuccess.call(d)};c.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg\x3d\x3d"}else!0===d._bSupportDataURI&&d._fSuccess?d._fSuccess.call(d):!1===d._bSupportDataURI&&d._fFail&&d._fFail.call(d)}if(this._android&&2.1>=this._android){var c=
1/window.devicePixelRatio,d=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,b,f,h,g,l,k,m,u){if("nodeName"in a&&/img/i.test(a.nodeName))for(var n=arguments.length-1;1<=n;n--)arguments[n]*=c;else"undefined"==typeof m&&(arguments[1]*=c,arguments[2]*=c,arguments[3]*=c,arguments[4]*=c);d.apply(this,arguments)}}var f=function(a,b){this._bIsPainted=!1;this._android=m();this._htOption=b;this._elCanvas=document.createElement("canvas");this._elCanvas.width=
b.width;this._elCanvas.height=b.height;a.appendChild(this._elCanvas);this._el=a;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=!1;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};f.prototype.draw=function(a){var b=this._elImage,d=this._oContext,c=this._htOption,e=a.getModuleCount(),f=c.width/e,h=c.height/e,g=Math.round(f),l=Math.round(h);b.style.display="none";
this.clear();for(b=0;b<e;b++)for(var k=0;k<e;k++){var m=a.isDark(b,k),u=k*f,n=b*h;d.strokeStyle=m?c.colorDark:c.colorLight;d.lineWidth=1;d.fillStyle=m?c.colorDark:c.colorLight;d.fillRect(u,n,f,h);d.strokeRect(Math.floor(u)+0.5,Math.floor(n)+0.5,g,l);d.strokeRect(Math.ceil(u)-0.5,Math.ceil(n)-0.5,g,l)}this._bIsPainted=!0};f.prototype.makeImage=function(){this._bIsPainted&&a.call(this,b)};f.prototype.isPainted=function(){return this._bIsPainted};f.prototype.clear=function(){this._oContext.clearRect(0,
0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=!1};f.prototype.round=function(a){return!a?a:Math.floor(1E3*a)/1E3};return f}();g=function(b,a){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:t.H};"string"===typeof a&&(a={text:a});if(a)for(var c in a)this._htOption[c]=a[c];"string"==typeof b&&(b=document.getElementById(b));this._android=m();this._el=b;this._oQRCode=null;this._oDrawing=new w(this._el,this._htOption);this._htOption.text&&
this.makeCode(this._htOption.text)};g.prototype.makeCode=function(b){var a=this._htOption.correctLevel,e=1,d;d=encodeURI(b).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");d=d.length+(d.length!=b?3:0);for(var f=0,g=u.length;f<=g;f++){var l=0;switch(a){case t.L:l=u[f][0];break;case t.M:l=u[f][1];break;case t.Q:l=u[f][2];break;case t.H:l=u[f][3]}if(d<=l)break;else e++}if(e>u.length)throw Error("Too long data");this._oQRCode=new c(e,this._htOption.correctLevel);this._oQRCode.addData(b);this._oQRCode.make();
this._el.title=b;this._oDrawing.draw(this._oQRCode);this.makeImage()};g.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||3<=this._android)&&this._oDrawing.makeImage()};g.prototype.clear=function(){this._oDrawing.clear()};g.CorrectLevel=t;window.QRCode=g})()})},"dojox/main":function(){define(["dojo/_base/kernel"],function(q){return q.dojox})},"builder/Header":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/Header.html dojo/on dojo/topic dojo/keys dojo/request/script esri/request jimu/dijit/Popup jimu/dijit/Message builder/portalUtils jimu/portalUrlUtils builder/tokenUtils jimu/utils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h){return q([l,k],{templateString:s,baseClass:"header",postMixInProperties:function(){this.nls=c.mixin({},builderNls.common);this.nls=c.mixin(this.nls,builderNls.header)},postCreate:function(){this.inherited(arguments);this._initSelf()},_initSelf:function(){this._isWebTier(window.portalUrl)&&(g.destroy(this.signOutItem),this.signOutItem=null);this.own(p.subscribe("disableWebTierUserSignOut"),c.hitch(this,function(){g.destroy(this.signOutItem);this.signOutItem=
null}));window.isXT?(g.destroy(this.homeSection),g.setStyle(this.logoTitle,"cursor","pointer"),this._bindXtEvents()):(g.addClass(this.homeLabel,"dropdown"),this._bindIntegratedEvents(window.portalUrl));var a=x.getPortal(window.portalUrl);a.haveSignIn()&&a.getUser().then(c.hitch(this,function(a){if(a=a&&a.username)this.userNameNode.innerHTML=a}),c.hitch(this,function(a){console.error(a)}))},_isWebTier:function(a){var e=esri.id.findServerInfo(a);return e&&e.webTierAuth?!0:w.webTierPortalUrls&&0<w.webTierPortalUrls.length?
b.some(w.webTierPortalUrls,c.hitch(this,function(b){u.isSamePortalUrl(a,b)})):!1},_bindXtEvents:function(){this.own(p.subscribe("userSignOut",c.hitch(this,function(){this.userNameNode.innerHTML=""})));this.own(p.subscribe("userSignIn",c.hitch(this,function(a){this.userNameNode.innerHTML=a.userId||""})));this.own(n(this.logoTitle,"click",c.hitch(this,function(){var a=c.hitch(this,function(){if(window.history&&window.history.pushState){if("applist"!==main.getSelectedLabel()){p.publish("switchToAppList");
var a=window.location.href.split("?")[0];window.history.pushState({path:a},"",a)}}else window.location.href="index.html"});this._hasConfigApp()?p.publish("leavePage",a):a()})));this.own(n(this.profileItem,"click",c.hitch(this,function(){var a=c.hitch(this,function(){window.location.href=u.getHomeUserUrl(window.portalUrl)});this._hasConfigApp()?p.publish("leavePage",a):a()})));this.own(n(this.helpItem,"click",c.hitch(this,function(){var a=c.hitch(this,function(){window.location.href="help"});this._hasConfigApp()?
p.publish("leavePage",a):a()})));this.signOutItem&&this.own(n(this.signOutItem,"click",c.hitch(this,function(){var a=c.hitch(this,function(){this.userNameNode.innerHTML="";w.signOutAll();p.publish("switchToSetPortalUrl",null);var a=u.getOAuth2SignOutUrl(window.portalUrl),a=u.setHttpsProtocol(a),b=window.location.href.replace(/[\?|\&](id=)(.+)/,"");h.changeLocation(b);f.get(a,{jsonp:"callback"}).then(function(a){(a=a&&a.length)&&console.log(a)},function(a){console.log(a)})});this._hasConfigApp()?p.publish("leavePage",
a):a()})))},_bindIntegratedEvents:function(a){this.own(n(this.homeItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeIndexUrl(a)})})));this.own(n(this.galleryItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeGalleryUrl(a)})})));this.own(n(this.mapItem,"click",c.hitch(this,function(){window.appConfig&&window.appConfig.map&&p.publish("leavePage",function(){window.location.href=u.getHomeMapViewerUrl(window.appConfig.map.portalUrl||
window.appConfig.portalUrl,window.appConfig.map.itemId)})})));this.own(n(this.groupsItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeGroupsUrl(a)})})));this.own(n(this.contentItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeMyContentUrl(a)})})));this.own(n(this.organizationItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeMyOrganizationUrl(a)})})));
this.own(n(this.profileItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){window.location.href=u.getHomeUserUrl(a)})})));this.own(n(this.helpItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){0<=a.indexOf(".arcgis.com")?window.location.href="http://doc.arcgis.com/en/web-appbuilder/":window.location.href=u.getPortalHelpUrl(a)})})));this.signOutItem&&this.own(n(this.signOutItem,"click",c.hitch(this,function(){p.publish("leavePage",function(){w.signOutAll();window.location.href=
u.getPortalSignInUrlFromLocation()})})))},setAppName:function(a){this.appName.innerHTML=a||""},getAppName:function(){return this.appName.innerHTML||""},_hasConfigApp:function(){return!!main.getViewByLabel("config")}})})},"builder/Apps":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dojo/mouse dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Apps.html dojo/on dojo/keys dojo/_base/lang dijit/form/ValidationTextBox ./CreateApp ./CreateAppNew ./AppOperMenu ./serviceUtils dojo/Deferred dojo/topic dojo/dom-class dojo/dom dojo/query dijit/registry jimu/dijit/Message builder/portalUtils dojox/form/Uploader".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C,z){return q([k,s,n],{templateString:p,menu:void 0,label:"applist",apps:{},sortBy:"lastUpdated",postMixInProperties:function(){this.inherited(arguments);this.nls=t.mixin({},builderNls.common);this.nls=t.mixin(this.nls,builderNls.apps)},constructor:function(){},startup:function(){this.inherited(arguments);this.refresh();b.setSelectable(this.appContent,!1)},getAppList:function(){return w.getAppList()},refresh:function(a){a?(this.setApps(a),this.createAppList()):
this.getAppList().then(t.hitch(this,function(a){this.setApps(a);this.createAppList()}))},setApps:function(a){this.apps=a},createAppList:function(){this.cleanAppList();var a,b=null;for(a=0;a<this.apps.length;a++)b=this.createAppNode(this.apps[a],a,b)},cleanAppList:function(){b.empty(this.listTable.firstElementChild||this.listTable.firstChild)},createAppNode:function(d,c,e){var f,h,g,k,n,p,r,v,w,s,q,x;c=b.create("tr",{"class":"list-table-item list-table-item"+(c%2?" list-table-item-add ":" ")},this.listTable.firstElementChild||
this.listTable.firstChild);x=b.create("td",{"class":"item-begin-td item-first-td"},c);b.create("td",{"class":"item-begin-td item-second-td"},c);h=b.create("td",{"class":"item-name-td"},c);g=b.create("div",{"class":"item-name",innerHTML:d.name},h);k=b.create("td",{"class":"item-desc-td"},c);n=b.create("div",{"class":"item-desc",innerHTML:d.description},k);f=b.create("td",{"class":"item-time-td"},c);q=b.create("div",{"class":"item-time",innerHTML:d.lastUpdated},f);f=b.create("td",{"class":"item-modified-td"},
c);var z=b.create("div",{"class":"item-modified",innerHTML:d.modified},f);f=b.create("td",{"class":"item-creator-td"},c);b.create("div",{"class":"item-creator",innerHTML:d.creator},f);f=b.create("td",{"class":"item-loading-td",innerHTML:"\x3cdiv class\x3d'loading-div'\x3e\x3c/div\x3e"},c);w=A(".loading-div",f)[0];b.create("img",{src:"builder/css/images/download.gif","class":"loading-img"},w);f=b.create("td",{"class":"item-operations-td"},c);f=b.create("div",{"class":"item-operations-div"},f);b.setStyle(f,
"display","none");p=b.create("div",{"class":"item-edit",title:this.nls.edit},f);b.create("div",{innerHTML:this.nls.edit,"class":"item-edit-text"},p);r=b.create("div",{innerHTML:'\x3ca href\x3d"stemapp/index.html?id\x3d'+d.id+'" target\x3d"_blank"\x3e'+this.nls.launch+"\x3c/a\x3e","class":"item-preview",title:this.nls.launch},f);v=b.create("div",{"class":"item-more"},f);s=b.create("td",{"class":"item-end-td"},c);s=b.create("div",{"class":"app-menu-div"},s);w=new u({apps:this.apps,app:d,posNode:c,loadingDiv:w,
appListWidget:this},s);this.own(m(c,l.enter,t.hitch(this,this._onListTableItemMouseover,c,f,e)));this.own(m(c,l.leave,t.hitch(this,this._onListTableItemMouseout,c,f,w,e)));this.own(m(c,"click",t.hitch(this,function(a){a.stopPropagation()})));this.own(m(g,"dblclick",t.hitch(this,this._onNameDoubleClick,d,c,h,g,q,z)));this.own(m(n,"dblclick",t.hitch(this,this._onDescriptionDoubleClick,d,c,k,n,q,z)));this.own(m(p,"click",t.hitch(this,this._onAppEditClick,d)));this.own(m(r,"click",this._onAppPreviewClick(d)));
this.own(m(v,"click",t.hitch(this,this._onAppMoreClick,d,w,v,x,c,f,e)));this.own(m(this.ownerDocument,"click",t.hitch(this,this._onAppsClick,w,c,f,x,e,v)));this.own(a.subscribe("menuAll/hide",t.hitch(this,this._onAppsClick,w,c,f,x,e,v)));this.own(m(this.listSectionBodyContent,"scroll",t.hitch(this,this._onScroll,w,c,f,x,e,v)));return c},createAppNodeHTML:function(a){return"\x3ctd\x3e\x3cdiv\x3e"+a.name+"\x3c/div\x3e\x3c/td\x3e\x3ctd\x3e\x3cdiv\x3e"+a.description+"\x3c/div\x3e\x3c/td\x3e\x3ctd\x3e\x3cdiv\x3e"+
a.lastUpdated+'\x3c/div\x3e\x3c/td\x3e\x3cinput type\x3d"button" value\x3d"Edit" /\x3e\x3cinput type\x3d"button" value\x3d"Preview"/\x3e\x3cinput type\x3d"button" value\x3d"..."/\x3e'},changeTextFieldOfNode:function(a,d,c,f,h,g,l){var k,u=t.clone(a);console.debug(a.name+" "+f+"_doubleclick");b.setStyle(h,"display","none");k="name"===f?b.create("input",{value:a[f],"class":"jimu-input item-input-"+f},c):b.create("textarea",{value:a[f],"class":"jimu-input item-textarea-"+f},c);k.focus();k.select();e.add(d,
"list-table-item-dbclick");m(k,"blur",t.hitch(this,function(){a[f]!==k.value&&(u[f]=k.value,this.updateApp(u).then(function(b){!0===b.success?(h.innerHTML=k.value,g.innerHTML=b.lastUpdated,l.innerHTML=b.modified,a[f]=k.value):(console.error("The response of updateApp is 'unsuccess'!"),new C({message:b.message}))},function(a){console.error("Updates 'app name' or 'app description' failed!"+a)}));b.destroy(k);b.setStyle(h,"display","block");e.remove(d,"list-table-item-dbclick")}))},updateApp:function(a){return w.updateApp(a)},
_onCreateClick:function(){x.popupDlg({appListWidget:this})},_onAppFileUploadError:function(a){console.error(a);new C({message:a.message||a})},_onAppFileUploadComplete:function(a){a.success?(this.cleanAppList(),this.getAppList().then(t.hitch(this,function(a){this.setApps(a);this.createAppList()}))):new C({message:a.message})},_onAppFileChange:function(){z.getPortal(window.portalUrl).getUser().then(t.hitch(this,function(a){b.setAttr(this.appFileCreatorInputNode,"value",a.username);this.appFileInputNode.submit(this.uploadAppFileFormNode)}),
function(a){console.error(a);new C({message:a.message||a})})},_onListTableItemMouseover:function(a,d,c){e.add(a,"list-table-item-mouseover");c&&e.add(c,"list-table-next-item-mouseover");b.setStyle(d,"display","block")},_onListTableItemMouseout:function(a,d,c,f){c.isShow||(e.remove(a,"list-table-item-mouseover"),f&&e.remove(f,"list-table-next-item-mouseover"),b.setStyle(d,"display","none"))},_onNameDoubleClick:function(a,b,d,c,e,f){t.hitch(this,this.changeTextFieldOfNode(a,b,d,"name",c,e,f))},_onDescriptionDoubleClick:function(a,
b,d,c,e,f){t.hitch(this,this.changeTextFieldOfNode(a,b,d,"description",c,e,f))},_onAppEditClick:function(b){a.publish("switchToApp",b)},_onAppPreviewClick:function(a){return function(){console.debug(a.name+" Preview_click")}},_onAppMoreClick:function(d,c,f,h,g,k,l,m){c.isShow?(c.hide(),e.remove(h,"item-first-td-selected"),b.removeClass(f,"item-more-selected")):(a.publish("menuAll/hide"),c.set("app",d),c.show(),e.add(h,"item-first-td-selected"),b.addClass(f,"item-more-selected"),this._onListTableItemMouseover(g,
k,l,m));m.stopPropagation()},_onAppsClick:function(a,d,c,f,h,g){a.hide();e.remove(f,"item-first-td-selected");h&&e.remove(h,"list-table-next-item-mouseover");e.remove(d,"list-table-item-mouseover");b.removeClass(g,"item-more-selected");b.setStyle(c,"display","none")},_onScroll:function(a,b,d,c,e,f){!0===a.isShow&&this._onAppsClick(a,b,d,c,e,f)}})})},"builder/CreateApp":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/CreateApp.html dojo/on dojo/dom-style dojo/dom-class dojo/dom-attr dojo/_base/lang jimu/dijit/Message dojo/ready ./ConfigApp ./serviceUtils".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u){return q([l,k],{templateString:s,baseClass:"create-app",appListWidget:null,is3D:"false",postMixInProperties:function(){this.nls=t.mixin({},builderNls.common);this.nls=t.mixin(this.nls,builderNls.apps)},postCreate:function(){this.inherited(arguments);m.add(this.app2D,"app-image-div-down")},startup:function(){this.inherited(arguments);this.appName.focus()},saveApp:function(){},createApp:function(){return u.createApp({name:this.appName.value,description:this.appDescription.value,
is3D:this.is3D,webmap:this.webmap})},_onCancelClick:function(){this.destroy();this._closePopup();console.debug("cancel click")},_onNextClick:function(){this.appName.value?this.createApp().then(t.hitch(this,function(b){if(b.success){var c=main.getViewByLabel("config");c&&c.appId.toString()===b.newAppId.toString()||(this.appListWidget.refresh(),c&&main.removeView(c),c=new x({appId:b.newAppId}),main.addView(c));main.switchView(c);this._closePopup();this.destroy()}else new v({message:b.message})}),function(b){console.error("Creates a new APP failed!"+
b);new v({message:this.nls.createAppFailedMeg})}):new v({message:this.nls.noAppName})},_closePopup:function(){this.popup&&this.popup.close()},_on2dClick:function(){this.is3D="false";m.add(this.app2D,"app-image-div-down");m.remove(this.app3D,"app-image-div-down")},_on3dClick:function(){}})})},"builder/AppOperMenu":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AppOperMenu.html dojo/on dojo/query dojo/dom-style dojo/dom-attr dojo/dom dojo/keys dojo/_base/lang jimu/dijit/Popup jimu/dijit/Message builder/CreateApp ./AGOLTemplate/AGOLTemplate ./serviceUtils jimu/ConfigManager jimu/dijit/LoadingShelter dijit/form/TextBox dijit/form/SimpleTextarea jimu/dijit/QRCode".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B,C){return q([l,k],{templateString:s,baseClass:"app-menu",app:void 0,isShow:!1,position:{},itemDefaultColor:"#ffffff",appListWidget:void 0,loadingDiv:null,_downloadUrl:null,postMixInProperties:function(){this.nls=r.mixin({},builderNls.common);this.nls=r.mixin(this.nls,builderNls.apps)},postCreate:function(){this.inherited(arguments);this.height=b.getMarginBox(this.domNode).h;this.hide();this._downloadUrl="/builder/rest/apps/"+this.app.id+"/download";
b.setAttr(this.downloadLinkNode,"href",this._downloadUrl);this.own(n(this.downloadLinkNode,"click",r.hitch(this,function(){this.hide()})))},refresh:function(){var a=t.byId("list-section"),d=b.position(this.posNode),c=b.position(a),e=d.y-c.y,a=b.getStyle(a,"height"),c=c.y+a,a=this.height,d=d.y+a;b.setStyle(this.upTriangle,"display","block");b.setStyle(this.downTriangle,"display","none");d+30>c&&(e=e-a-66,b.setStyle(this.upTriangle,"display","none"),b.setStyle(this.downTriangle,"top",this.height-2+
"px"),b.setStyle(this.downTriangle,"display","block"));b.setStyle(this.domNode,{top:e+52+"px",right:"2px"})},show:function(){this.refresh();b.setStyle(this.domNode,"display","block");this.isShow=!0},hide:function(){b.setStyle(this.domNode,"display","none");this.isShow=!1},removeApp:function(a){return g("/builder/rest/apps/removeapp",{handleAs:"json",method:"POST",data:{id:a}})},duplicateApp:function(){return a.duplicateApp({name:this.app.name,description:this.app.description,id:this.app.id})},_onMenuClick:function(a){a.stopPropagation()},
_onCreateFromHereClick:function(){var a=b.create("div",{id:"app-create-popup"},this.appListWidget.createApp);new w({appListWidget:this.appListWidget,apps:this.apps,createFromId:this.app.id,is3D:this.app.is3D},a);this.hide()},_onCreateFromHereMouseover:function(){b.addClass(this.createFromHere,"item-mouseover")},_onCreateFromHereMouseout:function(){b.removeClass(this.createFromHere,"item-mouseover")},_onRemoveClick:function(){var a=new x({content:this.nls.confirmDeleteApp,titleLabel:this.nls.deleteAppTitle,
width:"425",autoHeight:!0,buttons:[{label:this.nls.ok,onClick:r.hitch(this,function(){var b=new d({hidden:!0});b.placeAt(this.appListWidget.domNode);b.show(this.nls.deleting);a.close();this.removeApp(this.app.id).then(r.hitch(this,function(a){a.success?(console.log("Removed app successfully, id\x3d"+this.app.id),a.apps!=={}&&this.appListWidget.refresh(a.apps)):console.error(this.nls.deleteFalse);b.destroy()}),function(){console.error(this.nls.deleteError);b.destroy()})})},{label:this.nls.cancel,onClick:r.hitch(this,
function(){a.close()})}]})},_onRemoveMouseover:function(){b.addClass(this.remove,"item-mouseover")},_onRemoveMouseout:function(){b.removeClass(this.remove,"item-mouseover")},_onDuplicateClick:function(){var b=new d({hidden:!0});b.placeAt(this.appListWidget.domNode);b.show(this.nls.duplicating);a.duplicateApp({name:this.app.name,description:this.app.description,is3D:this.app.is3D,createFromId:this.app.id}).then(r.hitch(this,function(a){b.destroy();a.success?(console.log("Duplicated app successfully, app id\x3d"+
this.app.id),a.apps!=={}&&this.appListWidget.refresh(a.apps)):console.error(this.nls.duplicateFalse)}),function(){console.error(this.nls.duplicateError)});this.hide()},_onDuplicateMouseover:function(){b.addClass(this.duplicate,"item-mouseover")},_onDuplicateMouseout:function(){b.removeClass(this.duplicate,"item-mouseover")},_onEditClick:function(){var a=b.create("div",{"class":"edit-app-info-content"}),d;d=b.create("div",{"class":"app-name"},a);var c=(new A({value:this.app.name,maxlength:250,required:!0,
placeholder:this.nls.appName,"class":"name-text-box"})).placeAt(d);d=b.create("div",{"class":"app-description"},a);var e=(new B({value:this.app.description,rows:5,trim:!0,maxlength:250,required:!0,placeholder:this.nls.appDesc,"class":"desc-text-area"})).placeAt(d),f=new x({content:a,container:"main-page",titleLabel:this.nls.editAppInfo,width:"700",autoHeight:!0,buttons:[{label:this.nls.ok,onClick:r.hitch(this,function(){var a=r.hitch(this,this._onEditPageOk,c.getValue(),e.getValue(),f);(this.app.name!==
c.getValue()||this.app.description!==e.getValue())&&a()})},{label:this.nls.cancel,onClick:function(){f.close()}}]}),a=p(".line",f.domNode)[0];b.destroy(a)},_onEditPageOk:function(a,b,d){var c=r.clone(this.app);c.name=a;c.description=b;this.appListWidget.updateApp(c).then(r.hitch(this,function(c){!0===c.success?(this.app.name=a,this.app.description=b,console.log(this.nls.editAppTrue+this.app.id),this.app.lastUpdated=c.lastUpdated,this.app.modified=c.modified,this.appListWidget.refresh(this.apps),d.close()):
(console.error(this.nls.editAppFalse),new u({message:c.message}))}),function(a){console.error(this.nls.error+a)})},_onEditMouseover:function(){b.addClass(this.editAppInfo,"item-mouseover")},_onEditMouseout:function(){b.removeClass(this.editAppInfo,"item-mouseover")},_onDownloadClick:function(){},_onDownloadMouseover:function(){b.addClass(this.download,"item-mouseover")},_onDownloadMouseout:function(){b.removeClass(this.download,"item-mouseover")},_onAgolTemplateClick:function(){jimuConfig.widgetsPackage=
{name:"widgets",location:"/webappbuilder/apps/"+this.app.id+"/widgets"};jimuConfig.themesPackage={name:"themes",location:"/webappbuilder/apps/"+this.app.id+"/themes"};var a=(new d({})).placeAt("main-view-stack");a.startup();e.getInstance({config:"/webappbuilder/apps/"+this.app.id+"/config.json"}).loadConfig().then(r.hitch(this,function(b){var d=b.getCleanConfig(),d=r.clone(d);delete d.agolTemplateJson;d.visitElement=b.visitElement;d.visitElement(function(a){!a.widgets&&(a.uri&&void 0===a.visible)&&
(a.visible=!0)});delete d.visitElement;b=new h({appConfig:d,fullAppConfig:b,app:this.app});new x({content:b,container:"main-page",titleLabel:builderNls.agolTemplate.title,width:1040,height:625,buttons:[{label:builderNls.agolTemplate.download,key:v.ENTER,onClick:r.hitch(b,b._onExportClick)},{label:builderNls.common.saved,key:v.ENTER,onClick:r.hitch(b,b._onSaveClick)},{label:this.nls.cancel,key:v.ESCAPE}]});b.startup();a.hide()}),function(){a.hide()});this.hide()},_onAgolTemplateMouseover:function(){b.addClass(this.agolTemplate,
"item-mouseover")},_onAgolTemplateMouseout:function(){b.removeClass(this.agolTemplate,"item-mouseover")},_onQRCodeClick:function(){new x({content:new C({text:"http://"+window.location.host+path+"apps/"+this.app.id,width:128,height:128}),container:"main-page",titleLabel:"qrcode-nonls",width:300,autoHeight:!0,buttons:[{label:this.nls.cancel,key:v.ESCAPE}]})}})})},"dojox/form/Uploader":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/window dojo/dom-style dojo/dom-class dojo/dom-geometry dojo/dom-attr dojo/dom-construct dojo/dom-form dijit dijit/form/Button ./uploader/_Base ./uploader/_HTML5 ./uploader/_IFrame ./uploader/_Flash dojo/i18n!./nls/Uploader dojo/text!./resources/Uploader.html".split(" "),
function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e){return c("dojox.form.Uploader",[x,r,u,w,h],{uploadOnSelect:!1,tabIndex:0,multiple:!1,label:a.label,url:"",name:"uploadedfile",flashFieldName:"",force:"",uploadType:"",showInput:"",focusedClass:"dijitButtonHover",_nameIndex:0,templateString:e,baseClass:"dijitUploader "+r.prototype.baseClass,postMixInProperties:function(){this._inputs=[];this._cons=[];this.force=this.force.toLowerCase();this.supports("multiple")?this.uploadType="form"===this.force?"form":
"html5":this.uploadType="flash"===this.force?"flash":"iframe";this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);s.set(this.domNode,{overflow:"hidden",position:"relative"});this._buildDisplay();m.set(this.titleNode,"tabIndex",-1)},_buildDisplay:function(){this.showInput&&(this.displayInput=f.create("input",{"class":"dijitUploadDisplayInput",tabIndex:-1,autocomplete:"off",role:"presentation"},this.containerNode,this.showInput),this._attachPoints.push("displayInput"),this.connect(this,
"onChange",function(a){for(var b=0,c,e=[];c=a[b++];)c&&c.name&&e.push(c.name);this.displayInput.value=e.join(", ")}),this.connect(this,"reset",function(){this.displayInput.value=""}))},startup:function(){this._buildInitialized||(this._buildInitialized=!0,this._getButtonStyle(this.domNode),this._setButtonStyle(),this.inherited(arguments))},onChange:function(a){},onBegin:function(a){},onProgress:function(a){},onComplete:function(a){this.reset()},onCancel:function(){},onAbort:function(){},onError:function(a){},
upload:function(a){a=a||{};a.uploadType=this.uploadType;this.inherited(arguments)},submit:function(a){a=a?a.tagName?a:this.getForm():this.getForm();a=t.toObject(a);a.uploadType=this.uploadType;this.upload(a)},reset:function(){delete this._files;this._disconnectButton();g.forEach(this._inputs,f.destroy);this._inputs=[];this._nameIndex=0;this._createInput()},getFileList:function(){var a=[];this.supports("multiple")?g.forEach(this._files,function(b,c){a.push({index:c,name:b.name,size:b.size,type:b.type})},
this):g.forEach(this._inputs,function(b,c){b.value&&a.push({index:c,name:b.value.substring(b.value.lastIndexOf("\\")+1),size:0,type:b.value.substring(b.value.lastIndexOf(".")+1)})},this);return a},_getValueAttr:function(){return this.getFileList()},_setValueAttr:function(a){console.error("Uploader value is read only")},_setDisabledAttr:function(a){this.disabled!=a&&this.inputNode&&(this.inherited(arguments),s.set(this.inputNode,"display",a?"none":""))},_getButtonStyle:function(a){this.btnSize={w:s.get(a,
"width"),h:s.get(a,"height")}},_setButtonStyle:function(){this.inputNodeFontSize=Math.max(2,Math.max(Math.ceil(this.btnSize.w/60),Math.ceil(this.btnSize.h/15)));this._createInput()},_getFileFieldName:function(){return this.supports("multiple")&&this.multiple?this.name+"s[]":this.name+(this.multiple?this._nameIndex:"")},_createInput:function(){this._inputs.length&&(s.set(this.inputNode,{top:"500px"}),this._disconnectButton(),this._nameIndex++);var a=this._getFileFieldName();this.focusNode=this.inputNode=
f.create("input",{type:"file",name:a,"aria-labelledby":this.id+"_label"},this.domNode,"first");this.supports("multiple")&&this.multiple&&m.set(this.inputNode,"multiple",!0);this._inputs.push(this.inputNode);s.set(this.inputNode,{position:"absolute",fontSize:this.inputNodeFontSize+"em",top:"-3px",right:"-3px",opacity:0});this._connectButton()},_connectButton:function(){this._cons.push(l.connect(this.inputNode,"change",this,function(a){this._files=this.inputNode.files;this.onChange(this.getFileList(a));
!this.supports("multiple")&&this.multiple&&this._createInput()}));-1<this.tabIndex&&(this.inputNode.tabIndex=this.tabIndex,this._cons.push(l.connect(this.inputNode,"focus",this,function(){n.add(this.domNode,this.focusedClass)})),this._cons.push(l.connect(this.inputNode,"blur",this,function(){n.remove(this.domNode,this.focusedClass)})))},_disconnectButton:function(){g.forEach(this._cons,l.disconnect);this._cons.splice(0,this._cons.length)}})})},"dojox/form/uploader/_Base":function(){define("dojo/dom-form dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/has dojo/_base/declare dojo/_base/event dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin".split(" "),
function(q,c,b,g,l,k,s,n,p,m){l.add("FormData",function(){return!!window.FormData});l.add("xhr-sendAsBinary",function(){var b=window.XMLHttpRequest&&new window.XMLHttpRequest;return b&&!!b.sendAsBinary});l.add("file-multiple",function(){return!!{"true":1,"false":1}[g.get(document.createElement("input",{type:"file"}),"multiple")]});return k("dojox.form.uploader._Base",[n,p,m],{getForm:function(){if(!this.form)for(var b=this.domNode;b&&b.tagName&&b!==document.body;){if("form"==b.tagName.toLowerCase()){this.form=
b;break}b=b.parentNode}return this.form},getUrl:function(){this.uploadUrl&&(this.url=this.uploadUrl);if(this.url)return this.url;this.getForm()&&(this.url=this.form.action);return this.url},connectForm:function(){this.url=this.getUrl();!this._fcon&&this.getForm()&&(this._fcon=!0,this.connect(this.form,"onsubmit",function(b){console.log("SUBMIT");s.stop(b);this.submit(this.form)}))},supports:function(b){switch(b){case "multiple":if("flash"==this.force||"iframe"==this.force)break;return l("file-multiple");
case "FormData":return l(b);case "sendAsBinary":return l("xhr-sendAsBinary")}return!1},getMimeType:function(){return"application/octet-stream"},getFileType:function(b){return b.substring(b.lastIndexOf(".")+1).toUpperCase()},convertBytes:function(b){var c=Math.round(1E5*(b/1024))/1E5,g=Math.round(1E5*(b/1048576))/1E5,k=Math.round(1E5*(b/1073741824))/1E5,l=b;1<c&&(l=c.toFixed(1)+" kb");1<g&&(l=g.toFixed(1)+" mb");1<k&&(l=k.toFixed(1)+" gb");return{kb:c,mb:g,gb:k,bytes:b,value:l}}})})},"dojox/form/uploader/_HTML5":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo"],function(q,c,b,g){return q("dojox.form.uploader._HTML5",[],{errMsg:"Error uploading files. Try checking permissions",uploadType:"html5",postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.connectForm();this.inherited(arguments);this.uploadOnSelect&&this.connect(this,"onChange",function(b){this.upload(b[0])})},_drop:function(b){g.stopEvent(b);this._files=b.dataTransfer.files;this.onChange(this.getFileList())},upload:function(b){this.onBegin(this.getFileList());
this.uploadWithFormData(b)},addDropTarget:function(b,c){c||(this.connect(b,"dragenter",g.stopEvent),this.connect(b,"dragover",g.stopEvent),this.connect(b,"dragleave",g.stopEvent));this.connect(b,"drop","_drop")},uploadWithFormData:function(c){if(this.getUrl()){var g=new FormData,s=this._getFileFieldName();b.forEach(this._files,function(b,c){g.append(s,b)},this);if(c){c.uploadType=this.uploadType;for(var n in c)g.append(n,c[n])}this.createXhr().send(g)}else console.error("No upload url found.",this)},
_xhrProgress:function(b){if(b.lengthComputable){var c={bytesLoaded:b.loaded,bytesTotal:b.total,type:b.type,timeStamp:b.timeStamp};"load"==b.type?(c.percent="100%",c.decimal=1):(c.decimal=b.loaded/b.total,c.percent=Math.ceil(100*(b.loaded/b.total))+"%");this.onProgress(c)}},createXhr:function(){var b=new XMLHttpRequest,g;b.upload.addEventListener("progress",c.hitch(this,"_xhrProgress"),!1);b.addEventListener("load",c.hitch(this,"_xhrProgress"),!1);b.addEventListener("error",c.hitch(this,function(b){this.onError(b);
clearInterval(g)}),!1);b.addEventListener("abort",c.hitch(this,function(b){this.onAbort(b);clearInterval(g)}),!1);b.onreadystatechange=c.hitch(this,function(){if(4===b.readyState){clearInterval(g);try{this.onComplete(JSON.parse(b.responseText.replace(/^\{\}&&/,"")))}catch(c){console.error("Error parsing server result:",c),console.error(b.responseText),this.onError("Error parsing server result:",c)}}});b.open("POST",this.getUrl());b.setRequestHeader("Accept","application/json");g=setInterval(c.hitch(this,
function(){}),250);return b}})})},"dojox/form/uploader/_IFrame":function(){define("dojo/query dojo/dom-construct dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-form dojo/request/iframe".split(" "),function(q,c,b,g,l,k,s){return b("dojox.form.uploader._IFrame",[],{postMixInProperties:function(){this.inherited(arguments);"iframe"===this.uploadType&&(this.uploadType="iframe",this.upload=this.uploadIFrame)},uploadIFrame:function(b){var g={},k;this.getForm();var f=this.getUrl(),t=this;b=
b||{};b.uploadType=this.uploadType;k=c.place('\x3cform enctype\x3d"multipart/form-data" method\x3d"post"\x3e\x3c/form\x3e',this.domNode);l.forEach(this._inputs,function(b,c){""!==b.value&&(k.appendChild(b),g[b.name]=b.value)},this);if(b)for(nm in b)void 0===g[nm]&&c.create("input",{name:nm,value:b[nm],type:"hidden"},k);s.post(f,{form:k,handleAs:"json",content:b}).then(function(b){c.destroy(k);if(b.ERROR||b.error)t.onError(b);else t.onComplete(b)},function(b){console.error("error parsing server result",
b);c.destroy(k);t.onError(b)})}})})},"dojox/form/uploader/_Flash":function(){define("dojo/dom-form dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/_base/declare dojo/_base/config dojo/_base/connect dojo/_base/lang dojo/_base/array dojox/embed/Flash".split(" "),function(q,c,b,g,l,k,s,n,p,m){return l("dojox.form.uploader._Flash",[],{swfPath:k.uploaderPath||require.toUrl("dojox/form/resources/uploader.swf"),preventCache:!0,skipServerCheck:!0,serverTimeout:2E3,isDebug:!1,devMode:!1,deferredUploading:0,
postMixInProperties:function(){"flash"===this.uploadType&&(this._files=[],this._fileMap={},this._createInput=this._createFlashUploader,this.getFileList=this.getFlashFileList,this.reset=this.flashReset,this.upload=this.uploadFlash,this.fieldname="flashUploadFiles");this.inherited(arguments)},onReady:function(b){},onLoad:function(b){},onFileChange:function(b){},onFileProgress:function(b){},getFlashFileList:function(){return this._files},flashReset:function(){this.flashMovie.reset();this._files=[];this._fileMap=
{}},uploadFlash:function(b){this.onBegin(this.getFileList());b=b||{};b.returnType="F";b.uploadType=this.uploadType;console.log("flas upload",b);this.flashMovie.doUpload(b)},_change:function(b){this._files=this._files.concat(b);p.forEach(b,function(b){b.bytesLoaded=0;b.bytesTotal=b.size;this._fileMap[b.name+"_"+b.size]=b},this);this.onChange(this._files);this.onFileChange(b)},_complete:function(b){this._getCustomEvent().type="load";this.onComplete(b)},_progress:function(b){this._fileMap[b.name+"_"+
b.bytesTotal].bytesLoaded=b.bytesLoaded;var c=this._getCustomEvent();this.onFileProgress(b);this.onProgress(c)},_error:function(b){this.onError(b)},_onFlashBlur:function(b){},_getCustomEvent:function(){var b={bytesLoaded:0,bytesTotal:0,type:"progress",timeStamp:(new Date).getTime()},c;for(c in this._fileMap)b.bytesTotal+=this._fileMap[c].bytesTotal,b.bytesLoaded+=this._fileMap[c].bytesLoaded;b.decimal=b.bytesLoaded/b.bytesTotal;b.percent=Math.ceil(100*(b.bytesLoaded/b.bytesTotal))+"%";return b},_connectFlash:function(){this._subs=
[];this._cons=[];var b=n.hitch(this,function(b,c){this._subs.push(s.subscribe(this.id+b,this,c))});b("/filesSelected","_change");b("/filesUploaded","_complete");b("/filesProgress","_progress");b("/filesError","_error");b("/filesCanceled","onCancel");b("/stageBlur","_onFlashBlur");this.connect(this.domNode,"focus",function(){this.flashMovie.focus();this.flashMovie.doFocus()});0<=this.tabIndex&&g.set(this.domNode,"tabIndex",this.tabIndex)},_createFlashUploader:function(){var f=this.btnSize.w,g=this.btnSize.h;
if(f){var k=this.getUrl();if(k){if(0>k.toLowerCase().indexOf("http")&&0!=k.indexOf("/")){var l=window.location.href.split("/");l.pop();l=l.join("/")+"/";k=l+k}}else console.warn("Warning: no uploadUrl provided.");this.inputNode=b.create("div",{className:"dojoxFlashNode"},this.domNode,"first");c.set(this.inputNode,{position:"absolute",top:"-2px",width:f+"px",height:g+"px",opacity:0});f={expressInstall:!0,path:(this.swfPath.uri||this.swfPath)+(this.preventCache?"?cb_"+(new Date).getTime():""),width:f,
height:g,allowScriptAccess:"always",allowNetworking:"all",vars:{uploadDataFieldName:this.flashFieldName||this.name+"Flash",uploadUrl:k,uploadOnSelect:this.uploadOnSelect,deferredUploading:this.deferredUploading||0,selectMultipleFiles:this.multiple,id:this.id,isDebug:this.isDebug,noReturnCheck:this.skipServerCheck,serverTimeout:this.serverTimeout},params:{scale:"noscale",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"}};this.flashObject=new m(f,this.inputNode);this.flashObject.onError=
n.hitch(function(b){console.error("Flash Error: "+b)});this.flashObject.onReady=n.hitch(this,function(){this.onReady(this)});this.flashObject.onLoad=n.hitch(this,function(b){this.flashMovie=b;this.flashReady=!0;this.onLoad(this)});this._connectFlash()}else setTimeout(dojo.hitch(this,function(){this._getButtonStyle(this.domNode);this._createFlashUploader()}),200)}})})},"dojox/embed/Flash":function(){define("dojo/_base/lang dojo/_base/unload dojo/_base/array dojo/query dojo/has dojo/dom dojo/on dojo/window".split(" "),
function(q,c,b,g,l,k,s,n){function p(b){b=q.delegate(r,b);if(!("path"in b))return console.error("dojox.embed.Flash(ctor):: no path reference to a Flash movie was provided."),null;"id"in b||(b.id=t+v++);return b}var m,f,t="dojox-embed-flash-",v=0,r={expressInstall:!1,width:320,height:240,swLiveConnect:"true",allowScriptAccess:"sameDomain",allowNetworking:"all",style:null,redirect:null};l("ie")?(m=function(b){b=p(b);if(!b)return null;var c,f=b.path;if(b.vars){var a=[];for(c in b.vars)a.push(c+"\x3d"+
b.vars[c]);b.params.FlashVars=a.join("\x26");delete b.vars}f='\x3cobject id\x3d"'+b.id+'" classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width\x3d"'+b.width+'" height\x3d"'+b.height+'"'+(b.style?' style\x3d"'+b.style+'"':"")+'\x3e\x3cparam name\x3d"movie" value\x3d"'+f+'" /\x3e';if(b.params)for(c in b.params)f+='\x3cparam name\x3d"'+c+'" value\x3d"'+b.params[c]+'" /\x3e';return{id:b.id,markup:f+"\x3c/object\x3e"}},f=function(){for(var b=10,c=null;!c&&7<b;)try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+
b--)}catch(f){}return c?(b=c.GetVariable("$version").split(" ")[1].split(","),{major:null!=b[0]?parseInt(b[0]):0,minor:null!=b[1]?parseInt(b[1]):0,rev:null!=b[2]?parseInt(b[2]):0}):{major:0,minor:0,rev:0}}(),c.addOnWindowUnload(function(){console.warn("***************UNLOAD");var b=function(){};g("object").reverse().style("display","none").forEach(function(c){for(var f in c)if("FlashVars"!=f&&"function"==typeof c[f])try{c[f]=b}catch(a){}})})):(m=function(b){b=p(b);if(!b)return null;var c,f=b.path;
if(b.vars){var a=[];for(c in b.vars)a.push(c+"\x3d"+b.vars[c]);b.params.flashVars=a.join("\x26");delete b.vars}f='\x3cembed type\x3d"application/x-shockwave-flash" src\x3d"'+f+'" id\x3d"'+b.id+'" width\x3d"'+b.width+'" height\x3d"'+b.height+'"'+(b.style?' style\x3d"'+b.style+'" ':"")+'pluginspage\x3d"'+window.location.protocol+'//www.adobe.com/go/getflashplayer" ';if(b.params)for(c in b.params)f+=" "+c+'\x3d"'+b.params[c]+'"';return{id:b.id,markup:f+" /\x3e"}},f=function(){var b=navigator.plugins["Shockwave Flash"];
return b&&b.description?(b=b.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."),{major:null!=b[0]?parseInt(b[0]):0,minor:null!=b[1]?parseInt(b[1]):0,rev:null!=b[2]?parseInt(b[2]):0}):{major:0,minor:0,rev:0}}());var x=function(b,c){if(-1<location.href.toLowerCase().indexOf("file://"))throw Error("dojox.embed.Flash can't be run directly from a file. To instatiate the required SWF correctly it must be run from a server, like localHost.");this.available=f.major;this.minimumVersion=
b.minimumVersion||9;this.domNode=this.movie=this.id=null;c&&(c=k.byId(c));setTimeout(q.hitch(this,function(){if(b.expressInstall||this.available&&this.available>=this.minimumVersion)if(b&&c)this.init(b,c);else this.onError("embed.Flash was not provided with the proper arguments.");else if(this.available)this.onError("Flash version detected: "+this.available+" is out of date. Minimum required: "+this.minimumVersion);else this.onError("Flash is not installed.")}),100)};q.extend(x,{onReady:function(b){},
onLoad:function(b){},onError:function(b){},_onload:function(){clearInterval(this._poller);delete this._poller;delete this._pollCount;delete this._pollMax;this.onLoad(this.movie)},init:function(b,c){this.destroy();c=k.byId(c||this.domNode);if(!c)throw Error("dojox.embed.Flash: no domNode reference has been passed.");var f=0;this._poller=null;this._pollCount=0;this._pollMax=15;this.pollTime=100;x.initialized&&(this.id=x.place(b,c),this.domNode=c,setTimeout(q.hitch(this,function(){this.movie=this.byId(this.id,
b.doc);this.onReady(this.movie);this._poller=setInterval(q.hitch(this,function(){try{f=this.movie.PercentLoaded()}catch(a){console.warn("this.movie.PercentLoaded() failed",a,this.movie)}if(100==f)this._onload();else if(0==f&&this._pollCount++>this._pollMax)throw clearInterval(this._poller),Error("Building SWF failed.");}),this.pollTime)}),1))},_destroy:function(){try{this.domNode.removeChild(this.movie)}catch(b){}this.id=this.movie=this.domNode=null},destroy:function(){if(this.movie){var b=q.delegate({id:!0,
movie:!0,domNode:!0,onReady:!0,onLoad:!0}),c;for(c in this)b[c]||delete this[c];this._poller?s(this,"Load",this,"_destroy"):this._destroy()}},byId:function(b,c){c=c||document;return c.embeds[b]?c.embeds[b]:c[b]?c[b]:window[b]?window[b]:document[b]?document[b]:null}});q.mixin(x,{minSupported:8,available:f.major,supported:f.major>=f.required,minimumRequired:f.required,version:f,initialized:!1,onInitialize:function(){x.initialized=!0},__ie_markup__:function(b){return m(b)},proxy:function(c,f){b.forEach(f instanceof
Array?f:[f],function(c){this[c]=q.hitch(this,function(){return function(){return eval(this.movie.CallFunction('\x3cinvoke name\x3d"'+c+'" returntype\x3d"javascript"\x3e\x3carguments\x3e'+b.map(arguments,function(a){return __flash__toXML(a)}).join("")+"\x3c/arguments\x3e\x3c/invoke\x3e"))}.apply(this,arguments||[])})},c)}});x.place=function(b,c){var f=m(b);c=k.byId(c);c||(c=n.doc.createElement("div"),c.id=f.id+"-container",n.body().appendChild(c));return f?(c.innerHTML=f.markup,f.id):null};x.onInitialize();
q.setObject("dojox.embed.Flash",x);return x})},"url:builder/templates/ConfigApp.html":'\x3cdiv \x3e\r\n  \x3cdiv class\x3d"left-pane" data-dojo-attach-point\x3d"leftPaneNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"right-preview-section" data-dojo-attach-point\x3d"rightPreviewSection"\x3e\r\n    \x3cdiv class\x3d"preview-config" data-dojo-attach-point\x3d"previewConfig"\x3e\r\n      \x3ciframe name\x3d"previewFrame" data-dojo-attach-point\x3d"viewerNode" style\x3d"border:none"\x3e\x3c/iframe\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"preview-more" data-dojo-attach-point\x3d"previewMore"\x3e\r\n      \x3cdiv class\x3d"preview-more-iframe-section" data-dojo-attach-point\x3d"previewMoreIframeSection"\x3e\r\n        \x3cdiv class\x3d"preview-more-iframe-container" data-dojo-attach-point\x3d"viewer2Container"\x3e\r\n          \x3ciframe name\x3d"previewMoreFrame" data-dojo-attach-point\x3d"viewer2Node"\x3e\x3c/iframe\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"description" data-dojo-attach-point\x3d"previewMoreDes"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e    \r\n      \x3cdiv class\x3d"screen-switch-section"\x3e\r\n       \x3cdiv class\x3d"portrait selected" data-dojo-attach-point\x3d"btnPortrait"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"landscape" data-dojo-attach-point\x3d"btnLandscape"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/LeftPane.html":'\x3cdiv class\x3d"left-pane"\x3e\r\n  \x3cdiv class\x3d"content" data-dojo-attach-point\x3d"content"\x3e\r\n    \x3cdiv class\x3d"config-section" data-dojo-attach-point\x3d"configSection"\x3e\r\n      \x3cdiv class\x3d"tabs" data-dojo-attach-point\x3d"tabsNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"appPaneNode"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"mapPaneNode"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"widgetPaneNode"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"attributePaneNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"preview-section" data-dojo-attach-point\x3d"previewSection" style\x3d"display:none;"\x3e\r\n      \x3cdiv class\x3d"preview-header"\x3e\r\n        \x3cdiv class\x3d"header-item size-section"\x3e\r\n          \x3cdiv\x3e${nls.width}\x3c/div\x3e\r\n          \x3cinput type\x3d"text" value\x3d"1024" data-dojo-attach-point\x3d"customWidth" /\x3e\r\n          \x3cdiv class\x3d"Pixel"\x3e Px \x3c/div\x3e\r\n          \x3cdiv style\x3d"margin-left:20px;"\x3e${nls.height}\x3c/div\x3e\r\n          \x3cinput type\x3d"text" value\x3d"768"  data-dojo-attach-point\x3d"customHeight" /\x3e\r\n          \x3cdiv class\x3d"Pixel"\x3e Px \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"preview-body"\x3e\r\n        \x3c!--div class\x3d"operation-tip"\x3e${nls.selectDevice}\x3c/div--\x3e\r\n        \x3cdiv class\x3d"preview-items-section"\x3e\r\n          \x3ctable cellspacing\x3d"17"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"previewTbody"\x3e\r\n              \x3c!-- \x3ctr\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv class\x3d"preview-item"\x3e\r\n                    \x3cdiv class\x3d"preview-item-bg"\x3e\r\n                      \x3cdiv class\x3d"preview-item-thumbnail"\x3e\x3c/div\x3e\r\n                      \x3cdiv class\x3d"preview-selected-icon"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cspan class\x3d"preview-item-title"\x3eiPhone5/5S\x3c/span\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e --\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"preview-qrcode-section" \x3e\r\n          \x3cdiv class\x3d"qrcode-image" data-dojo-attach-point\x3d"qrcodeImage"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"qrcode-description" data-dojo-attach-point\x3d"qrcodeDescription"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"footer"\x3e\r\n    \x3cdiv class\x3d"footer-button first-footer-button" data-dojo-attach-point\x3d"btnHomePage"\x3e\x3c!--${nls.share}--\x3e\x3c/div\x3e\r\n    \x3cdiv class \x3d "seprate"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"footer-button second-footer-button preview-button" data-dojo-attach-point\x3d"btnPreview"\x3e${nls.previewMore}\x3c/div\x3e\r\n    \x3cdiv class\x3d"footer-button second-footer-button config-button" data-dojo-attach-point\x3d"btnConfig"\x3e${nls.back2Configure}\x3c/div\x3e\r\n    \x3cdiv class \x3d "seprate"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"footer-button third-footer-button" data-dojo-attach-point\x3d"btnSave"\x3e${nls.saved}\x3c/div\x3e\r\n    \x3cdiv class\x3d"forth-footer-button-arrow" \x3e\r\n      \x3cdiv class\x3d"foot-menu" data-dojo-attach-point\x3d"footMenu"\x3e\r\n          \x3cdiv nowrap data-dojo-attach-event\x3d"click:_onSave"\x3e${nls.save}\x3c/div\x3e\r\n          \x3cdiv nowrap data-dojo-attach-event\x3d"click:_onSaveAs"\x3e${nls.saveAs}\x3c/div\x3e\r\n          \x3cdiv nowrap data-dojo-attach-event\x3d"click:_onExportAsTemplate" data-dojo-attach-point\x3d"exportMenu"\x3e${nls.exportTitle}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e      \r\n\r\n    \r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"loading-cover" data-dojo-attach-point\x3d"coverNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/config/templates/MapConfig.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"map-info-section"\x3e\r\n\t\t\x3cdiv class\x3d"map-info map-selected-section" data-dojo-attach-point\x3d"mapSelectedSection" style\x3d"display:block;"\x3e\r\n\t\t\t\x3cdiv class\x3d"map-selected-meta-data"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"map-selected-img" data-dojo-attach-point\x3d"divMapSelectedImg" data-dojo-attach-event\x3d"click:_showMapSelector"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"detail-info"\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"overflow:hidden;"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"web-map-icon" style\x3d"float:left;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv style\x3d"float:right;width:140px;"\x3e\r\n\t\t\t\t\t\t\t\x3cspan style\x3d"float:left;margin-left:5px;"\x3eWeb Map ${nls.owner}\x3c/span\x3e\r\n\t\t\t\t\t\t\t\x3ca data-dojo-attach-point\x3d"owner" href\x3d"#" target\x3d"_blank" style\x3d"display:block;color:#15a4fa;text-decoration:none;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"margin-top:5px;"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.lastModified}:\x3c/span\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lastModified" style\x3d"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"margin-top:5px;"\x3e\r\n\t\t\t\t\t\t\x3ca data-dojo-attach-point\x3d"webMapDetails" href\x3d"#" target\x3d"_blank" style\x3d"text-decoration:none;color:#15a4fa;"\x3e${nls.moreDetails}...\x3c/a\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv nowrap class\x3d"map-config-btn choose-map-btn" title\x3d"${nls.changeMap}" data-dojo-attach-event\x3d"click:_showMapSelector"\x3e${nls.changeMap}\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"map-info-title" data-dojo-attach-point\x3d"mapTitle"\x3e\x3c/div\x3e\r\n\t\t\t\x3cp class\x3d"snippet" data-dojo-attach-point\x3d"snippet"\x3e\x3c/p\x3e\r\n\t\t\t\x3cp class\x3d"statement"\x3e${nls.statement}\x3c/p\x3e\r\n\t\t\t\x3cspan class\x3d"map-config-btn" data-dojo-attach-point\x3d"btnInitialExtent" style\x3d"margin-top:15px;"\x3e${nls.setInitialExtent}\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"map-config-btn" data-dojo-attach-point\x3d"restore"  style\x3d"margin-top:15px;"data-dojo-attach-event\x3d"onClick:_restoreToDefaultWebMapExtent"\x3e${nls.restoreInitialExtent}\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/MapSelector.html":'\x3cdiv style\x3d"position:relative;width:100%;height:100%;"\x3e\r\n\t\x3cdiv class\x3d"map-setting-tab-container" style\x3d"width:100%;height:100%;"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"tabNode"\x3e\x3c/div\x3e\r\n\r\n\t\t\x3cdiv class\x3d"tab-content mycontent-tab" data-dojo-attach-point\x3d"mycontentTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"tab-content-main mycontent-tab-content-main"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"mycontentSearch" data-dojo-type\x3d"jimu/dijit/Search" data-dojo-props\x3d\'searchWhenInput:false\' data-dojo-attach-event\x3d"onSearch:_onMyContentSearch" style\x3d"position:absolute;width:100%;top:15px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"mycontentMapTable" data-dojo-type\x3d"builder/config/MapTable" style\x3d"top:65px;"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv class\x3d"tab-content organization-tab" data-dojo-attach-point\x3d"organizationTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"tab-content-main organization-tab-content-main"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"organizationSearch" data-dojo-type\x3d"jimu/dijit/Search" data-dojo-props\x3d\'searchWhenInput:false\' data-dojo-attach-event\x3d"onSearch:_onOrganizationSearch" style\x3d"position:absolute;width:100%;top:15px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"organizationMapTable" data-dojo-type\x3d"builder/config/MapTable" style\x3d"top:65px;"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv class\x3d"tab-content group-tab" data-dojo-attach-point\x3d"groupTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"tab-content-main group-tab-content-main"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"groups-section" style\x3d"position:absolute;width:100%;top:70px;" data-dojo-attach-point\x3d"groupsSection"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.groups}:\x3c/span\x3e\r\n\t\t\t\t\t\x3cselect class\x3d"groups-select" data-dojo-attach-point\x3d"groupsSelect"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"nodata"\x3e${nls.noneGroups}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"groupSearch" data-dojo-type\x3d"jimu/dijit/Search" data-dojo-props\x3d\'searchWhenInput:false\' data-dojo-attach-event\x3d"onSearch:_onGroupSearch" style\x3d"position:absolute;width:100%;top:15px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"groupMapTable" data-dojo-type\x3d"builder/config/MapTable" style\x3d"top:113px;"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv class\x3d"tab-content public-tab" data-dojo-attach-point\x3d"publicTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"tab-content-main public-tab-content-main"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"publicSearch" data-dojo-type\x3d"jimu/dijit/Search" data-dojo-props\x3d\'searchWhenInput:false\' data-dojo-attach-event\x3d"onSearch:_onPublicSearch" style\x3d"position:absolute;width:100%;top:15px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"public-search-radios"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"portalPublicRaido" type\x3d"radio" name\x3d"publicSearchRaido" style\x3d"margin-right:10px;" /\x3e\r\n\t\t\t\t\t\x3cspan style\x3d"margin-right:28px;" data-dojo-attach-point\x3d"portalServer"\x3ePortal\x3c/span\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"onlinePublicRaido" type\x3d"radio" name\x3d"publicSearchRaido" style\x3d"margin-right:10px;" /\x3e\r\n\t\t\t\t\t\x3cspan\x3eArcGIS.com\x3c/span\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"publicMapSection" class\x3d"public-map-section"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"publicPortalMapTable" data-dojo-type\x3d"builder/config/MapTable"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"publicOnlineMapTable" data-dojo-type\x3d"builder/config/MapTable"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"signin-section" data-dojo-attach-point\x3d"signinSection" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"signin-tip"\x3e${nls.signInTip}\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/MapTable.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"maps-section" data-dojo-attach-point\x3d"allMapsSection"\x3e\r\n\t\t\x3cdiv class\x3d"maps-table-div" data-dojo-attach-point\x3d"allMapsTableDiv"\x3e\r\n\t\t\t\x3ctable class\x3d"maps-table" cellpadding\x3d"10" data-dojo-attach-point\x3d"allMapsTable"\x3e\r\n\t\t\t\t\x3ctbody class\x3d"maps-tbody" data-dojo-attach-point\x3d"allMapsTbody"\x3e\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"allMapsShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"maps-section" data-dojo-attach-point\x3d"filteredMapsSection" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"maps-table-div" data-dojo-attach-point\x3d"filteredMapsTableDiv"\x3e\r\n\t\t\t\x3ctable class\x3d"maps-table" cellpadding\x3d"10" data-dojo-attach-point\x3d"filteredMapsTable"\x3e\r\n\t\t\t\t\x3ctbody class\x3d"maps-tbody" data-dojo-attach-point\x3d"filteredMapsTbody"\x3e\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"search-none-tip-section" data-dojo-attach-point\x3d"searchNoneTipSection" style\x3d"display:none;"\x3e\r\n\t\t\t\x3cspan class\x3d"search-none-icon"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"search-none-tip"\x3e${nls.searchNone}\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"filteredMapsShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/ThemeConfig.html":'\x3cdiv class\x3d"theme-config"\x3e\r\n  \x3cdiv class\x3d"theme-list" data-dojo-attach-point\x3d"themeList"\x3e\r\n    \x3cdiv class\x3d"theme-title"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"style-list" data-dojo-attach-point\x3d"styleList"\x3e\r\n    \x3c!--div class\x3d"style-text"\x3e${nls.styleTitle}\x3c/div--\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"layout-list" data-dojo-attach-point\x3d"layoutList"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"theme-loading-cover" style\x3d"display:none" data-dojo-attach-point\x3d"themeCoverNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/config/templates/WidgetConfig.html":'\x3cdiv class\x3d"widget-config"\x3e\r\n  \x3cdiv class\x3d"pane app-widgets" data-dojo-attach-point\x3d"appWidgetsPageNode"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:builder/config/templates/AppWidgetsPage.html":'\x3cdiv class\x3d"app-widgets"\x3e\r\n  \x3cdiv class\x3d"preload-widgets-list" data-dojo-attach-point\x3d"preloadWidgetsNode"\x3e\r\n    \x3cdiv class\x3d"controller-widgets-list" data-dojo-attach-point\x3d"controllerWidgetsNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"noncontroller-preload-widgets-list" data-dojo-attach-point\x3d"noncontrollerPreloadWidgetsNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"pool-widgets-list" data-dojo-attach-point\x3d"poolWidgetsNode"\x3e\r\n    \x3cdiv class\x3d"widgets-link" data-dojo-attach-point\x3d"backWidgetsNode" data-dojo-attach-event\x3d"onclick: _onBackWidgetsClick"\x3e \x26lt; \x26nbsp;\r\n      ${nls.widgets}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"widget-pool-title" data-dojo-attach-point\x3d"poolTitleNode"\x3e${nls.setControlledWidgetsBy}\x3cspan data-dojo-attach-point\x3d"controllerLabelNode"\x3e\x3c/span\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"widget-pool-list" data-dojo-attach-point\x3d"poolWidgetsListNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/WidgetSettingPage.html":'\x3cdiv class\x3d"widget-setting-page"\x3e\r\n  \x3cdiv class\x3d"section common-setting" data-dojo-attach-point\x3d"commonSettingNode"\x3e\r\n    \x3cdiv class\x3d"basic"\x3e\r\n      \x3cdiv class\x3d"icon"\x3e\r\n        \x3cimg class\x3d"real-icon"  data-dojo-attach-point\x3d"iconNode"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right"\x3e\r\n        \x3cinput data-dojo-attach-point\x3d"labelNode" class\x3d"jimu-input"\x3e\r\n        \x3cdiv class\x3d"right-foot" data-dojo-attach-point\x3d"rightFooterNode"\x3e\r\n          \x3cdiv class\x3d"image-container"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"imageChooser"\x3e\x3c/div\x3e\r\n            \x3cspan nowrap class\x3d"change-icon" data-dojo-attach-point\x3d"changeNode"\x3e${nls.changeIcon}\x3c/span\x3e\r\n            \x3ca class\x3d"help-link" target\x3d"_blank" data-dojo-attach-point\x3d"helpNode"\x3e${nls.more}\x3c/a\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"layout"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"section widget-setting" data-dojo-attach-point\x3d"widgetSettingNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/GroupSettingPage.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"label-div"\x3e\r\n    \x3cspan\x3e${nls.label}\x3c/span\x3e\r\n    \x3cinput class\x3d"jimu-input" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/input\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:builder/config/templates/WidgetChoosePage.html":'\x3cdiv class\x3d"widget-choose-page"\x3e\r\n  \r\n  \x3cdiv class\x3d"section search" data-dojo-attach-point\x3d"searchSectionNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"searchInputNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"list widget-list" data-dojo-attach-point\x3d"widgetListNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/config/templates/AttributeConfig.html":'\x3cdiv class\x3d"attribute-config"\x3e\r\n  \x3cdiv class\x3d"section header-section" data-dojo-attach-point\x3d"headerSection"\x3e\r\n    \x3cp class\x3d"header-title"\x3e${nls.headerTitle}\x3c/p\x3e\r\n    \x3cdiv class\x3d"header-desc"\x3e${nls.headerDesc}\x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"jimu/dijit/ImageChooser" data-dojo-attach-point\x3d"imageChooser"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"no-logo"  data-dojo-attach-point\x3d"noLogoNode"\x3e\r\n        \x3cimg class\x3d"image" src\x3d"builder/css/images/add_header.png"\x3e\r\n        \x3cdiv class\x3d"text"\x3e ${nls.addLogo}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cimg class\x3d"logo" data-dojo-attach-point\x3d"logoNode" style\x3d"display:none"\x3e\r\n      \x3cdiv class\x3d"titles"\x3e\r\n        \x3cdiv style\x3d"background-color:#fafafc;" class\x3d"title"\x3e\r\n          \x3cinput  placeholder\x3d"${nls.title}" data-dojo-attach-point\x3d"titleNode" maxLength\x3d"100"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"background-color:#fafafc;" class\x3d"subtitle"\x3e\r\n          \x3cinput  placeholder\x3d"${nls.subtitle}" data-dojo-attach-point\x3d"subtitleNode" maxLength\x3d"100"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"section links-section" data-dojo-attach-point\x3d"linksSection"\x3e\r\n    \x3cp class\x3d"title"\x3e${nls.linksTitle}\x3c/p\x3e\r\n    \x3cdiv class\x3d"attribute-content"\x3e\r\n      \x3cdiv class\x3d"list-header"\x3e\r\n        \x3cspan class\x3d"header-button add" data-dojo-attach-event\x3d"onclick: onAddLinkClick"\x3e${nls.addLink}\x3c/span\x3e\r\n        \x3cspan class\x3d"header-button edit" data-dojo-attach-event\x3d"onclick: onEditLinkClick"\x3e${nls.editLabel}\x3c/span\x3e\r\n        \x3cspan class\x3d"header-button delete" data-dojo-attach-event\x3d"onclick: onDeleteLinkClick"\x3e${nls.deleteLabel}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"links-list" data-dojo-attach-point\x3d"linksListNode"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"section appId-section" data-dojo-attach-point\x3d"appIdSection" style\x3d"display:none"\x3e\r\n    \x3cp class\x3d"title"\x3e${nls.appIdTitle}\x3c/p\x3e\r\n    \x3ca target\x3d"_blank" href\x3d"http://doc.arcgis.com/en/arcgis-online/share-maps/add-items.htm#ESRI_SECTION2_20AF85308FD548B5ADBAE28836F66D3F"\x3e${nls.appIdAbout}\x3c/a\x3e\r\n    \x3cdiv class\x3d"attribute-content"\x3e\r\n      \x3cinput type\x3d"text" placeholder\x3d"AppId" data-dojo-attach-point\x3d"appIdNode" /\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"section" data-dojo-attach-point\x3d"useProxySection" style\x3d"display:none"\x3e\r\n    \x3cdiv class\x3d"proxy-setting" data-dojo-attach-point\x3d"useProxySetting"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"proxy-section" data-dojo-attach-point\x3d"proxySection"\x3e\r\n      \x3clabel class\x3d"rules-label"\x3e${nls.proxyRulesLabel}\x3c/label\x3e\r\n      \x3cdiv class\x3d"attribute-content"\x3e\r\n        \x3cdiv class\x3d"list-header"\x3e\r\n          \x3cspan class\x3d"header-button add" data-dojo-attach-event\x3d"onclick: onAddProxyRuleClick"\x3e${nls.addProxyRule}\x3c/span\x3e\r\n          \x3cspan class\x3d"header-button edit" data-dojo-attach-event\x3d"onclick: onEditProxyRuleClick"\x3e${nls.editLabel}\x3c/span\x3e\r\n          \x3cspan class\x3d"header-button delete" data-dojo-attach-event\x3d"onclick: onDeleteProxyRuleClick"\x3e${nls.deleteLabel}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"proxy-rule-header"\x3e\r\n          \x3cdiv class\x3d"prefix"\x3e${nls.prefixHeader}\x3c/div\x3e\r\n          \x3cdiv class\x3d"proxy-url"\x3e${nls.proxyUrlHeader}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"proxy-rule-list" data-dojo-attach-point\x3d"proxyRulesListNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"always-use-proxy" data-dojo-attach-point\x3d"alwaysUseProxy"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"attribute-content" data-dojo-attach-point\x3d"proxyUrlSection" \x3e\r\n        \x3cinput type\x3d"text" placeholder\x3d"${nls.proxyUrl}" data-dojo-attach-point\x3d"proxyUrlNode" /\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/config/templates/TabContainer2.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable class\x3d"control-table"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-viewstack2" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:builder/templates/CreateAppNew.html":'\x3cdiv\x3e\r\n      \x3cdiv id\x3d"share-map-application-publish" dojoType\x3d"dijit.layout.ContentPane" dojoAttachPoint\x3d"_stackApplicationPublish" class\x3d"share-map-stack-stack  .esriLtr .esri"\x3e\r\n\r\n        \x3cp style\x3d"display:none;" class\x3d"configureApp"\x3e${nls.savePublish}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder"\x3e${nls.appBuilderTitle}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder"\x3e${nls.appBuilderMsg}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder" data-dojo-attach-point\x3d"templateTitle"\x3e${nls.templateTitle}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder" data-dojo-attach-point\x3d"message1"\x3e\x3c/p\x3e\r\n        \x3cdiv style\x3d"display:none;" class\x3d"explain-div" data-dojo-attach-point\x3d"explain1"\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"app-2d-and-3d" data-dojo-attach-point\x3d"div2dAnd3d"\x3e\r\n          \x3cdiv class\x3d"app-image-div app-2d" data-dojo-attach-point\x3d"app2D" data-dojo-attach-event\x3d"click:_on2dClick"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"app-image-div app-3d" data-dojo-attach-point\x3d"app3D" data-dojo-attach-event\x3d"click:_on3dClick"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv\x3e\r\n          \x3ctable style\x3d"width:100%" cellspacing\x3d"6"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd width\x3d"10%"\x3e\r\n                  \x3clabel for\x3d"publish-webmap-title"\x3e\r\n                    ${nls.titleLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd width\x3d"90%"\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-title" data-dojo-type\x3d"dijit/form/TextBox" trim\x3d"true" data-dojo-attach-point\x3d"appTitle" maxlength\x3d"250" required\x3d"true" style\x3d"width:95%;padding:2px;"\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"tagsTr"\x3e\r\n                \x3ctd\x3e\r\n                  \x3clabel for\x3d"publish-webmap-tags"\x3e\r\n                    ${nls.tagsLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-tags" data-dojo-type\x3d"builder/Tags" data-dojo-props\x3d"minWidth:\'435px\',maxWidth:\'435px\'"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top"\x3e\r\n                  \x3clabel for\x3d"publish-webmap-summary"\x3e\r\n                    ${nls.summaryLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-summary" data-dojo-type\x3d"dijit/form/SimpleTextarea" rows\x3d\'5\' trim\x3d"true" maxlength\x3d"250" required\x3d"true" style\x3d"width:95%;max-width:95%;min-width:95%;height:200px;max-height:200px;min-height:200px;padding:2px;resize:none;"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"folderTr"\x3e\r\n                \x3ctd\x3e\r\n                  \x3clabel for\x3d"publish-webmap-folder"\x3e\r\n                    ${nls.saveFolderLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-folder" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:96%;"\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"sharingTr"\x3e\r\n                \x3ctd\x3e\x26nbsp;\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-sharing" data-dojo-type\x3d"dijit/form/CheckBox" checked\x3e\x3c/div\x3e\r\n                  \x3clabel for\x3d"publish-webmap-sharing"\x3e${nls.shareSameLevel}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/templates/Tags.html":'\x3cdiv class\x3d"${baseClass}" style\x3d"outline:none;"\x3e\x3c/div\x3e\r\n',"url:builder/AGOLTemplate/templates/AGOLTemplate.html":'\x3cdiv\x3e\r\n  \x3c!--div class\x3d"front-div" data-dojo-attach-point\x3d"frontDiv"--\x3e\r\n    \x3c!--div class\x3d"header-div" data-dojo-attach-point\x3d"headerDiv"\x3e\r\n      \x3cspan\x3e${nls.title}\x3c/span\x3e\r\n      \x3cimg src\x3d"builder/css/images/cancel.png" alt\x3d"img" data-dojo-attach-event\x3d"onclick:_onCancelClick"\x3e\x3c/img\x3e\r\n    \x3c/div--\x3e\r\n\r\n    \x3cdiv class\x3d"content-part" data-dojo-attach-point\x3d"contentPart"\x3e\r\n      \x3cdiv class\x3d"tree-part" data-dojo-attach-point\x3d"treePart"\x3e\r\n        \x3cdiv class\x3d"left-part-title" style\x3d"margin-left:18px; margin-top:10px; color: #596679; font-size: 15px;"\x3e${nls.appNameTitle}${app.name}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"right-part" data-dojo-attach-point\x3d"leftPart"\x3e\r\n        \x3cdiv class\x3d"right-part-head" \x3e\r\n          \x3cspan data-dojo-attach-point\x3d"rightPartHeadText"\x3e${nls.rightPartHead}\x3c/span\x3e\r\n          \x3cdiv class\x3d"review-json-div" data-dojo-attach-point\x3d"reviewJsonDiv" data-dojo-attach-event\x3d"onclick:_onReviewJsonDivClick" style\x3d"display:none"\x3e${nls.viewJsonCode}\x3c/div\x3e\r\n          \x3cdiv class\x3d"review-json-back-div" style\x3d"display: none" data-dojo-attach-point\x3d"reviewJsonBackDiv" data-dojo-attach-event\x3d"onclick:_onReviewJsonBackDivClick"\x3e${nls.viewJsonBack}\x3c/div\x3e\r\n\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"right-part-subhead"\x3e\r\n          ${nls.rightPartSubhead}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"category-part" data-dojo-attach-point\x3d"categoryPart"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"show-json-div" data-dojo-attach-point\x3d"showJsonDiv"\x3e\r\n          \x3cdiv class\x3d"show-json-content-div" data-dojo-attach-point\x3d"showJsonContentDiv"\x3e     \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--div class\x3d"operation-div" data-dojo-attach-point\x3d"operationDiv"\x3e\r\n      \x3cdiv class\x3d"operation-item-div  export-div jimu-btn" style\x3d"" data-dojo-attach-point\x3d"exportNode" data-dojo-attach-event\x3d"onclick:_onExportClick"\x3e${nls.download}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div  download-div jimu-btn jimu-state-disabled" style\x3d"padding: 0px; display: none" data-dojo-attach-point\x3d"downloadNode"\x3e\r\n        \x3ca class\x3d"download-a" href\x3d"#" target\x3d"downloadTargetFrame" data-dojo-attach-point\x3d"downloadLinkNode"\x3e${nls.download}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div save-div jimu-btn" data-dojo-attach-event\x3d"onclick:_onSaveClick"\x3e\r\n        ${nls.save}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"operation-item-div cancel-div jimu-btn" data-dojo-attach-event\x3d"onclick:_onCancelClick"\x3e\r\n        ${nls.cancel}\r\n      \x3c/div\x3e\r\n    \x3c/div--\x3e\r\n  \x3c!--/div--\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/AGOLTemplate/ExportMessage.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"element resMessage" data-dojo-attach-point\x3d"resMessage"\x3e\x3c/div\x3e\r\n    \x3c!--div class\x3d"element" data-dojo-attach-point\x3d"message1"\x3e\x3c/div--\x3e\r\n    \x3cdiv class\x3d"element itemLink"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"word1" \x3eabc\x3c/span\x3e\r\n      \x3ca class\x3d"download-a" target\x3d"_blank" data-dojo-attach-point\x3d"itemLink"\x3e\x3c/a\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"word2" \x3eedf\x3c/span\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/templates/Header.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"home-section" data-dojo-attach-point\x3d"homeSection"\x3e\r\n    \x3cdiv class\x3d"home-label" data-dojo-attach-point\x3d"homeLabel"\x3e${nls.home}\x3c/div\x3e\r\n    \x3cdiv class\x3d"home-menu header-menu" data-dojo-attach-point\x3d"homeMenu"\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"homeItem"\x3e${nls.home}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"galleryItem"\x3e${nls.gallery}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"mapItem"\x3e${nls.map}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"groupsItem"\x3e${nls.groups}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"contentItem"\x3e${nls.content}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" href\x3d"#" data-dojo-attach-point\x3d"organizationItem"\x3e${nls.organization}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"logo-title" data-dojo-attach-point\x3d"logoTitle"\x3e\r\n    \x3cdiv class\x3d"logo"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"title"\x3eWeb AppBuilder for ArcGIS\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"app-name" data-dojo-attach-point\x3d"appName"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"user-section"\x3e\r\n    \x3cdiv class\x3d"user-info"\x3e      \r\n      \x3cdiv class\x3d"user-name" data-dojo-attach-point\x3d"userNameNode"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"user-icon"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"user-menu header-menu"\x3e\r\n      \x3ca nowrap target\x3d"_self" data-dojo-attach-point\x3d"profileItem"\x3e${nls.profile}\x3c/a\x3e\r\n      \x3ca nowrap target\x3d"_self" data-dojo-attach-point\x3d"helpItem"\x3e${nls.help}\x3c/a\x3e\r\n      \x3cdiv nowrap class\x3d"sign-out" data-dojo-attach-point\x3d"signOutItem"\x3e${nls.signOut}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/templates/Apps.html":'\x3cdiv \x3e\r\n  \x3cdiv class\x3d"app-content" data-dojo-attach-point\x3d"appContent"\x3e\r\n    \x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"head-section"\x3e\r\n        \x3cdiv class\x3d"textPart1"\x3e${nls.welcomeMessage}\x3c/div\x3e\r\n        \x3cdiv class\x3d"textPart2"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"upload-button-div"\x3e\r\n          \x3cinput class\x3d"upload-button" type\x3d"button" value\x3d"${nls.appUpload}"\x3e\r\n          \x3cform enctype\x3d"multipart/form-data" method\x3d"post" action\x3d"/builder/rest/apps/upload" data-dojo-attach-point\x3d"uploadAppFileFormNode"\x3e\r\n            \x3cinput class\x3d"file-input" name\x3d"app" type\x3d"file" data-dojo-attach-point\x3d"appFileInputNode" data-dojo-type\x3d"dojox/form/Uploader" data-dojo-attach-event\x3d"onChange:_onAppFileChange,onError:_onAppFileUploadError,onComplete:_onAppFileUploadComplete" accept\x3d".zip" style\x3d"width:100%;height:100%;"/\x3e\x3c/input\x3e\r\n            \x3cinput name\x3d"creator" type\x3d"text" value\x3d"1234" style\x3d"display:none;" data-dojo-attach-point\x3d"appFileCreatorInputNode"\x3e\x3c/input\x3e\r\n          \x3c/form\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"create-button-div"\x3e\x3cinput class\x3d"create-button" type\x3d"button" value\x3d"${nls.appCreate}" data-dojo-attach-event\x3d"onclick:_onCreateClick"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"list-section" id\x3d"list-section" data-dojo-attach-point\x3d"listSection"\x3e\r\n      \x3ctable class\x3d"list-section-head"\x3e\r\n        \x3ctbody\x3e\r\n          \x3ctr class\x3d"head-content"\x3e\r\n            \x3cth class\x3d"name"\x3e${nls.appName}\x3c/th\x3e\r\n            \x3cth class\x3d"desc"\x3e${nls.appDesc}\x3c/th\x3e\r\n            \x3cth class\x3d"time"\x3e${nls.appTime}\x3c/th\x3e\r\n            \x3cth class\x3d"modified"\x3e${nls.appModified}\x3c/th\x3e\r\n            \x3cth class\x3d"creator"\x3e${nls.appCreator}\x3c/th\x3e\r\n          \x3c/tr\x3e  \r\n        \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n\r\n      \x3cdiv class\x3d"list-section-body-content" id\x3d"list-section-body-content" data-dojo-attach-point\x3d"listSectionBodyContent"\x3e\r\n        \x3ctable class\x3d"list-table" data-dojo-attach-point\x3d"listTable"\x3e\r\n          \x3ctbody\x3e\x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e        \r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3ciframe style\x3d"display:none" name\x3d"downloadTargetFrame"\x3e\x3c/iframe\x3e\r\n\x3c/div\x3e\r\n\r\n',
"url:builder/templates/CreateApp.html":'\x3cdiv\x3e\r\n  \x3c!--div class\x3d"back-div" data-dojo-attach-point\x3d"backDiv"--\x3e\r\n    \x3c!--div class\x3d"front-div"--\x3e\r\n      \x3cdiv class\x3d"app-2d-and-3d"\x3e\r\n        \x3cdiv class\x3d"app-image-div app-2d" data-dojo-attach-point\x3d"app2D" data-dojo-attach-event\x3d"click:_on2dClick"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"app-image-div app-3d" data-dojo-attach-point\x3d"app3D" data-dojo-attach-event\x3d"click:_on3dClick"\x3e\x3c!--div class\x3d"surface-div"\x3eComing Soon\x3c/div--\x3e\x3cimg src\x3d"builder/css/images/comingsoon.png" alt\x3d"3d"/\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"app-input app-name"\x3e\x3cinput type\x3d"text" placeholder\x3d"${nls.appName}" data-dojo-attach-point\x3d"appName"/\x3e\x3c/input\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"app-input app-description"\x3e\x3ctextarea  type\x3d"text" data-dojo-attach-point\x3d"appDescription" placeholder\x3d${nls.appDesc}\x3e\x3c/textarea\x3e\x3c/div\x3e\r\n      \x3c!--div class\x3d"app-button cancel-button" data-dojo-attach-event\x3d"onclick:_onCancelClick"\x3e${nls.cancel}\x3c/div--\x3e\r\n      \x3c!--div class\x3d"app-button next-button"   data-dojo-attach-event\x3d"onclick:_onNextClick"\x3e${nls.ok}\x3c/div--\x3e\r\n    \x3c!--/div--\x3e\r\n  \x3c!--/div--\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/templates/AppOperMenu.html":'\x3cdiv data-dojo-attach-event\x3d"onclick:_onMenuClick"\x3e\r\n  \x3cdiv class\x3d"up-triangle" data-dojo-attach-point\x3d"upTriangle"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"down-triangle" data-dojo-attach-point\x3d"downTriangle"\x3e\x3c/div\x3e\r\n  \x3c!--div class\x3d"item item-cf" data-dojo-attach-point\x3d"createFromHere" data-dojo-attach-event\x3d"onclick:_onCreateFromHereClick,onmouseover:_onCreateFromHereMouseover,onmouseout:_onCreateFromHereMouseout"\x3e${nls.createFromHere}\x3c/div--\x3e\r\n  \x3cdiv class\x3d"item item-editAppInfo" style\x3d"border-top-left-radius:5px;border-top-right-radius:5px;"data-dojo-attach-point\x3d"editAppInfo" data-dojo-attach-event\x3d"onclick:_onEditClick"\x3e${nls.editAppInfo}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-download" data-dojo-attach-point\x3d"download" data-dojo-attach-event\x3d"onclick:_onDownloadClick"\x3e\r\n    \x3ca data-dojo-attach-point\x3d"downloadLinkNode" style\x3d"display:inline-block;width:100%;height:100%;" target\x3d"downloadTargetFrame"\x3e${nls.download}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-duplicate" data-dojo-attach-point\x3d"duplicate" data-dojo-attach-event\x3d"onclick:_onDuplicateClick"\x3e${nls.duplicate}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item itme-remove" style\x3d"" data-dojo-attach-point\x3d"remove" data-dojo-attach-event\x3d"onclick:_onRemoveClick"\x3e${nls.deleteMenu}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-agol-template" style\x3d"border-bottom-left-radius:5px;border-bottom-right-radius:5px;" data-dojo-attach-point\x3d"agolTemplate" data-dojo-attach-event\x3d"onclick:_onAgolTemplateClick"\x3e${nls.agolTemp}\x3c/div\x3e \r\n\r\n  \x3c!--div class\x3d"item itme-qrcode" style\x3d"" data-dojo-attach-point\x3d"qrcode" data-dojo-attach-event\x3d"onclick:_onQRCodeClick"\x3eqrcodeeeeeee-nonls\x3c/div--\x3e \r\n\x3c/div\x3e\r\n',
"url:dojox/form/resources/Uploader.html":'\x3cspan class\x3d"dijit dijitReset dijitInline"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e \r\n\t\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen" tabIndex\x3d"-1" data-dojo-attach-point\x3d"valueNode" /\x3e\r\n\x3c/span\x3e\r\n',
"*now":function(q){q(['dojo/i18n!*preload*builder/nls/main*["ar","cs","da","de","en","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","ROOT"]'])}}});
define("dojo/_base/kernel dojo/_base/config dojo/_base/html dojo/_base/lang dojo/_base/array dojo/cookie dojo/domReady! dojo/on dojo/topic dojo/promise/all jimu/utils jimu/dijit/ViewStack jimu/portalUrlUtils jimu/portalUtils ./ConfigApp ./Header ./Apps ./tokenUtils require esri/IdentityManager dojo/i18n dojo/i18n!./nls/builder dojo/i18n!jimu/nls/main".split(" "),function(q,c,b,g,l,k,s,n,p,m,f,t,v,r,x,u,w,h,a,e,d,A,B){function C(a){b.setStyle("pre-main-page","display","none");b.setStyle("main-page",
"display","block");window.portalUrl=a.portalUrl;h.setPortalUrl(window.portalUrl);var c=v.getSharingUrl(window.portalUrl);e.checkSignInStatus(c).then(function(){z(a)},function(){if(window.isXT)h.xtGetCredentialFromCookie(window.portalUrl)&&z(a);else{var b=v.getPortalSignInUrlFromLocation(),c=encodeURI(window.location.href);window.location.href=b+"?returnUrl\x3d"+c}})}function z(a){var b=r.getPortal(window.portalUrl).loadSelfInfo();m([b]).then(function(b){b=b[0];window.portalSelf=b;(b=b.user&&b.user.culture||
b.culture||c.locale)&&(b=b.toLowerCase());f.isLocaleChanged(c.locale,b)?(k("appbuilder_locale",b),window.location.reload()):(window.main||(main=new t({viewType:"dijit",views:[]},"main-view-stack"),(new u({},"header")).startup(),main.startup()),window.isXT?queryObject.id?(b={id:queryObject.id.replace("#","")},p.publish("switchToApp",b,a)):p.publish("switchToAppList",a):p.publish("initMainPageForIntegration",a))})}window.isBuilder=!0;window.isRunInPortal=!window.isXT;window.builderNls=A;window.jimuNls=
B;window.onunload=function(){k("appbuilder_xt",null,{expires:-1,path:"/"})};"function"!==typeof k.getAll&&(k.getAll=function(a){var b=[];(a=k(a))&&b.push(a);return b});jimuConfig.layoutId=jimuConfig.mainPageId;p.subscribe("switchToMainPage",function(a){var b=window.location.href.replace(/(action=)(.+)/,"");f.changeLocation(b);C(a)});p.subscribe("switchToApp",function(a,b){var c=main.getViewByLabel("config");c&&main.removeView(c);c=new x(a);main.addView(c);main.switchView(c)});p.subscribe("switchToAppList",
function(a){(a=main.getViewByLabel("config"))&&main.removeView(a);a=main.getViewByLabel("applist");a||(a=new w({id:"app-list"}),main.addView(a));main.switchView("applist");a.refresh()});b.setStyle("main-loading","display","none");window.isXT?a(["./xtMain"]):a(["./integrationMain"])});