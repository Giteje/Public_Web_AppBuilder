//>>built
require({cache:{"url:builder/templates/CreateAppNew.html":'\x3cdiv\x3e\r\n      \x3cdiv id\x3d"share-map-application-publish" dojoType\x3d"dijit.layout.ContentPane" dojoAttachPoint\x3d"_stackApplicationPublish" class\x3d"share-map-stack-stack  .esriLtr .esri"\x3e\r\n\r\n        \x3cp style\x3d"display:none;" class\x3d"configureApp"\x3e${nls.savePublish}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder"\x3e${nls.appBuilderTitle}\x3c/p\x3e\r\n        \x3cp style\x3d"display:none;" class\x3d"appBuilder"\x3e${nls.appBuilderMsg}\x3c/p\x3e\r\n\r\n        \x3cdiv class\x3d"app-2d-and-3d" data-dojo-attach-point\x3d"div2dAnd3d"\x3e\r\n          \x3cdiv class\x3d"app-image-div app-2d" data-dojo-attach-point\x3d"app2D" data-dojo-attach-event\x3d"click:_on2dClick"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"app-image-div app-3d" data-dojo-attach-point\x3d"app3D" data-dojo-attach-event\x3d"click:_on3dClick"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv\x3e\r\n          \x3ctable style\x3d"width:100%" cellspacing\x3d"6"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd width\x3d"10%"\x3e\r\n                  \x3clabel for\x3d"publish-webmap-title"\x3e\r\n                    ${nls.titleLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd width\x3d"90%"\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-title" data-dojo-type\x3d"dijit/form/TextBox" trim\x3d"true" data-dojo-attach-point\x3d"appTitle" maxlength\x3d"250" required\x3d"true" style\x3d"width:95%;padding:2px;"\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"tagsTr"\x3e\r\n                \x3ctd\x3e\r\n                  \x3clabel for\x3d"publish-webmap-tags"\x3e\r\n                    ${nls.tagsLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-tags" data-dojo-type\x3d"builder/Tags" data-dojo-props\x3d"minWidth:\'435px\',maxWidth:\'435px\'"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd valign\x3d"top"\x3e\r\n                  \x3clabel for\x3d"publish-webmap-summary"\x3e\r\n                    ${nls.summaryLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-summary" data-dojo-type\x3d"dijit/form/SimpleTextarea" rows\x3d\'5\' trim\x3d"true" maxlength\x3d"250" required\x3d"true" style\x3d"width:95%;max-width:95%;min-width:95%;height:200px;max-height:200px;min-height:200px;padding:2px;resize:none;"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"folderTr"\x3e\r\n                \x3ctd\x3e\r\n                  \x3clabel for\x3d"publish-webmap-folder"\x3e\r\n                    ${nls.saveFolderLabel}\r\n                  \x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-folder" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:96%;"\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"sharingTr"\x3e\r\n                \x3ctd\x3e\x26nbsp;\x3c/td\x3e\r\n                \x3ctd\x3e\r\n                  \x3cdiv id\x3d"publish-webmap-sharing" data-dojo-type\x3d"dijit/form/CheckBox" checked\x3e\x3c/div\x3e\r\n                  \x3clabel for\x3d"publish-webmap-sharing"\x3e${nls.shareSameLevel}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dojo/Deferred dojo/keys dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/dijit dojo/text!./templates/CreateAppNew.html dojo/on dojo/dom dojo/dom-style dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/cookie dojo/promise/all jimu/dijit/Message jimu/dijit/Popup builder/portalUtils jimu/portalUrlUtils jimu/dijit/LoadingShelter dojo/ready ./serviceUtils ./Tags dijit/form/SimpleTextarea dijit/form/TextBox dijit/form/Select dijit/form/CheckBox".split(" "),
function(u,v,E,F,l,r,s,w,x,y,b,z,G,H,h,g,I,e,A,t,k,B,n,p,C,J,q,K,L){function D(a,d,c){var b=n.getPortal(p.getPortalUrlFromLocation()),f=new l,g=new l,h=new l,m=new l;b.getUser().then(e.hitch(this,function(a){f.resolve(a)}),e.hitch(this,function(a){new k({message:builderNls.apps.createAppUrlError});f.reject()}));b.getItemById(c).then(e.hitch(this,function(a){g.resolve(a)}),e.hitch(this,function(a){new k({message:builderNls.apps.createAppUrlError});g.reject(a)}));t({user:f,userItem:h}).then(e.hitch(this,
function(c){var b={};switch(c.userItem.sharing.access){case "public":b.everyone=!0;b.groups=c.userItem.sharing.groups.toString();break;case "account":case "org":b.org=!0;b.groups=c.userItem.sharing.groups.toString();break;case "shared":b.groups=c.userItem.sharing.groups.toString()}c.user.shareItem(b,a,d).then(e.hitch(this,function(a){m.resolve(a)}),e.hitch(this,function(a){new k({message:builderNls.apps.createAppUrlError});m.reject()}))}));t({user:f,webmapItem:g}).then(e.hitch(this,function(b){if(b.webmapItem.owner===
b.user.username)b.user.getItemById(c,b.webmapItem.ownerFolder).then(e.hitch(this,function(a){h.resolve(a)}),e.hitch(this,function(a){new k({message:builderNls.apps.createAppUrlError});h.reject(a)}));else{var f={};switch(b.webmapItem.access){case "public":f.everyone=!0;break;case "account":case "org":f.org=!0}b.user.shareItem(f,a,d).then(e.hitch(this,function(a){m.resolve(a)}),e.hitch(this,function(a){new k({message:builderNls.apps.createAppUrlError});m.reject()}))}}))}var f=u([w,x,y],{templateString:z,
baseClass:"create-app",appListWidget:null,createFromId:null,is3D:"false",_appBuilderSettings:null,_configureSettings:null,isXT:null,user:null,webmap:null,postMixInProperties:function(){this.nls=e.mixin({},builderNls.common);this.nls=e.mixin(this.nls,builderNls.apps)},postCreate:function(){this.inherited(arguments);this.isXT=A("appbuilder_xt")},constructor:function(){},startup:function(){this.inherited(arguments);this._initDlgPage()},_initDlgPage:function(){this.appTitle.focus();this.isXT?(h.set(this.tagsTr,
"display","none"),h.set(this.folderTr,"display","none"),h.set(this.sharingTr,"display","none"),g.add(this.app2D,"app-image-div-down"),this.createFromId&&h.set(this.div2dAnd3d,"display","none"),this._getInitAppInfo().then(e.hitch(this,function(a){this._setDlgProperties(a)}))):(h.set(this.div2dAnd3d,"display","none"),this.createFromId&&h.set(this.sharingTr,"display","none"),n.getPortal(p.getPortalUrlFromLocation()).getUser().then(e.hitch(this,function(a){this.user=a;this._initFolder(a);this._getInitAppInfo().then(e.hitch(this,
function(d){b.byId("publish-webmap-tags").loadTags(a).then(e.hitch(this,function(){this._setDlgProperties(d)}))}))}),e.hitch(this,function(a){this._setDlgProperties(f.getDefaultAppInfo())})))},_saveAs:function(a){var d=new l;q.duplicateApp(a,this.appConfig).then(e.hitch(this,function(c){this._closePopup();this.destroy();var b=e.clone(a);b.id=c.newAppId;b.name=c.newName;s.publish("switchToApp",b);(c=main.getViewByLabel("apps"))&&window.isXT&&c.refresh();d.resolve()}),e.hitch(this,function(a){new k({message:builderNls.apps.saveAsFaied});
d.reject()}));return d},_onCancelClick:function(){this._closePopup();this.destroy()},_onNextClick:function(){if(b.byId("publish-webmap-title").get("value")){var a=this._getDlgProperties(),d=new C;d.placeAt(this.popup.domNode);d.startup();this.createFromId?this._saveAs(this._convertAppInfo(a)).then(function(){d.destroy()},function(){d.destroy()}):f.create(this._convertAppInfo(a)).then(e.hitch(this,function(){this.appListWidget&&this.appListWidget.refresh();this._closePopup();this.destroy();d.destroy()}),
function(){d.destroy()})}else new k({message:this.nls.noAppName})},_closePopup:function(){this.popup&&this.popup.close()},_on2dClick:function(){"true"===this.is3D&&(this.is3D="false",g.add(this.app2D,"app-image-div-down"),g.remove(this.app3D,"app-image-div-down"))},_on3dClick:function(){},_getInitAppInfo:function(){var a=new l,d=f.getDefaultAppInfo();this.isXT?this.createFromId?q.getAppInfo(this.createFromId).then(e.hitch(this,function(c){d.name=c.name+"-Copy";d.description=c.description;this.is3D=
d.is3D=c.is3D;a.resolve(d)}),e.hitch(this,function(c){a.reject()})):a.resolve(d):this.createFromId?n.getPortal(p.getPortalUrlFromLocation()).getItemById(this.createFromId).then(e.hitch(this,function(c){d.name=c.title+"-Copy";d.tags=c.tags;d.description=c.snippet;a.resolve(d)}),e.hitch(this,function(c){a.reject()})):a.resolve(d);return a},_getDlgProperties:function(){return{name:b.byId("publish-webmap-title").get("value"),tags:b.byId("publish-webmap-tags").get("tags"),description:b.byId("publish-webmap-summary").get("value"),
folderId:b.byId("publish-webmap-folder").get("value"),sharing:b.byId("publish-webmap-sharing").get("checked")}},_setDlgProperties:function(a){b.byId("publish-webmap-title").set("value",a.name);b.byId("publish-webmap-tags").set("tags",a.tags||[]);b.byId("publish-webmap-summary").set("value",a.description);b.byId("publish-webmap-folder").set("value",a.folderId);b.byId("publish-webmap-sharing").set("checked",a.sharing);"true"===a.is3D?(g.add(this.app3D,"app-image-div-down"),g.remove(this.app2D,"app-image-div-down")):
(g.add(this.app2D,"app-image-div-down"),g.remove(this.app3D,"app-image-div-down"))},_initFolder:function(a){var d=new l;a.getContent().then(e.hitch(this,function(c){var f=[{label:a.username,value:""}],f=f.concat(v.map(c.folders,e.hitch(this,function(a){return{label:a.title,value:a.id}})));b.byId("publish-webmap-folder").set("options",f);b.byId("publish-webmap-folder").set("value","");d.resolve()}),function(a){d.reject()});return d},_convertAppInfo:function(a){return{name:a.name,description:a.description,
tags:a.tags,folderId:a.folderId,sharing:a.sharing,is3D:this.is3D,webmap:this.webmap,createFromId:this.createFromId}}});f.getDefaultAppInfo=function(){return{name:"",description:"",tags:["AppBuilder App"],folderId:"",sharing:!1,is3D:"false",webmap:null,createFromId:null,creator:null}};f.create=function(a){var d=new l;q.createApp(a).then(e.hitch(this,function(c){if(c.success){var b=e.clone(a);b.id=c.newAppId;s.publish("switchToApp",b);d.resolve();a.sharing&&a.webmap&&D(c.newAppId,a.folderId,a.webmap)}else new k({message:c.message}),
d.reject()}),e.hitch(this,function(a){new k({message:a.message});d.reject(a)}));return d};f.popupDlg=function(a,b){var c=new f(a);new B({content:c,container:"main-page",titleLabel:b||builderNls.apps.appCreateTitle,width:669,autoHeight:!0,buttons:[{label:builderNls.common.ok,key:r.ENTER,onClick:e.hitch(c,c._onNextClick)},{label:builderNls.common.cancel,key:r.ESCAPE,onClick:e.hitch(c,c._onCancelClick)}]});c.startup()};return f});