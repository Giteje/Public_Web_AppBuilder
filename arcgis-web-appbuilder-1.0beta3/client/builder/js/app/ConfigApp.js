//>>built
require({cache:{"url:builder/templates/ConfigApp.html":'\x3cdiv \x3e\r\n  \x3cdiv class\x3d"left-pane" data-dojo-attach-point\x3d"leftPaneNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"right-preview-section" data-dojo-attach-point\x3d"rightPreviewSection"\x3e\r\n    \x3cdiv class\x3d"preview-config" data-dojo-attach-point\x3d"previewConfig"\x3e\r\n      \x3ciframe name\x3d"previewFrame" data-dojo-attach-point\x3d"viewerNode" style\x3d"border:none"\x3e\x3c/iframe\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"preview-more" data-dojo-attach-point\x3d"previewMore"\x3e\r\n      \x3cdiv class\x3d"preview-more-iframe-section" data-dojo-attach-point\x3d"previewMoreIframeSection"\x3e\r\n        \x3cdiv class\x3d"preview-more-iframe-container" data-dojo-attach-point\x3d"viewer2Container"\x3e\r\n          \x3ciframe name\x3d"previewMoreFrame" data-dojo-attach-point\x3d"viewer2Node"\x3e\x3c/iframe\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"description" data-dojo-attach-point\x3d"previewMoreDes"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e    \r\n      \x3cdiv class\x3d"screen-switch-section"\x3e\r\n       \x3cdiv class\x3d"portrait selected" data-dojo-attach-point\x3d"btnPortrait"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"landscape" data-dojo-attach-point\x3d"btnLandscape"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/cookie dojo/topic dojo/io-query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/ConfigApp.html ./config/LeftPane ./utils ./serviceUtils jimu/utils jimu/WidgetManager jimu/dijit/ViewStack esri/urlUtils esri/geometry/Extent esri/tasks/GeometryService esri/config esri/urlUtils dojo/request dijit/registry builder/tokenUtils".split(" "),function(m,b,z,c,g,A,d,k,n,p,q,r,f,s,t,u,v,B,w,x,h,C,D,y,l){return m([n,
p],{templateString:q,baseClass:"config-app",_PreviewMoreIframeSrc:"",_isPortrait:!0,_deviceInfo:null,appId:null,label:"config",postCreate:function(){this.inherited(arguments);this.own(g(this.viewerNode,"load",b.hitch(this,function(){window.configWindow=this.viewerNode.contentWindow})));this.own(g(this.viewer2Node,"load",b.hitch(this,function(){window.previewWindow=this.viewer2Node.contentWindow})));this.viewStack=new v({viewType:"dom",views:[this.previewConfig,this.previewMore]});c.addClass(this.viewStack.domNode,
"preview-viewstack");c.place(this.viewStack.domNode,this.rightPreviewSection);this._showPreviewConfig();this._republishBuilderEvents();this.own(d.subscribe("showPreviewConfig",b.hitch(this,function(){this._showPreviewConfig()})));this.own(d.subscribe("showPreviewMore",b.hitch(this,function(){this._showPreviewMore()})));this.own(d.subscribe("onDeviceSelected",b.hitch(this,this.onDeviceSelected)));this.own(g(this.btnPortrait,"click",b.hitch(this,function(){this._resizePreviewMore(!0)})));this.own(g(this.btnLandscape,
"click",b.hitch(this,function(){this._resizePreviewMore(!1)})));this._createLeftPane();this.widgetManager=u.getInstance();window.setConfigViewerTopic=b.hitch(this,function(a){this.configViewerTopic=a;this.own(this.configViewerTopic.subscribe("appConfigLoaded",b.hitch(this,this.onAppConfigLoaded)));this.own(this.configViewerTopic.subscribe("appConfigChanged",b.hitch(this,this.onAppConfigChanged)));this.own(this.configViewerTopic.subscribe("mapLoaded",b.hitch(this,this.onMapLoaded)));this.own(this.configViewerTopic.subscribe("mapChanged",
b.hitch(this,this.onMapChanged)));this.own(this.configViewerTopic.subscribe("preloadWidgetsLoaded",b.hitch(this,this.onPreloadWidgetsLoaded)));this.own(this.configViewerTopic.subscribe("mapCreatedFailed",b.hitch(this,this.onMapCreatedFailed)));this.own(this.configViewerTopic.subscribe("configUserSignIn",b.hitch(this,function(a){d.publish("externalUserSignIn",a);this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",a)})))});window.setPreviewViewerTopic=b.hitch(this,function(a){this.previewViewerTopic=
a;var e=b.clone(this.appConfig);e.mode="preview";this.previewViewerTopic.publish("resetConfig",e);this.own(this.previewViewerTopic.subscribe("previewUserSignIn",b.hitch(this,function(a){d.publish("externalUserSignIn",a);this.configViewerTopic.publish("externalUserSignIn",a)})));this.own(this.previewViewerTopic.subscribe("mapLoaded",b.hitch(this,function(){this._copyConfigMapExtent2PreviewExtent()})));window.previewWindow.require("jimu/tokenUtils",function(a){var b=e.portalUrl;a.setPortalUrl(b);(a=
l.getPortalCredential(b))&&this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",a)})});this._updateUrl();this._updateAppId();this.showAppName()},_updateUrl:function(){var a=window.location.href,e=a.indexOf("?"),b=k.queryToObject(a.substr(e+1,a.length));b.id!==this.id&&(b.id||(b=b.apiurl?{apiurl:b.apiurl}:{}),b.id=this.id,a=a.substr(0,e)+"?"+decodeURIComponent(k.objectToQuery(b)),history.pushState&&window.history.pushState({path:a},"",a))},_createLeftPane:function(){this.leftPane=
new r({});this.leftPane.placeAt(this.leftPaneNode)},_updateAppId:function(){window.appId=this.id;var a=f.getAppPathById(this.id);jimuConfig.widgetsPackage={name:"widgets",location:f.getAppWidgetsPackageLoacation(this.id)};jimuConfig.themesPackage={name:"themes",location:f.getAppThemesPackageLoacation(this.id)};var b=t.urlToObject(window.location.href).query||{};delete b.id;b.mode="preview";this._PreviewMoreIframeSrc=f.appendParamsToAppPath(a,b);b.mode="config";c.attr(this.viewerNode,"src",f.appendParamsToAppPath(a,
b))},setAppId:function(a){if(this.id===a){var e=b.clone(this.leftPane.lastAppConfig);this.leftPane.destroy();this._createLeftPane({appId:a});this._setAppConfig(e,!0);this.configViewerTopic.publish("resetConfig",e)}else this.id=a,c.setStyle(this.leftPane.coverNode,"display",""),this._updateAppId()},showAppName:function(){var a=y.byId("header");"stemapp"===this.id?a.setAppName("stemapp"):this.name?a.setAppName(this.name):s.getAppInfo(this.id).then(b.hitch(this,function(b){a.setAppName(b.name)}))},_republishBuilderEvents:function(){this.own(d.subscribe("configChanged",
b.hitch(this,function(a,b,c){this.configViewerTopic.publish("configChanged",a,b,c)})));this.own(d.subscribe("themeChanged",b.hitch(this,function(a){this.configViewerTopic.publish("themeChanged",a)})));this.own(d.subscribe("layoutChanged",b.hitch(this,function(a){this.configViewerTopic.publish("layoutChanged",a)})));this.own(d.subscribe("styleChanged",b.hitch(this,function(a){this.configViewerTopic.publish("styleChanged",a)})));this.own(d.subscribe("actionTriggered",b.hitch(this,function(a,b,c){this.configViewerTopic.publish("actionTriggered",
a,b,c)})));this.own(d.subscribe("builderUserSignIn",b.hitch(this,function(a){this.configViewerTopic&&this.configViewerTopic.publish("externalUserSignIn",a);this.previewViewerTopic&&this.previewViewerTopic.publish("externalUserSignIn",a)})))},startup:function(){this.inherited(arguments);this.leftPane.startup();this.viewStack.startup()},destroy:function(){h.defaults.geometryService=null;this.leftPane.destroy();this.leftPane=null;this.inherited(arguments)},_getGeomtryServiceByAppConfig:function(a){return new x(a.geometryService)},
onAppConfigLoaded:function(a){h.defaults.geometryService=this._getGeomtryServiceByAppConfig(a);d.publish("appConfigLoaded",a);this._setAppConfig(a,!0);(a=l.getPortalCredential(a.portalUrl))&&this.configViewerTopic.publish("externalUserSignIn",a)},onMapLoaded:function(a){d.publish("mapLoaded",a)},onMapChanged:function(a){d.publish("mapChanged",a)},onAppConfigChanged:function(a,b,c){h.defaults.geometryService=this._getGeomtryServiceByAppConfig(a);d.publish("appConfigChanged",a,b,c);this._setAppConfig(a,
!1)},onPreloadWidgetsLoaded:function(){d.publish("preloadWidgetsLoaded")},onMapCreatedFailed:function(){d.publish("mapCreatedFailed")},_setAppConfig:function(a,b){this.leftPane.setAppConfig(a,b);this.appConfig=a;window.appConfig=a},_showPreviewConfig:function(){this.viewStack.switchView(this.previewConfig)},_showPreviewMore:function(){this.viewStack.switchView(this.previewMore);if(!this.viewer2Node.src&&this._PreviewMoreIframeSrc)this._initPreviewMoreViewerPosition(),c.attr(this.viewer2Node,"src",
this._PreviewMoreIframeSrc);else{var a=b.clone(this.appConfig);a.mode="preview";this._copyConfigMapExtent2PreviewExtent();this.previewViewerTopic.publish("resetConfig",a)}},_copyConfigMapExtent2PreviewExtent:function(){var a=window.configWindow&&window.configWindow._viewerMap,b=window.previewWindow&&window.previewWindow._viewerMap;a&&b&&b.setExtent(a.extent)},_initPreviewMoreViewerPosition:function(){var a=c.getMarginBox(this.previewMore);c.setStyle(this.viewer2Container,{width:a.w-220+"px",height:a.h-
130+"px"});c.setStyle(this.previewMoreIframeSection,"marginTop","50px")},_setPreviewMoreViewerPosition:function(){var a=c.getMarginBox(this.previewMore).h,b=c.getMarginBox(this.viewer2Container),d=c.getStyle(this.viewer2Container,"paddingTop"),f=c.getStyle(this.viewer2Container,"paddingBottom"),a=(a-(b.h+d+f))/2;0>a&&(a=0);c.setStyle(this.previewMoreIframeSection,"marginTop",a+"px")},onDeviceSelected:function(a,b){this._deviceInfo=a;c.setStyle(this.previewMoreDes,"display","block");this.previewMoreDes.innerHTML=
b?a.width+" x "+a.height:a.title+" "+a.width+" x "+a.height;this._resizePreviewMore(this._isPortrait)},_resizePreviewMore:function(a){var b=window.configWindow&&window.configWindow._viewerMap,c=window.previewWindow&&window.previewWindow._viewerMap,d=b&&b.extent.toJson();a?this._showPortrait():this._showLandscape();c&&d&&setTimeout(function(){var a=new w(d);c.setExtent(a)},500)},_showPortrait:function(){this._deviceInfo&&(this._isPortrait=!0,c.setStyle(this.viewer2Container,{width:this._deviceInfo.width+
44+"px",height:this._deviceInfo.height+44+"px"}),c.addClass(this.btnPortrait,"selected"),c.removeClass(this.btnLandscape,"selected"),this._setPreviewMoreViewerPosition())},_showLandscape:function(){this._deviceInfo&&(this._isPortrait=!1,c.setStyle(this.viewer2Container,{width:this._deviceInfo.height+44+"px",height:this._deviceInfo.width+44+"px"}),c.removeClass(this.btnPortrait,"selected"),c.addClass(this.btnLandscape,"selected"),this._setPreviewMoreViewerPosition())}})});