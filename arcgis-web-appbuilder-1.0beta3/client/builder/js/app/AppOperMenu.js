//>>built
require({cache:{"url:builder/templates/AppOperMenu.html":'\x3cdiv data-dojo-attach-event\x3d"onclick:_onMenuClick"\x3e\r\n  \x3cdiv class\x3d"up-triangle" data-dojo-attach-point\x3d"upTriangle"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"down-triangle" data-dojo-attach-point\x3d"downTriangle"\x3e\x3c/div\x3e\r\n  \x3c!--div class\x3d"item item-cf" data-dojo-attach-point\x3d"createFromHere" data-dojo-attach-event\x3d"onclick:_onCreateFromHereClick,onmouseover:_onCreateFromHereMouseover,onmouseout:_onCreateFromHereMouseout"\x3e${nls.createFromHere}\x3c/div--\x3e\r\n  \x3cdiv class\x3d"item item-editAppInfo" style\x3d"border-top-left-radius:5px;border-top-right-radius:5px;"data-dojo-attach-point\x3d"editAppInfo" data-dojo-attach-event\x3d"onclick:_onEditClick,onmouseover:_onEditMouseover,onmouseout:_onEditMouseout"\x3e${nls.editAppInfo}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-download" data-dojo-attach-point\x3d"download" data-dojo-attach-event\x3d"onclick:_onDownloadClick,onmouseover:_onDownloadMouseover,onmouseout:_onDownloadMouseout"\x3e\r\n    \x3ca data-dojo-attach-point\x3d"downloadLinkNode" style\x3d"display:inline-block;width:100%;height:100%;" target\x3d"downloadTargetFrame"\x3e${nls.download}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-duplicate" data-dojo-attach-point\x3d"duplicate" data-dojo-attach-event\x3d"onclick:_onDuplicateClick,onmouseover:_onDuplicateMouseover,onmouseout:_onDuplicateMouseout"\x3e${nls.duplicate}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item itme-remove" style\x3d"" data-dojo-attach-point\x3d"remove" data-dojo-attach-event\x3d"onclick:_onRemoveClick,onmouseover:_onRemoveMouseover,onmouseout:_onRemoveMouseout"\x3e${nls.deleteMenu}\x3c/div\x3e\r\n  \x3cdiv class\x3d"item item-agol-template" style\x3d"border-bottom-left-radius:5px;border-bottom-right-radius:5px;" data-dojo-attach-point\x3d"agolTemplate" data-dojo-attach-event\x3d"onclick:_onAgolTemplateClick,onmouseover:_onAgolTemplateMouseover,onmouseout:_onAgolTemplateMouseout"\x3e${nls.agolTemp}\x3c/div\x3e    \r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/request dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AppOperMenu.html dojo/on dojo/query dojo/dom-style dojo/dom-attr dojo/dom dojo/_base/lang jimu/dijit/Popup jimu/dijit/Message builder/CreateApp ./AGOLTemplate/AGOLTemplate ./serviceUtils jimu/ConfigManager jimu/dijit/LoadingShelter dijit/form/TextBox dijit/form/SimpleTextarea".split(" "),function(n,B,a,p,q,r,s,t,h,C,D,u,e,k,v,w,x,l,y,m,z,A){return n([q,r],{templateString:s,
baseClass:"app-menu",app:void 0,isShow:!1,position:{},itemDefaultColor:"#ffffff",appListWidget:void 0,loadingDiv:null,_downloadUrl:null,postMixInProperties:function(){this.nls=e.mixin({},builderNls.common);this.nls=e.mixin(this.nls,builderNls.apps)},postCreate:function(){this.hide();this._downloadUrl="/builder/rest/apps/"+this.app.id+"/download";a.setAttr(this.downloadLinkNode,"href",this._downloadUrl);this.own(t(this.downloadLinkNode,"click",e.hitch(this,function(){this.hide()})))},refresh:function(){var b=
u.byId("list-section"),c=a.position(this.posNode),f=a.position(b),d=c.y-f.y,b=a.getStyle(b,"height"),f=f.y+b,b=a.getStyle(this.domNode,"height"),c=c.y+b;a.setStyle(this.upTriangle,"display","block");a.setStyle(this.downTriangle,"display","none");c+30>f&&(d=d-b-66,a.setStyle(this.upTriangle,"display","none"),a.setStyle(this.downTriangle,"display","block"));a.setStyle(this.domNode,{top:d+52+"px",right:"2px"})},show:function(){this.refresh();a.setStyle(this.domNode,"display","block");this.isShow=!0},
hide:function(){a.setStyle(this.domNode,"display","none");this.isShow=!1},removeApp:function(b){return p("/builder/rest/apps/removeapp",{handleAs:"json",method:"POST",data:{id:b}})},duplicateApp:function(){return l.duplicateApp({name:this.app.name,description:this.app.description,id:this.app.id})},_onMenuClick:function(b){b.stopPropagation()},_onCreateFromHereClick:function(){var b=a.create("div",{id:"app-create-popup"},this.appListWidget.createApp);new w({appListWidget:this.appListWidget,apps:this.apps,
createFromId:this.app.id,is3D:this.app.is3D},b);this.hide()},_onCreateFromHereMouseover:function(){a.addClass(this.createFromHere,"item-mouseover")},_onCreateFromHereMouseout:function(){a.removeClass(this.createFromHere,"item-mouseover")},_onRemoveClick:function(){var b=new k({content:this.nls.confirmDeleteApp,titleLabel:this.nls.deleteAppTitle,width:"425",autoHeight:!0,buttons:[{label:this.nls.ok,onClick:e.hitch(this,function(){var a=new m;a.placeAt(this.appListWidget.domNode);a.startup();b.close();
this.removeApp(this.app.id).then(e.hitch(this,function(b){b.success&&b.apps!=={}&&this.appListWidget.refresh(b.apps);a.destroy()}),function(){a.destroy()})})},{label:this.nls.cancel,onClick:e.hitch(this,function(){b.close()})}]})},_onRemoveMouseover:function(){a.addClass(this.remove,"item-mouseover")},_onRemoveMouseout:function(){a.removeClass(this.remove,"item-mouseover")},_onDuplicateClick:function(){var a=new m;a.placeAt(this.appListWidget.domNode);a.startup();l.duplicateApp({name:this.app.name,
description:this.app.description,is3D:this.app.is3D,createFromId:this.app.id}).then(e.hitch(this,function(c){a.destroy();c.success&&c.apps!=={}&&this.appListWidget.refresh(c.apps)}),function(){});this.hide()},_onDuplicateMouseover:function(){a.addClass(this.duplicate,"item-mouseover")},_onDuplicateMouseout:function(){a.removeClass(this.duplicate,"item-mouseover")},_onEditClick:function(){var b=a.create("div",{"class":"edit-app-info-content"}),c;c=a.create("div",{"class":"app-name"},b);var f=(new z({value:this.app.name,
maxlength:250,required:!0,"class":"name-text-box"})).placeAt(c);c=a.create("div",{"class":"app-description"},b);var d=(new A({value:this.app.description,rows:5,trim:!0,maxlength:250,required:!0,placeholder:this.nls.appDesc,"class":"desc-text-area"})).placeAt(c),g=new k({content:b,container:"main-page",titleLabel:this.nls.editAppInfo,width:"700",autoHeight:!0,buttons:[{label:this.nls.ok,onClick:e.hitch(this,function(){var a=e.hitch(this,this._onEditPageOk,f.getValue(),d.getValue(),g);(this.app.name!==
f.getValue()||this.app.description!==d.getValue())&&a()})},{label:this.nls.cancel,onClick:function(){g.close()}}]}),b=h(".line",g.domNode)[0];a.destroy(b)},_onEditPageOk:function(a,c,f){var d=e.clone(this.app);d.name=a;d.description=c;this.appListWidget.updateApp(d).then(e.hitch(this,function(d){!0===d.success?(this.app.name=a,this.app.description=c,this.app.lastUpdated=d.lastUpdated,this.app.modified=d.modified,this.appListWidget.refresh(this.apps),f.close()):new v({message:d.message})}),function(a){})},
_onEditMouseover:function(){a.addClass(this.editAppInfo,"item-mouseover")},_onEditMouseout:function(){a.removeClass(this.editAppInfo,"item-mouseover")},_onDownloadClick:function(){},_onDownloadMouseover:function(){a.addClass(this.download,"item-mouseover")},_onDownloadMouseout:function(){a.removeClass(this.download,"item-mouseover")},_onAgolTemplateClick:function(){var b=h("#main-page")[0],c=a.create("div",{},b);jimuConfig.widgetsPackage={name:"widgets",location:"/webappbuilder/apps/"+this.app.id+
"/widgets"};y.getInstance({config:"/webappbuilder/apps/"+this.app.id+"/config.json"}).loadConfig().then(e.hitch(this,function(a){var b=a.getCleanConfig();b.visitElement=a.visitElement;b.visitElement(function(a){!a.widgets&&(a.uri&&void 0===a.visible)&&(a.visible=!0)});delete b.visitElement;new x({appConfig:b,fullAppConfig:a,app:this.app},c)}));this.hide()},_onAgolTemplateMouseover:function(){a.addClass(this.agolTemplate,"item-mouseover")},_onAgolTemplateMouseout:function(){a.removeClass(this.agolTemplate,
"item-mouseover")}})});